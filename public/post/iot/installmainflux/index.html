<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>安装mainflux全系列 - Eiger - A young gopher</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Eiger" /><meta name="description" content="安装mainflux 安装mainflux 1.环境准备 2.protoc安装 3. GNU MAKE安装 4. mainflux编译 4.1 获取mainflux源码 4.2. 编" /><meta name="keywords" content="mainflux, docker, protoc" />






<meta name="generator" content="Hugo 0.74.3 with even 4.0.0" />


<link rel="canonical" href="https://azd1997.github.io/post/iot/installmainflux/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="安装mainflux全系列" />
<meta property="og:description" content="安装mainflux 安装mainflux 1.环境准备 2.protoc安装 3. GNU MAKE安装 4. mainflux编译 4.1 获取mainflux源码 4.2. 编" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://azd1997.github.io/post/iot/installmainflux/" />
<meta property="article:published_time" content="2019-08-17T02:47:50+08:00" />
<meta property="article:modified_time" content="2019-08-20T03:14:14-04:00" />
<meta itemprop="name" content="安装mainflux全系列">
<meta itemprop="description" content="安装mainflux 安装mainflux 1.环境准备 2.protoc安装 3. GNU MAKE安装 4. mainflux编译 4.1 获取mainflux源码 4.2. 编">
<meta itemprop="datePublished" content="2019-08-17T02:47:50+08:00" />
<meta itemprop="dateModified" content="2019-08-20T03:14:14-04:00" />
<meta itemprop="wordCount" content="41749">



<meta itemprop="keywords" content="mainflux," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="安装mainflux全系列"/>
<meta name="twitter:description" content="安装mainflux 安装mainflux 1.环境准备 2.protoc安装 3. GNU MAKE安装 4. mainflux编译 4.1 获取mainflux源码 4.2. 编"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Eiger</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/links/">
        <li class="mobile-menu-item">Links</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Eiger</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/links/">Links</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">安装mainflux全系列</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-08-17 </span>
        <div class="post-category">
            <a href="/categories/iot/"> iot </a>
            </div>
          <span class="more-meta"> 41749 words </span>
          <span class="more-meta"> 84 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1环境准备">1.环境准备</a></li>
    <li><a href="#2protoc安装">2.protoc安装</a></li>
    <li><a href="#3-gnu-make安装">3. GNU MAKE安装</a></li>
    <li><a href="#4-mainflux编译">4. mainflux编译</a>
      <ul>
        <li><a href="#41-获取mainflux源码">4.1 获取mainflux源码</a></li>
        <li><a href="#42-编译所有服务">4.2. 编译所有服务</a></li>
        <li><a href="#43-编译单个微服务">4.3. 编译单个微服务</a></li>
        <li><a href="#44-编译dockers">4.4. 编译dockers</a></li>
        <li><a href="#45-其他docker安装相关">4.5. 其他docker安装相关</a></li>
        <li><a href="#46-mqtt微服务">4.6. mqtt微服务</a></li>
        <li><a href="#47-其他">4.7. 其他</a></li>
      </ul>
    </li>
    <li><a href="#5-安装nodejs和npm">5. 安装node.js和npm</a>
      <ul>
        <li><a href="#51-解决npm安装ajv-keywords缺少配对问题">5.1. 解决npm安装ajv-keywords缺少配对问题</a></li>
        <li><a href="#52-解决node-gyp提示找不到python">5.2. 解决node-gyp提示找不到python</a></li>
      </ul>
    </li>
    <li><a href="#6-安装docker">6. 安装Docker</a>
      <ul>
        <li><a href="#61-none镜像的处理">6.1. <code>&lt;none&gt;</code>镜像的处理</a></li>
      </ul>
    </li>
    <li><a href="#7-mainflux运行测试">7. mainflux运行测试</a></li>
    <li><a href="#8-mainflux安装">8. mainflux安装</a></li>
    <li><a href="#9-mainflux部署">9. mainflux部署</a>
      <ul>
        <li><a href="#91-前提">9.1 前提</a></li>
      </ul>
    </li>
    <li><a href="#10-postgrescassandranats安装">10. postgres、cassandra、nats安装</a>
      <ul>
        <li><a href="#101安装postgres">10.1.安装postgres</a></li>
        <li><a href="#102-安装cassandra">10.2. 安装cassandra</a></li>
        <li><a href="#103-安装nats">10.3. 安装nats</a></li>
        <li><a href="#104-安装java开发环境java-12">10.4. 安装Java开发环境（Java 12）</a></li>
        <li><a href="#105-安装java开发环境java-8">10.5. 安装Java开发环境（Java 8）</a></li>
      </ul>
    </li>
    <li><a href="#11-其他一些问题">11. 其他一些问题</a>
      <ul>
        <li><a href="#111-sudoxxx找不到xxx命令">11.1. sudo+xxx:找不到xxx命令</a></li>
      </ul>
    </li>
    <li><a href="#12-getting-started">12. Getting started</a>
      <ul>
        <li><a href="#121-运行整个系统">12.1 运行整个系统</a></li>
        <li><a href="#122-安装mainflux-cli">12.2 安装mainflux-cli</a></li>
        <li><a href="#123-系统测试配置provisioning">12.3 系统测试配置（Provisioning）</a></li>
        <li><a href="#124-发送消息测试">12.4 发送消息测试</a></li>
      </ul>
    </li>
    <li><a href="#13-mainflux架构概念">13. mainflux架构、概念</a>
      <ul>
        <li><a href="#131-架构">13.1 架构</a></li>
        <li><a href="#132-provisioning">13.2 Provisioning</a></li>
        <li><a href="#133-messaging">13.3 Messaging</a></li>
        <li><a href="#134-storage">13.4 Storage</a></li>
        <li><a href="#135-lora">13.5 LoRa</a></li>
        <li><a href="#136-安全通信">13.6 安全通信</a></li>
        <li><a href="#137-authentication认证">13.7 Authentication（认证）</a></li>
        <li><a href="#138-cli">13.8 CLI</a></li>
        <li><a href="#139-bootstrap引导">13.9 Bootstrap（引导）</a></li>
      </ul>
    </li>
    <li><a href="#14-mainflux应用">14. mainflux应用</a>
      <ul>
        <li><a href="#141-连接一个mqtt设备">14.1 连接一个mqtt设备</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="安装mainflux">安装mainflux</h1>
<ul>
<li><a href="#%e5%ae%89%e8%a3%85mainflux">安装mainflux</a>
<ul>
<li><a href="#1%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87">1.环境准备</a></li>
<li><a href="#2protoc%e5%ae%89%e8%a3%85">2.protoc安装</a></li>
<li><a href="#3-gnu-make%e5%ae%89%e8%a3%85">3. GNU MAKE安装</a></li>
<li><a href="#4-mainflux%e7%bc%96%e8%af%91">4. mainflux编译</a>
<ul>
<li><a href="#41-%e8%8e%b7%e5%8f%96mainflux%e6%ba%90%e7%a0%81">4.1 获取mainflux源码</a></li>
<li><a href="#42-%e7%bc%96%e8%af%91%e6%89%80%e6%9c%89%e6%9c%8d%e5%8a%a1">4.2. 编译所有服务</a></li>
<li><a href="#43-%e7%bc%96%e8%af%91%e5%8d%95%e4%b8%aa%e5%be%ae%e6%9c%8d%e5%8a%a1">4.3. 编译单个微服务</a></li>
<li><a href="#44-%e7%bc%96%e8%af%91dockers">4.4. 编译dockers</a></li>
<li><a href="#45-%e5%85%b6%e4%bb%96docker%e5%ae%89%e8%a3%85%e7%9b%b8%e5%85%b3">4.5. 其他docker安装相关</a></li>
<li><a href="#46-mqtt%e5%be%ae%e6%9c%8d%e5%8a%a1">4.6. mqtt微服务</a></li>
<li><a href="#47-%e5%85%b6%e4%bb%96">4.7. 其他</a></li>
</ul>
</li>
<li><a href="#5-%e5%ae%89%e8%a3%85nodejs%e5%92%8cnpm">5. 安装node.js和npm</a>
<ul>
<li><a href="#51-%e8%a7%a3%e5%86%b3npm%e5%ae%89%e8%a3%85ajv-keywords%e7%bc%ba%e5%b0%91%e9%85%8d%e5%af%b9%e9%97%ae%e9%a2%98">5.1. 解决npm安装ajv-keywords缺少配对问题</a></li>
<li><a href="#52-%e8%a7%a3%e5%86%b3node-gyp%e6%8f%90%e7%a4%ba%e6%89%be%e4%b8%8d%e5%88%b0python">5.2. 解决node-gyp提示找不到python</a></li>
</ul>
</li>
<li><a href="#6-%e5%ae%89%e8%a3%85docker">6. 安装Docker</a>
<ul>
<li><a href="#61-none%e9%95%9c%e5%83%8f%e7%9a%84%e5%a4%84%e7%90%86">6.1. <code>&lt;none&gt;</code>镜像的处理</a></li>
</ul>
</li>
<li><a href="#7-mainflux%e8%bf%90%e8%a1%8c%e6%b5%8b%e8%af%95">7. mainflux运行测试</a></li>
<li><a href="#8-mainflux%e5%ae%89%e8%a3%85">8. mainflux安装</a></li>
<li><a href="#9-mainflux%e9%83%a8%e7%bd%b2">9. mainflux部署</a>
<ul>
<li><a href="#91-%e5%89%8d%e6%8f%90">9.1 前提</a></li>
</ul>
</li>
<li><a href="#10-postgrescassandranats%e5%ae%89%e8%a3%85">10. postgres、cassandra、nats安装</a>
<ul>
<li><a href="#101%e5%ae%89%e8%a3%85postgres">10.1.安装postgres</a></li>
<li><a href="#102-%e5%ae%89%e8%a3%85cassandra">10.2. 安装cassandra</a></li>
<li><a href="#103-%e5%ae%89%e8%a3%85nats">10.3. 安装nats</a></li>
<li><a href="#104-%e5%ae%89%e8%a3%85java%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83java-12">10.4. 安装Java开发环境（Java 12）</a></li>
<li><a href="#105-%e5%ae%89%e8%a3%85java%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83java-8">10.5. 安装Java开发环境（Java 8）</a></li>
</ul>
</li>
<li><a href="#11-%e5%85%b6%e4%bb%96%e4%b8%80%e4%ba%9b%e9%97%ae%e9%a2%98">11. 其他一些问题</a>
<ul>
<li><a href="#111-sudoxxx%e6%89%be%e4%b8%8d%e5%88%b0xxx%e5%91%bd%e4%bb%a4">11.1. sudo+xxx:找不到xxx命令</a></li>
</ul>
</li>
<li><a href="#12-getting-started">12. Getting started</a>
<ul>
<li><a href="#121-%e8%bf%90%e8%a1%8c%e6%95%b4%e4%b8%aa%e7%b3%bb%e7%bb%9f">12.1 运行整个系统</a></li>
<li><a href="#122-%e5%ae%89%e8%a3%85mainflux-cli">12.2 安装mainflux-cli</a></li>
<li><a href="#123-%e7%b3%bb%e7%bb%9f%e6%b5%8b%e8%af%95%e9%85%8d%e7%bd%aeprovisioning">12.3 系统测试配置（Provisioning）</a></li>
<li><a href="#124-%e5%8f%91%e9%80%81%e6%b6%88%e6%81%af%e6%b5%8b%e8%af%95">12.4 发送消息测试</a></li>
</ul>
</li>
<li><a href="#13-mainflux%e6%9e%b6%e6%9e%84%e6%a6%82%e5%bf%b5">13. mainflux架构、概念</a>
<ul>
<li><a href="#131-%e6%9e%b6%e6%9e%84">13.1 架构</a></li>
<li><a href="#132-provisioning">13.2 Provisioning</a>
<ul>
<li><a href="#1321-%e7%94%a8%e6%88%b7%e7%ae%a1%e7%90%86">13.2.1 用户管理</a></li>
<li><a href="#1322-%e7%b3%bb%e7%bb%9f%e9%85%8d%e7%bd%aeprovision">13.2.2 系统配置（provision）</a></li>
<li><a href="#1323-%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6">13.2.3 访问控制</a></li>
</ul>
</li>
<li><a href="#133-messaging">13.3 Messaging</a>
<ul>
<li><a href="#1331-http">13.3.1 http</a></li>
<li><a href="#1332-mqtt">13.3.2 MQTT</a></li>
</ul>
</li>
<li><a href="#134-storage">13.4 Storage</a>
<ul>
<li><a href="#1341-writers">13.4.1 Writers</a></li>
<li><a href="#1342-readers">13.4.2 Readers</a></li>
</ul>
</li>
<li><a href="#135-lora">13.5 LoRa</a></li>
<li><a href="#136-%e5%ae%89%e5%85%a8%e9%80%9a%e4%bf%a1">13.6 安全通信</a>
<ul>
<li><a href="#1361-%e5%ae%89%e5%85%a8%e7%9a%84postgresql%e8%bf%9e%e6%8e%a5">13.6.1 安全的PostgreSQL连接</a></li>
<li><a href="#1362-%e5%ae%89%e5%85%a8%e7%9a%84grpc">13.6.2 安全的gRPC</a></li>
</ul>
</li>
<li><a href="#137-authentication%e8%ae%a4%e8%af%81">13.7 Authentication（认证）</a>
<ul>
<li><a href="#1371-%e4%bd%bf%e7%94%a8mainflux%e7%a7%98%e9%92%a5%e8%ae%a4%e8%af%81">13.7.1 使用Mainflux秘钥认证</a></li>
<li><a href="#1372-%e4%bd%bf%e7%94%a8x509%e8%af%81%e4%b9%a6%e8%bf%9b%e8%a1%8c%e7%9b%b8%e4%ba%92tls%e8%ae%a4%e8%af%81">13.7.2 使用X.509证书进行相互TLS认证</a></li>
</ul>
</li>
<li><a href="#138-cli">13.8 CLI</a></li>
<li><a href="#139-bootstrap%e5%bc%95%e5%af%bc">13.9 Bootstrap（引导）</a></li>
</ul>
</li>
<li><a href="#14-mainflux%e5%ba%94%e7%94%a8">14. mainflux应用</a>
<ul>
<li><a href="#141-%e8%bf%9e%e6%8e%a5%e4%b8%80%e4%b8%aamqtt%e8%ae%be%e5%a4%87">14.1 连接一个mqtt设备</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>注意！！！</strong></p>
<ul>
<li>1-11节记录依据mainflux开发者文档手动编译、构建、部署的过程。官方开发者文档： <a href="https://mainflux.readthedocs.io/en/latest/dev-guide/">https://mainflux.readthedocs.io/en/latest/dev-guide/</a></li>
<li>12节记录依据官方文档运行mainflux的过程，此后章节记录mainflux的进一步应用及业务实践。<a href="https://mainflux.readthedocs.io/en/latest/getting-started/">https://mainflux.readthedocs.io/en/latest/getting-started/</a></li>
</ul>
<h2 id="1环境准备">1.环境准备</h2>
<ul>
<li>Ubuntu18.04</li>
<li>GO 1.12.7（其他不太低的版本也可以）</li>
<li>安装protoc（protocol buffers编译器）</li>
<li>安装GNU Make</li>
<li>安装Docker CE</li>
</ul>
<p>注意：mainflux使用go protobuf，但go protobuf又依赖于C++ protobuf。</p>
<h2 id="2protoc安装">2.protoc安装</h2>
<ol>
<li>
<p>protoc(protobuf compiler)安装</p>
<p>源码安装就算了，选择二进制安装：</p>
<p><a href="https://github.com/protocolbuffers/protobuf/releases">https://github.com/protocolbuffers/protobuf/releases</a></p>
<p>选择protobuf-3.9.1-linux-x86_64.tar.gz。将之解压后将可执行文件置于PATH目录下即可。我的操作是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo cp -r protobuf-3.9.1-linux-x86_64 /usr/local <span class="c1">## 将解压后的整个文件夹复制到/usr/local/下</span>
sudo nano /etc/profile  <span class="c1">## 追加export PATH=$PATH:/usr/local/protobuf-3.9.1-linux-x86_64/bin</span>
<span class="nb">source</span> /etc/profile  <span class="c1">## 使添加的环境变量立即生效，否则需要重启生效</span>
</code></pre></td></tr></table>
</div>
</div><p>（ps: 如果不是编辑/etc/profile而是编辑$HOME/.profile，则可能需要执行<code>sudo chmod a+x protoc</code>，提升所有用户对protoc的执行权限）</p>
<p>此时，在终端输入<code>protoc --version</code>可看到其版本信息，说明protobuf编译器安装成功。</p>
</li>
<li>
<p>安装go protobuf</p>
<p>终端输入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">go get -u github.com/golang/protobuf/protoc-gen-go
</code></pre></td></tr></table>
</div>
</div><p>安装完成后会在$GOPATH/bin下产生protoc-gen-go可执行文件。
由于mainflux使用的是Protocol Buffers for Go with Gadgets，其安装参考<a href="https://github.com/gogo/protobuf">https://github.com/gogo/protobuf</a>。只需在终端输入：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">go get github.com/gogo/protobuf/protoc-gen-gofast
</code></pre></td></tr></table>
</div>
</div><p>安装完成后会在$GOPATH/bin下产生protoc-gen-gofast可执行文件。</p>
<p>注意：记得将第一个$GOPATH的bin子目录设为PATH或者GOBIN（go get得到的程序默认安装在此）。</p>
</li>
</ol>
<h2 id="3-gnu-make安装">3. GNU MAKE安装</h2>
<p>Ubuntu默认仓库中有一个Build-essential元包，包含了gcc、make等一系列编译所需的软件。我们所需要的GNU MAKE就是这个包里的make。windows平台上的make可以通过Visual Studio集成的make工具或者是MinGW中的make工具。</p>
<p>在Ubuntu上安装build-essential:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt update
sudo apt install build-essential
</code></pre></td></tr></table>
</div>
</div><p>安装完成后输入<code>make --version</code>可以进行验证。</p>
<h2 id="4-mainflux编译">4. mainflux编译</h2>
<h3 id="41-获取mainflux源码">4.1 获取mainflux源码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">go get github.com/mainflux/mainflux
<span class="nb">cd</span> <span class="nv">$GOPATH</span>/src/github.com/mainflux/mainflux
</code></pre></td></tr></table>
</div>
</div><p>现在mainflux源码被拉取到了$GOPATH/src/github.com/mainflux/mainflux下
（ps: 其实这和直接使用git clone来拉取效果是一样的。只不过放的位置不同）</p>
<h3 id="42-编译所有服务">4.2. 编译所有服务</h3>
<p>mainflux是一个微服务架构，所以可以在其/cmd目录下看到很多个main函数（每一个文件代表一个微服务）。</p>
<p>切换到mainflux根目录下（如前已达成此操作），执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">make
</code></pre></td></tr></table>
</div>
</div><p>即可编译所有微服务。</p>
<p><strong>注意：在编译过程中应关注/mainflux/Makefile文件，其中定义了编译选项和行为！</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ make
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-users cmd/users/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-things cmd/things/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-http cmd/http/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-normalizer cmd/normalizer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-ws cmd/ws/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-coap cmd/coap/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-lora cmd/lora/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-influxdb-writer cmd/influxdb-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-influxdb-reader cmd/influxdb-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-mongodb-writer cmd/mongodb-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-mongodb-reader cmd/mongodb-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-cassandra-writer cmd/cassandra-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-cassandra-reader cmd/cassandra-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-postgres-writer cmd/postgres-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-postgres-reader cmd/postgres-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-cli cmd/cli/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-bootstrap cmd/bootstrap/main.go
<span class="nb">cd</span> mqtt/aedes <span class="o">&amp;&amp;</span> npm install
/bin/sh: 1: npm: not found
Makefile:102: recipe <span class="k">for</span> target <span class="s1">&#39;mqtt&#39;</span> failed
make: *** <span class="o">[</span>mqtt<span class="o">]</span> Error <span class="m">127</span>
</code></pre></td></tr></table>
</div>
</div><p>从执行结果可以看出在编译/cmd下的所有微服务。进入到/mainflux/build文件夹下，可以看到编译出来的所有微服务或者说可执行文件。</p>
<p>但是最后报错，提示没有npm，所以下载再安装node.js先（npm是node.js的包管理工具），参考session 5(安装node.js和npm)</p>
<p>安装完npm之后，重新执行make:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ make
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-users cmd/users/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-things cmd/things/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-http cmd/http/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-normalizer cmd/normalizer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-ws cmd/ws/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-coap cmd/coap/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-lora cmd/lora/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-influxdb-writer cmd/influxdb-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-influxdb-reader cmd/influxdb-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-mongodb-writer cmd/mongodb-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-mongodb-reader cmd/mongodb-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-cassandra-writer cmd/cassandra-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-cassandra-reader cmd/cassandra-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-postgres-writer cmd/postgres-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-postgres-reader cmd/postgres-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-cli cmd/cli/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-bootstrap cmd/bootstrap/main.go
<span class="nb">cd</span> mqtt/aedes <span class="o">&amp;&amp;</span> npm install
npm WARN deprecated circular-json@0.3.3: CircularJSON is in maintenance only, flatted is its successor.
npm WARN deprecated superagent@3.8.3: Please note that v5.0.1+ of superagent removes User-Agent header by default, therefore you may need to add it yourself <span class="o">(</span>e.g. GitHub blocks requests without a User-Agent header<span class="o">)</span>.  This notice will go away with v5.0.2+ once it is released.

&gt; dtrace-provider@0.8.7 install /home/eiger/gopath-default/src/github.com/mainflux/mainflux/mqtt/aedes/node_modules/dtrace-provider
&gt; node-gyp rebuild <span class="o">||</span> node suppress-error.js

make<span class="o">[</span>1<span class="o">]</span>: Entering directory <span class="s1">&#39;/home/eiger/gopath-default/src/github.com/mainflux/mainflux/mqtt/aedes/node_modules/dtrace-provider/build&#39;</span>
  TOUCH Release/obj.target/DTraceProviderStub.stamp
make<span class="o">[</span>1<span class="o">]</span>: Leaving directory <span class="s1">&#39;/home/eiger/gopath-default/src/github.com/mainflux/mainflux/mqtt/aedes/node_modules/dtrace-provider/build&#39;</span>

&gt; grpc@1.22.2 install /home/eiger/gopath-default/src/github.com/mainflux/mainflux/mqtt/aedes/node_modules/grpc
&gt; node-pre-gyp install --fallback-to-build --library<span class="o">=</span>static_library

node-pre-gyp WARN Using request <span class="k">for</span> node-pre-gyp https download
<span class="o">[</span>grpc<span class="o">]</span> Success: <span class="s2">&#34;/home/eiger/gopath-default/src/github.com/mainflux/mainflux/mqtt/aedes/node_modules/grpc/src/node/extension_binary/node-v57-linux-x64-glibc/grpc_node.node&#34;</span> is installed via remote

&gt; protobufjs@6.8.8 postinstall /home/eiger/gopath-default/src/github.com/mainflux/mainflux/mqtt/aedes/node_modules/protobufjs
&gt; node scripts/postinstall

mqtt-adapter@ /home/eiger/gopath-default/src/github.com/mainflux/mainflux/mqtt/aedes
├── 2@1.0.2
├─┬ @grpc/proto-loader@0.5.1
│ └── lodash.camelcase@4.3.0
├─┬ aedes@0.38.1
│ ├── aedes-packet@1.0.0
│ ├─┬ aedes-persistence@6.0.0
│ │ └── qlobber@3.1.0
│ ├─┬ bulk-write-stream@2.0.0
│ │ └── readable-stream@3.4.0
│ ├─┬ end-of-stream@1.4.1
│ │ └─┬ once@1.4.0
│ │   └── wrappy@1.0.2
│ ├── fastfall@1.5.1
│ ├── fastparallel@2.3.0
│ ├── fastseries@1.7.2
│ ├── from2@2.3.0
│ ├─┬ mqemitter@2.2.0
│ │ └── qlobber@1.8.0
│ ├─┬ mqtt-packet@6.2.1
│ │ ├── bl@1.2.2
│ │ └── process-nextick-args@2.0.1
│ ├── pump@3.0.0
│ ├── retimer@2.0.0
│ ├── reusify@1.0.4
│ ├─┬ shortid@2.2.14
│ │ └── nanoid@2.0.3
│ ├── through2@3.0.1
│ ├── uuid@3.3.2
│ └─┬ why-is-node-running@2.1.0
│   └── stackback@0.0.2
├─┬ aedes-logging@2.0.1
│ ├─┬ pino@4.17.6
│ │ ├── fast-json-parse@1.0.3
│ │ ├── fast-safe-stringify@1.2.3
│ │ ├── flatstr@1.0.12
│ │ ├── pino-std-serializers@2.4.2
│ │ ├── quick-format-unescaped@1.1.2
│ │ └─┬ split2@2.2.0
│ │   └── through2@2.0.5
│ └── safe-buffer@5.1.2
├─┬ aedes-persistence-redis@5.1.0
│ ├─┬ aedes-cached-persistence@6.0.0
│ │ ├── aedes-persistence@5.1.1
│ │ ├── multistream@2.1.1
│ │ └── qlobber@1.8.0
│ ├── hashlru@2.3.0
│ ├─┬ ioredis@3.2.2
│ │ ├── bluebird@3.5.5
│ │ ├── cluster-key-slot@1.1.0
│ │ ├── denque@1.4.1
│ │ ├── flexbuffer@0.0.6
│ │ ├── lodash.assign@4.2.0
│ │ ├── lodash.bind@4.2.1
│ │ ├── lodash.clonedeep@4.5.0
│ │ ├── lodash.defaults@4.2.0
│ │ ├── lodash.difference@4.5.0
│ │ ├── lodash.flatten@4.4.0
│ │ ├── lodash.foreach@4.5.0
│ │ ├── lodash.isempty@4.4.0
│ │ ├── lodash.keys@4.2.0
│ │ ├── lodash.noop@3.0.1
│ │ ├── lodash.partial@4.2.1
│ │ ├── lodash.pick@4.4.0
│ │ ├── lodash.sample@4.2.1
│ │ ├── lodash.shuffle@4.2.0
│ │ └── lodash.values@4.3.0
│ ├─┬ msgpack-lite@0.1.26
│ │ ├── event-lite@0.1.2
│ │ ├── ieee754@1.1.13
│ │ ├── int64-buffer@0.1.10
│ │ └── isarray@1.0.0
│ ├── pump@1.0.3
│ ├── qlobber@1.8.0
│ ├── through2@2.0.5
│ └── throughv@1.0.4
├── atob@2.1.2
├─┬ bunyan@1.8.12
│ ├── dtrace-provider@0.8.7
│ ├── moment@2.24.0
│ ├─┬ mv@2.1.1
│ │ ├── ncp@2.0.0
│ │ └─┬ rimraf@2.4.5
│ │   └── glob@6.0.4
│ └── safe-json-stringify@1.2.0
├─┬ chai@3.5.0
│ ├── assertion-error@1.1.0
│ ├─┬ deep-eql@0.1.3
│ │ └── type-detect@0.1.1
│ └── type-detect@1.0.0
├─┬ eslint@4.19.1
│ ├─┬ ajv@5.5.2
│ │ ├── co@4.6.0
│ │ ├── fast-deep-equal@1.1.0
│ │ ├── fast-json-stable-stringify@2.0.0
│ │ └── json-schema-traverse@0.3.1
│ ├─┬ babel-code-frame@6.26.0
│ │ ├─┬ chalk@1.1.3
│ │ │ ├── ansi-styles@2.2.1
│ │ │ └── supports-color@2.0.0
│ │ └── js-tokens@3.0.2
│ ├─┬ chalk@2.4.2
│ │ ├─┬ ansi-styles@3.2.1
│ │ │ └─┬ color-convert@1.9.3
│ │ │   └── color-name@1.1.3
│ │ └── supports-color@5.5.0
│ ├─┬ concat-stream@1.6.2
│ │ ├── buffer-from@1.1.1
│ │ └── typedarray@0.0.6
│ ├─┬ cross-spawn@5.1.0
│ │ ├─┬ shebang-command@1.2.0
│ │ │ └── shebang-regex@1.0.0
│ │ └─┬ which@1.3.1
│ │   └── isexe@2.0.0
│ ├─┬ debug@3.2.6
│ │ └── ms@2.1.2
│ ├── doctrine@2.1.0
│ ├─┬ eslint-scope@3.7.3
│ │ ├── esrecurse@4.2.1
│ │ └── estraverse@4.2.0
│ ├── eslint-visitor-keys@1.0.0
│ ├─┬ espree@3.5.4
│ │ ├── acorn@5.7.3
│ │ └─┬ acorn-jsx@3.0.1
│ │   └── acorn@3.3.0
│ ├── esquery@1.0.1
│ ├── esutils@2.0.3
│ ├─┬ file-entry-cache@2.0.0
│ │ ├─┬ flat-cache@1.3.4
│ │ │ ├── circular-json@0.3.3
│ │ │ ├── graceful-fs@4.2.1
│ │ │ ├─┬ rimraf@2.6.3
│ │ │ │ └── glob@7.1.4
│ │ │ └── write@0.2.1
│ │ └── object-assign@4.1.1
│ ├── functional-red-black-tree@1.0.1
│ ├─┬ glob@7.1.4
│ │ ├── fs.realpath@1.0.0
│ │ ├── inflight@1.0.6
│ │ └── path-is-absolute@1.0.1
│ ├── globals@11.12.0
│ ├── ignore@3.3.10
│ ├── imurmurhash@0.1.4
│ ├─┬ inquirer@3.3.0
│ │ ├── ansi-escapes@3.2.0
│ │ ├─┬ cli-cursor@2.1.0
│ │ │ └─┬ restore-cursor@2.0.0
│ │ │   ├─┬ onetime@2.0.1
│ │ │   │ └── mimic-fn@1.2.0
│ │ │   └── signal-exit@3.0.2
│ │ ├── cli-width@2.2.0
│ │ ├─┬ external-editor@2.2.0
│ │ │ ├── chardet@0.4.2
│ │ │ ├── iconv-lite@0.4.24
│ │ │ └─┬ tmp@0.0.33
│ │ │   └── os-tmpdir@1.0.2
│ │ ├── figures@2.0.0
│ │ ├── mute-stream@0.0.7
│ │ ├─┬ run-async@2.3.0
│ │ │ └── is-promise@2.1.0
│ │ ├── rx-lite@4.0.8
│ │ ├── rx-lite-aggregates@4.0.8
│ │ ├─┬ string-width@2.1.1
│ │ │ └── is-fullwidth-code-point@2.0.0
│ │ ├─┬ strip-ansi@4.0.0
│ │ │ └── ansi-regex@3.0.0
│ │ └── through@2.3.8
│ ├── is-resolvable@1.1.0
│ ├─┬ js-yaml@3.13.1
│ │ ├─┬ argparse@1.0.10
│ │ │ └── sprintf-js@1.0.3
│ │ └── esprima@4.0.1
│ ├── json-stable-stringify-without-jsonify@1.0.1
│ ├─┬ levn@0.3.0
│ │ ├── prelude-ls@1.1.2
│ │ └── type-check@0.3.2
│ ├─┬ minimatch@3.0.4
│ │ └─┬ brace-expansion@1.1.11
│ │   ├── balanced-match@1.0.0
│ │   └── concat-map@0.0.1
│ ├─┬ mkdirp@0.5.1
│ │ └── minimist@0.0.8
│ ├── natural-compare@1.4.0
│ ├─┬ optionator@0.8.2
│ │ ├── deep-is@0.1.3
│ │ ├── fast-levenshtein@2.0.6
│ │ └── wordwrap@1.0.0
│ ├── path-is-inside@1.0.2
│ ├── pluralize@7.0.0
│ ├── progress@2.0.3
│ ├── regexpp@1.1.0
│ ├─┬ require-uncached@1.0.3
│ │ ├─┬ caller-path@0.1.0
│ │ │ └── callsites@0.2.0
│ │ └── resolve-from@1.0.1
│ ├── semver@5.7.0
│ ├─┬ strip-ansi@4.0.0
│ │ └── ansi-regex@3.0.0
│ ├── strip-json-comments@2.0.1
│ ├─┬ table@4.0.2
│ │ ├─┬ UNMET PEER DEPENDENCY ajv@5.5.2
│ │ │ ├── fast-deep-equal@1.1.0
│ │ │ └── json-schema-traverse@0.3.1
│ │ ├── ajv-keywords@2.1.1
│ │ ├─┬ slice-ansi@1.0.0
│ │ │ └── is-fullwidth-code-point@2.0.0
│ │ └─┬ string-width@2.1.1
│ │   ├── is-fullwidth-code-point@2.0.0
│ │   └─┬ strip-ansi@4.0.0
│ │     └── ansi-regex@3.0.0
│ └── text-table@0.2.0
├─┬ eslint-config-airbnb-base@12.1.0
│ └── eslint-restricted-globals@0.1.1
├─┬ eslint-plugin-import@2.18.2
│ ├─┬ array-includes@3.0.3
│ │ ├─┬ define-properties@1.1.3
│ │ │ └── object-keys@1.1.1
│ │ └─┬ es-abstract@1.13.0
│ │   ├─┬ es-to-primitive@1.2.0
│ │   │ ├── is-date-object@1.0.1
│ │   │ └─┬ is-symbol@1.0.2
│ │   │   └── has-symbols@1.0.0
│ │   ├── is-callable@1.1.4
│ │   └── is-regex@1.0.4
│ ├── contains-path@0.1.0
│ ├─┬ debug@2.6.9
│ │ └── ms@2.0.0
│ ├── doctrine@1.5.0
│ ├── eslint-import-resolver-node@0.3.2
│ ├─┬ eslint-module-utils@2.4.1
│ │ └── pkg-dir@2.0.0
│ ├─┬ has@1.0.3
│ │ └── <span class="k">function</span>-bind@1.1.1
│ ├── object.values@1.1.0
│ ├─┬ read-pkg-up@2.0.0
│ │ ├─┬ find-up@2.1.0
│ │ │ └─┬ locate-path@2.0.0
│ │ │   ├─┬ p-locate@2.0.0
│ │ │   │ └─┬ p-limit@1.3.0
│ │ │   │   └── p-try@1.0.0
│ │ │   └── path-exists@3.0.0
│ │ └─┬ read-pkg@2.0.0
│ │   ├─┬ load-json-file@2.0.0
│ │   │ ├─┬ parse-json@2.2.0
│ │   │ │ └─┬ error-ex@1.3.2
│ │   │ │   └── is-arrayish@0.2.1
│ │   │ ├── pify@2.3.0
│ │   │ └── strip-bom@3.0.0
│ │   ├─┬ normalize-package-data@2.5.0
│ │   │ ├─┬ hosted-git-info@2.8.2
│ │   │ │ └─┬ lru-cache@5.1.1
│ │   │ │   └── yallist@3.0.3
│ │   │ └─┬ validate-npm-package-license@3.0.4
│ │   │   ├─┬ spdx-correct@3.1.0
│ │   │   │ └── spdx-license-ids@3.0.5
│ │   │   └─┬ spdx-expression-parse@3.0.0
│ │   │     └── spdx-exceptions@2.2.0
│ │   └── path-type@2.0.0
│ └─┬ resolve@1.12.0
│   └── path-parse@1.0.6
├─┬ grpc@1.22.2
│ ├── lodash.clone@4.5.0
│ ├── nan@2.14.0
│ ├─┬ node-pre-gyp@0.13.0
│ │ ├── detect-libc@1.0.3
│ │ ├─┬ mkdirp@0.5.1
│ │ │ └── minimist@0.0.8
│ │ ├─┬ needle@2.4.0
│ │ │ ├─┬ debug@3.2.6
│ │ │ │ └── ms@2.1.2
│ │ │ ├─┬ iconv-lite@0.4.23
│ │ │ │ └── safer-buffer@2.1.2
│ │ │ └── sax@1.2.4
│ │ ├─┬ nopt@4.0.1
│ │ │ ├── abbrev@1.1.1
│ │ │ └─┬ osenv@0.1.5
│ │ │   ├── os-homedir@1.0.2
│ │ │   └── os-tmpdir@1.0.2
│ │ ├─┬ npm-packlist@1.4.1
│ │ │ ├── ignore-walk@3.0.1
│ │ │ └── npm-bundled@1.0.6
│ │ ├─┬ npmlog@4.1.2
│ │ │ ├─┬ are-we-there-yet@1.1.5
│ │ │ │ ├── delegates@1.0.0
│ │ │ │ └─┬ readable-stream@2.3.6
│ │ │ │   ├── core-util-is@1.0.2
│ │ │ │   ├── isarray@1.0.0
│ │ │ │   ├── process-nextick-args@2.0.1
│ │ │ │   ├── string_decoder@1.1.1
│ │ │ │   └── util-deprecate@1.0.2
│ │ │ ├── console-control-strings@1.1.0
│ │ │ ├─┬ gauge@2.7.4
│ │ │ │ ├── aproba@1.2.0
│ │ │ │ ├── has-unicode@2.0.1
│ │ │ │ ├── object-assign@4.1.1
│ │ │ │ ├── signal-exit@3.0.1
│ │ │ │ ├─┬ string-width@1.0.2
│ │ │ │ │ ├── code-point-at@1.1.0
│ │ │ │ │ └─┬ is-fullwidth-code-point@1.0.0
│ │ │ │ │   └── number-is-nan@1.0.1
│ │ │ │ ├─┬ strip-ansi@3.0.1
│ │ │ │ │ └── ansi-regex@2.1.1
│ │ │ │ └── wide-align@1.1.3
│ │ │ └── set-blocking@2.0.0
│ │ ├─┬ rc@1.2.8
│ │ │ ├── deep-extend@0.6.0
│ │ │ ├── ini@1.3.5
│ │ │ └── strip-json-comments@2.0.1
│ │ ├─┬ rimraf@2.6.3
│ │ │ └── glob@7.1.4
│ │ ├── semver@5.7.0
│ │ └─┬ tar@4.4.10
│ │   ├── chownr@1.1.1
│ │   ├── fs-minipass@1.2.6
│ │   ├── minipass@2.3.5
│ │   ├── minizlib@1.2.1
│ │   ├── safe-buffer@5.1.2
│ │   └── yallist@3.0.3
│ └─┬ protobufjs@5.0.3
│   ├─┬ ascli@1.0.1
│   │ ├── colour@0.7.1
│   │ └── optjs@3.2.2
│   ├─┬ bytebuffer@5.0.1
│   │ └── long@3.2.0
│   ├─┬ glob@7.1.4
│   │ ├── fs.realpath@1.0.0
│   │ ├─┬ inflight@1.0.6
│   │ │ └── wrappy@1.0.2
│   │ ├── inherits@2.0.3
│   │ ├─┬ minimatch@3.0.4
│   │ │ └─┬ brace-expansion@1.1.11
│   │ │   ├── balanced-match@1.0.0
│   │ │   └── concat-map@0.0.1
│   │ ├── once@1.4.0
│   │ └── path-is-absolute@1.0.1
│   └─┬ yargs@3.32.0
│     ├── camelcase@2.1.1
│     ├─┬ cliui@3.2.0
│     │ └── wrap-ansi@2.1.0
│     ├── decamelize@1.2.0
│     ├─┬ os-locale@1.4.0
│     │ └─┬ lcid@1.0.0
│     │   └── invert-kv@1.0.0
│     ├─┬ string-width@1.0.2
│     │ ├── code-point-at@1.1.0
│     │ └─┬ is-fullwidth-code-point@1.0.0
│     │   └── number-is-nan@1.0.1
│     ├── window-size@0.1.4
│     └── y18n@3.2.1
├─┬ jshint-stylish@2.2.1
│ ├── beeper@1.1.1
│ ├─┬ chalk@1.1.3
│ │ ├── ansi-styles@2.2.1
│ │ ├─┬ has-ansi@2.0.0
│ │ │ └── ansi-regex@2.1.1
│ │ ├── strip-ansi@3.0.1
│ │ └── supports-color@2.0.0
│ ├─┬ log-symbols@1.0.2
│ │ └─┬ chalk@1.1.3
│ │   ├── ansi-styles@2.2.1
│ │   └── supports-color@2.0.0
│ ├─┬ plur@2.1.2
│ │ └── irregular-plurals@1.4.0
│ └── string-length@1.0.1
├── lodash@4.17.15
├── minimist@1.2.0
├─┬ mocha@5.2.0
│ ├── browser-stdout@1.3.1
│ ├── commander@2.15.1
│ ├── debug@3.1.0
│ ├── diff@3.5.0
│ ├── escape-string-regexp@1.0.5
│ ├── glob@7.1.2
│ ├── growl@1.10.5
│ ├── he@1.1.1
│ └─┬ supports-color@5.4.0
│   └── has-flag@3.0.0
├─┬ mqemitter-redis@3.0.0
│ ├─┬ hyperid@1.4.1
│ │ └── uuid-parse@1.1.0
│ ├── inherits@2.0.4
│ └─┬ lru-cache@4.1.5
│   ├── pseudomap@1.0.2
│   └── yallist@2.1.2
├─┬ nats@1.3.0
│ ├── nuid@1.1.0
│ └─┬ ts-nkeys@1.0.12
│   └── tweetnacl@1.0.1
├─┬ protobufjs@6.8.8
│ ├── @protobufjs/aspromise@1.1.2
│ ├── @protobufjs/base64@1.1.2
│ ├── @protobufjs/codegen@2.0.4
│ ├── @protobufjs/eventemitter@1.1.0
│ ├── @protobufjs/fetch@1.1.0
│ ├── @protobufjs/float@1.0.2
│ ├── @protobufjs/inquire@1.1.0
│ ├── @protobufjs/path@1.1.2
│ ├── @protobufjs/pool@1.1.0
│ ├── @protobufjs/utf8@1.1.0
│ ├── @types/long@4.0.0
│ ├── @types/node@10.14.15
│ └── long@4.0.0
├─┬ redis@2.8.0
│ ├── double-ended-queue@2.1.0-0
│ ├── redis-commands@1.5.0
│ └── redis-parser@2.6.0
├─┬ request@2.88.0
│ ├── aws-sign2@0.7.0
│ ├── aws4@1.8.0
│ ├── caseless@0.12.0
│ ├─┬ combined-stream@1.0.8
│ │ └── delayed-stream@1.0.0
│ ├── extend@3.0.2
│ ├── forever-agent@0.6.1
│ ├─┬ form-data@2.3.3
│ │ └── asynckit@0.4.0
│ ├─┬ har-validator@5.1.3
│ │ ├─┬ ajv@6.10.2
│ │ │ ├── fast-deep-equal@2.0.1
│ │ │ ├── json-schema-traverse@0.4.1
│ │ │ └─┬ uri-js@4.2.2
│ │ │   └── punycode@2.1.1
│ │ └── har-schema@2.0.0
│ ├─┬ http-signature@1.2.0
│ │ ├── assert-plus@1.0.0
│ │ ├─┬ jsprim@1.4.1
│ │ │ ├── extsprintf@1.3.0
│ │ │ ├── json-schema@0.2.3
│ │ │ └── verror@1.10.0
│ │ └─┬ sshpk@1.16.1
│ │   ├── asn1@0.2.4
│ │   ├─┬ bcrypt-pbkdf@1.0.2
│ │   │ └── tweetnacl@0.14.5
│ │   ├── dashdash@1.14.1
│ │   ├── ecc-jsbn@0.1.2
│ │   ├── getpass@0.1.7
│ │   ├── jsbn@0.1.1
│ │   ├── safer-buffer@2.1.2
│ │   └── tweetnacl@0.14.5
│ ├── is-typedarray@1.0.0
│ ├── isstream@0.1.2
│ ├── json-stringify-safe@5.0.1
│ ├─┬ mime-types@2.1.24
│ │ └── mime-db@1.40.0
│ ├── oauth-sign@0.9.0
│ ├── performance-now@2.1.0
│ ├── qs@6.5.2
│ ├─┬ tough-cookie@2.4.3
│ │ ├── psl@1.3.0
│ │ └── punycode@1.4.1
│ └── tunnel-agent@0.6.0
├─┬ supertest@3.4.2
│ ├── methods@1.1.2
│ └─┬ superagent@3.8.3
│   ├── component-emitter@1.3.0
│   ├── cookiejar@2.1.2
│   ├─┬ debug@3.2.6
│   │ └── ms@2.1.2
│   ├── formidable@1.2.1
│   └── mime@1.6.0
├── toml@2.3.6
└─┬ websocket-stream@5.5.0
  ├─┬ duplexify@3.7.1
  │ └── stream-shift@1.0.0
  ├─┬ readable-stream@2.3.6
  │ ├── core-util-is@1.0.2
  │ ├── string_decoder@1.1.1
  │ └── util-deprecate@1.0.2
  ├─┬ ws@3.3.3
  │ ├── async-limiter@1.0.1
  │ └── ultron@1.1.1
  └── xtend@4.0.2

npm WARN ajv-keywords@2.1.1 requires a peer of ajv@^5.0.0 but none was installed.
</code></pre></td></tr></table>
</div>
</div><p>(通过观察编译过程，可以看出来npm的目的是为了拉取mqtt所需的一些库，查看mainflux/mqtt可进行印证。)</p>
<p>这一回在编译完除mqtt以外微服务时仍然很顺利而且很快，但是在mqtt编译的过程中报了一些警告，包括一些库弃用以及有个库缺少（最后一条警告，解决办法参见<a href="#51-%e8%a7%a3%e5%86%b3npm%e5%ae%89%e8%a3%85ajv-keywords%e7%bc%ba%e5%b0%91%e9%85%8d%e5%af%b9%e9%97%ae%e9%a2%98">5.1 解决npm安装ajv-keywords缺少配对问题</a>)，这些包弃用或者停止维护的警告暂时不管。</p>
<p>解决完npm安装依赖问题后，为了避免出现各种莫名问题，重新执行make。
执行结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ make
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-users cmd/users/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-things cmd/things/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-http cmd/http/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-normalizer cmd/normalizer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-ws cmd/ws/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-coap cmd/coap/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-lora cmd/lora/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-influxdb-writer cmd/influxdb-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-influxdb-reader cmd/influxdb-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-mongodb-writer cmd/mongodb-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-mongodb-reader cmd/mongodb-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-cassandra-writer cmd/cassandra-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-cassandra-reader cmd/cassandra-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-postgres-writer cmd/postgres-writer/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-postgres-reader cmd/postgres-reader/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-cli cmd/cli/main.go
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-bootstrap cmd/bootstrap/main.go
<span class="nb">cd</span> mqtt/aedes <span class="o">&amp;&amp;</span> npm install
up to date in 7.374s

┌─────────────────────────────────────────────────────────┐
│                 npm update check failed                 │
│           Try running with sudo or get access           │
│          to the <span class="nb">local</span> update config store via           │
│ sudo chown -R <span class="nv">$USER</span>:<span class="k">$(</span>id -gn <span class="nv">$USER</span><span class="k">)</span> /home/eiger/.config │
└─────────────────────────────────────────────────────────┘
</code></pre></td></tr></table>
</div>
</div><p>好了，这回又提示说npm更新检查失败，需要sudo权限或者将当前用户提升权限。</p>
<p>先试下<code>sudo make</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo make
<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span> <span class="nv">GOARCH</span><span class="o">=</span>amd64 <span class="nv">GOARM</span><span class="o">=</span> go build -ldflags <span class="s2">&#34;-s -w&#34;</span> -o build/mainflux-users cmd/users/main.go
/bin/sh: 1: go: not found
Makefile:72: recipe <span class="k">for</span> target <span class="s1">&#39;users&#39;</span> failed
make: *** <span class="o">[</span>users<span class="o">]</span> Error <span class="m">127</span>
</code></pre></td></tr></table>
</div>
</div><p>报错说找不到go命令……这很不科学，在installUbuntu.md文件中安装go环境已确定设置好系统变量……</p>
<p>尝试第二种方法：<code>sudo chown -R $USER:$(id -gn $USER) /home/eiger/.config</code>，没有报错，再执行<code>make</code>，完美通过！！！</p>
<p><strong>注意： make命令执行成功后，所有编译结果都在/mainflux/build下，为若干个可执行程序。他们之间是静态链接库的关系，可以根据需要移动、部署，他们不再依赖其他系统的、外部的依赖，方便容器化部署。</strong></p>
<h3 id="43-编译单个微服务">4.3. 编译单个微服务</h3>
<p>执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">make &lt;microservice_name&gt;  <span class="c1">## 例如make http将会编译http适配器服务</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="44-编译dockers">4.4. 编译dockers</h3>
<p>执行到这一步时，才想起需要安装docker，因此参照<a href="#6-%e5%ae%89%e8%a3%85docker">6 安装docker ce</a>安装好docker ce。</p>
<ul>
<li>
<p>一次性编译所有dockers：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">make dockers
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>编译单个docker：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">make docker_&lt;microservice_name&gt;  <span class="c1">## 例如make docker_http</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>这里只记录 <code>make dockers</code>的过程:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ make dockers
docker build --no-cache --build-arg <span class="nv">SVC</span><span class="o">=</span>users --build-arg <span class="nv">GOARCH</span><span class="o">=</span>amd64 --build-arg <span class="nv">GOARM</span><span class="o">=</span> --tag<span class="o">=</span>mainflux/users-amd64 -f docker/Dockerfile .
ERRO<span class="o">[</span>0000<span class="o">]</span> failed to dial gRPC: cannot connect to the Docker daemon. Is <span class="s1">&#39;docker daemon&#39;</span> running on this host?: dial unix /var/run/docker.sock: connect: permission denied
Got permission denied <span class="k">while</span> trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Post http://%2Fvar%2Frun%2Fdocker.sock/v1.40/build?buildargs<span class="o">=</span>%7B%22GOARCH%22%3A%22amd64%22%2C%22GOARM%22%3A%22%22%2C%22SVC%22%3A%22users%22%7D<span class="p">&amp;</span><span class="nv">cachefrom</span><span class="o">=</span>%5B%5D<span class="p">&amp;</span><span class="nv">cgroupparent</span><span class="o">=</span><span class="p">&amp;</span><span class="nv">cpuperiod</span><span class="o">=</span>0<span class="p">&amp;</span><span class="nv">cpuquota</span><span class="o">=</span>0<span class="p">&amp;</span><span class="nv">cpusetcpus</span><span class="o">=</span><span class="p">&amp;</span><span class="nv">cpusetmems</span><span class="o">=</span><span class="p">&amp;</span><span class="nv">cpushares</span><span class="o">=</span>0<span class="p">&amp;</span><span class="nv">dockerfile</span><span class="o">=</span>docker%2FDockerfile<span class="p">&amp;</span><span class="nv">labels</span><span class="o">=</span>%7B%7D<span class="p">&amp;</span><span class="nv">memory</span><span class="o">=</span>0<span class="p">&amp;</span><span class="nv">memswap</span><span class="o">=</span>0<span class="p">&amp;</span><span class="nv">networkmode</span><span class="o">=</span>default<span class="p">&amp;</span><span class="nv">nocache</span><span class="o">=</span>1<span class="p">&amp;</span><span class="nv">rm</span><span class="o">=</span>1<span class="p">&amp;</span><span class="nv">session</span><span class="o">=</span>30vy9rez3a6gmk08ou65zek32<span class="p">&amp;</span><span class="nv">shmsize</span><span class="o">=</span>0<span class="p">&amp;</span><span class="nv">t</span><span class="o">=</span>mainflux%2Fusers-amd64<span class="p">&amp;</span><span class="nv">target</span><span class="o">=</span><span class="p">&amp;</span><span class="nv">ulimits</span><span class="o">=</span>null<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span>1: dial unix /var/run/docker.sock: connect: permission denied
Makefile:75: recipe <span class="k">for</span> target <span class="s1">&#39;docker_users&#39;</span> failed
make: *** <span class="o">[</span>docker_users<span class="o">]</span> Error <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><p>显然，这是权限不足的问题，虽然很奇怪，为什么添加了eiger到docker用户组还会这样，但不管了，加上<code>sudo</code>再试一次：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo make dockers
</code></pre></td></tr></table>
</div>
</div><p>这回开始编译了，但是编译过程极为漫长！毕竟是二十来个docker镜像需要编译。这部分注意对照Makefile并观察编译过程。</p>
<p>问题又出现了！在编译至docker_ui时报了个错：拉取一个依赖包失败，具体看下面的输出。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">Successfully tagged mainflux/bootstrap-amd64:latest
make -C ui docker
make<span class="o">[</span>1<span class="o">]</span>: Entering directory <span class="s1">&#39;/home/eiger/gopath-default/src/github.com/mainflux/mainflux/ui&#39;</span>
docker build --tag<span class="o">=</span>mainflux/ui-amd64 -f docker/Dockerfile .
Sending build context to Docker daemon  113.2kB
Step 1/13 : FROM node:10.15.1-alpine as builder
 ---&gt; fe6ff768f798
Step 2/13 : WORKDIR /app
 ---&gt; Using cache
 ---&gt; b0c156339fd9
Step 3/13 : RUN npm install --unsafe-perm<span class="o">=</span><span class="nb">true</span> --allow-root -g elm
 ---&gt; Running in 80d5a8d6f74a
/usr/local/bin/elm -&gt; /usr/local/lib/node_modules/elm/bin/elm

&gt; elm@0.19.0-no-deps install /usr/local/lib/node_modules/elm
&gt; node install.js

+ elm@0.19.0-no-deps
added <span class="m">1</span> package from <span class="m">1</span> contributor in 566.006s
Removing intermediate container 80d5a8d6f74a
 ---&gt; 941e189101bf
Step 4/13 : COPY . /app
 ---&gt; 776802a00b76
Step 5/13 : RUN elm make --optimize src/Main.elm --output<span class="o">=</span>main.js
 ---&gt; Running in 216a675c55ec
-- HTTP PROBLEM ----------------------------------------------------------------

The following HTTP request failed:

    &lt;https://github.com/avh4/elm-color/zipball/1.0.0/&gt;

Here is the error message I was able to extract:

    HttpExceptionRequest Request <span class="o">{</span> <span class="nv">host</span> <span class="o">=</span> <span class="s2">&#34;github.com&#34;</span> <span class="nv">port</span> <span class="o">=</span> <span class="m">443</span> <span class="nv">secure</span> <span class="o">=</span> True
    <span class="nv">requestHeaders</span> <span class="o">=</span> <span class="o">[(</span><span class="s2">&#34;User-Agent&#34;</span>,<span class="s2">&#34;elm/0.19.0&#34;</span><span class="o">)</span>,<span class="o">(</span><span class="s2">&#34;Accept-Encoding&#34;</span>,<span class="s2">&#34;gzip&#34;</span><span class="o">)]</span>
    <span class="nv">path</span> <span class="o">=</span> <span class="s2">&#34;/avh4/elm-color/zipball/1.0.0/&#34;</span> <span class="nv">queryString</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="nv">method</span> <span class="o">=</span> <span class="s2">&#34;GET&#34;</span>
    <span class="nv">proxy</span> <span class="o">=</span> Nothing <span class="nv">rawBody</span> <span class="o">=</span> False <span class="nv">redirectCount</span> <span class="o">=</span> <span class="m">10</span> <span class="nv">responseTimeout</span> <span class="o">=</span>
    ResponseTimeoutDefault <span class="nv">requestVersion</span> <span class="o">=</span> HTTP/1.1 <span class="o">}</span> ConnectionTimeout

Starting downloads...

  ● elm/http 2.0.0
  ● elm/file 1.0.1
  ● elm/json 1.1.2
  ● elm/html 1.0.0
  ● elm/bytes 1.0.7
  ● elm/url 1.0.0
  ● elm/virtual-dom 1.0.2
  ✗ avh4/elm-color 1.0.0
  ● elm-community/list-extra 8.1.0
  ● elm/core 1.0.2
  ● elm/time 1.0.0
  ● elm/browser 1.0.1
  ● rundis/elm-bootstrap 5.0.0

The <span class="nb">command</span> <span class="s1">&#39;/bin/sh -c elm make --optimize src/Main.elm --output=main.js&#39;</span> returned a non-zero code: <span class="m">1</span>
Makefile:18: recipe <span class="k">for</span> target <span class="s1">&#39;docker&#39;</span> failed
make<span class="o">[</span>1<span class="o">]</span>: *** <span class="o">[</span>docker<span class="o">]</span> Error <span class="m">1</span>
make<span class="o">[</span>1<span class="o">]</span>: Leaving directory <span class="s1">&#39;/home/eiger/gopath-default/src/github.com/mainflux/mainflux/ui&#39;</span>
Makefile:81: recipe <span class="k">for</span> target <span class="s1">&#39;docker_ui&#39;</span> failed
make: *** <span class="o">[</span>docker_ui<span class="o">]</span> Error <span class="m">2</span>
</code></pre></td></tr></table>
</div>
</div><p>由于是半夜放在那让它编译，所以不确定是不是网络出问题还是别的原因。</p>
<p><strong>注意： 这时候千万别重新执行<code>sudo make dockers</code>! 注意编译这些docker镜像时：1.每次执行make都会覆盖原本，重新编译，并不会减少编译所需时间；2.容器内数据没有持久化，如果容器内产生了生产数据，重新编译后将全部丢失！</strong></p>
<p>那么现在来看下Makefile，可以看出在dockers中，docker_ui和docker_mqtt是两个特殊的存在，从编译过程来看可能是因为这两部分用到了nodejs的一些库。而在编译dockers的顺序中docker_ui和docker_mqtt是最后编译的，也就是说，在上一步<code>sudo make dockers</code>过程中已经编译了docker_ui之前的所有镜像，所以接下来只需要单独编译docker_ui和docker_mqtt：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo make docker_ui  <span class="c1">## 这回没有出错，说明晚上可能是因为网络不佳而出错的</span>
sudo make docker_mqtt
</code></pre></td></tr></table>
</div>
</div><p>在编译docker_mqtt的时候虽然最后显示成功了，但是中间报了如下错误：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">Step 3/5 : RUN npm rebuild <span class="o">&amp;&amp;</span> npm install
 ---&gt; Running in 1ffb877f0a26

&gt; protobufjs@6.8.8 postinstall /node_modules/protobufjs
&gt; node scripts/postinstall


&gt; grpc@1.22.2 install /node_modules/grpc
&gt; node-pre-gyp install --fallback-to-build --library<span class="o">=</span>static_library

node-pre-gyp WARN Using request <span class="k">for</span> node-pre-gyp https download
<span class="o">[</span>grpc<span class="o">]</span> Success: <span class="s2">&#34;/node_modules/grpc/src/node/extension_binary/node-v64-linux-x64-musl/grpc_node.node&#34;</span> is installed via remote

&gt; dtrace-provider@0.8.7 install /node_modules/dtrace-provider
&gt; node-gyp rebuild <span class="o">||</span> node suppress-error.js

gyp ERR! configure error
gyp ERR! stack Error: Can<span class="err">&#39;</span>t find Python executable <span class="s2">&#34;python&#34;</span>, you can <span class="nb">set</span> the PYTHON env variable.
gyp ERR! stack     at PythonFinder.failNoPython <span class="o">(</span>/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:484:19<span class="o">)</span>
gyp ERR! stack     at PythonFinder.&lt;anonymous&gt; <span class="o">(</span>/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:406:16<span class="o">)</span>
gyp ERR! stack     at F <span class="o">(</span>/usr/local/lib/node_modules/npm/node_modules/which/which.js:68:16<span class="o">)</span>
gyp ERR! stack     at E <span class="o">(</span>/usr/local/lib/node_modules/npm/node_modules/which/which.js:80:29<span class="o">)</span>
gyp ERR! stack     at /usr/local/lib/node_modules/npm/node_modules/which/which.js:89:16
gyp ERR! stack     at /usr/local/lib/node_modules/npm/node_modules/isexe/index.js:42:5
gyp ERR! stack     at /usr/local/lib/node_modules/npm/node_modules/isexe/mode.js:8:5
gyp ERR! stack     at FSReqWrap.oncomplete <span class="o">(</span>fs.js:154:21<span class="o">)</span>
gyp ERR! System Linux 4.15.0-55-generic
gyp ERR! <span class="nb">command</span> <span class="s2">&#34;/usr/local/bin/node&#34;</span> <span class="s2">&#34;/usr/local/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js&#34;</span> <span class="s2">&#34;rebuild&#34;</span>
gyp ERR! cwd /node_modules/dtrace-provider
gyp ERR! node -v v10.15.1
gyp ERR! node-gyp -v v3.8.0
gyp ERR! not ok
2@1.0.2 /node_modules/2
@grpc/proto-loader@0.5.1 /node_modules/@grpc/proto-loader
lodash.camelcase@4.3.0 /node_modules/lodash.camelcase
protobufjs@6.8.8 /node_modules/protobufjs
@protobufjs/aspromise@1.1.2 /node_modules/@protobufjs/aspromise
@protobufjs/base64@1.1.2 /node_modules/@protobufjs/base64
@protobufjs/codegen@2.0.4 /node_modules/@protobufjs/codegen
@protobufjs/eventemitter@1.1.0 /node_modules/@protobufjs/eventemitter
@protobufjs/fetch@1.1.0 /node_modules/@protobufjs/fetch
@protobufjs/inquire@1.1.0 /node_modules/@protobufjs/inquire
@protobufjs/float@1.0.2 /node_modules/@protobufjs/float
@protobufjs/path@1.1.2 /node_modules/@protobufjs/path
@protobufjs/pool@1.1.0 /node_modules/@protobufjs/pool
@protobufjs/utf8@1.1.0 /node_modules/@protobufjs/utf8
</code></pre></td></tr></table>
</div>
</div><p>参照<a href="#52-%e8%a7%a3%e5%86%b3node-gyp%e6%8f%90%e7%a4%ba%e6%89%be%e4%b8%8d%e5%88%b0python">session 5.2 解决gyp找不到python</a>重新执行<code>sudo make docker_mqtt</code>，这回没有任何报错信息。</p>
<p>至此，所有docker编译成功。</p>
<p>列出docker镜像来看下我们编译的结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker images
REPOSITORY                        TAG                 IMAGE ID            CREATED             SIZE
mainflux/mqtt-amd64               latest              63c2335da152        <span class="m">47</span> minutes ago      177MB
mainflux/ui-amd64                 latest              56818963b563        About an hour ago   16.4MB
&lt;none&gt;                            &lt;none&gt;              c236d4a2ba3a        About an hour ago   127MB
mainflux/bootstrap-amd64          latest              2d6bf08877ff        <span class="m">11</span> hours ago        11.5MB
&lt;none&gt;                            &lt;none&gt;              a34d0a5ecd02        <span class="m">11</span> hours ago        413MB
mainflux/cli-amd64                latest              9a95ca2d5e58        <span class="m">11</span> hours ago        7.39MB
&lt;none&gt;                            &lt;none&gt;              74eb37c632e4        <span class="m">11</span> hours ago        396MB
mainflux/postgres-reader-amd64    latest              0da4b651447e        <span class="m">11</span> hours ago        10.4MB
&lt;none&gt;                            &lt;none&gt;              165376436de3        <span class="m">11</span> hours ago        408MB
mainflux/postgres-writer-amd64    latest              ca8dc5c8357c        <span class="m">11</span> hours ago        10.2MB
&lt;none&gt;                            &lt;none&gt;              f4e8dbb870ba        <span class="m">11</span> hours ago        406MB
mainflux/cassandra-reader-amd64   latest              a9abfb5cc14f        <span class="m">11</span> hours ago        10.4MB
&lt;none&gt;                            &lt;none&gt;              db7ad32ad5aa        <span class="m">11</span> hours ago        408MB
mainflux/cassandra-writer-amd64   latest              b9017e5c7bf7        <span class="m">11</span> hours ago        10.2MB
&lt;none&gt;                            &lt;none&gt;              9afe59452890        <span class="m">11</span> hours ago        406MB
mainflux/mongodb-reader-amd64     latest              83312eb43d4e        <span class="m">12</span> hours ago        13.2MB
&lt;none&gt;                            &lt;none&gt;              8b2fa37acfc8        <span class="m">12</span> hours ago        417MB
mainflux/mongodb-writer-amd64     latest              c2c20ded7746        <span class="m">12</span> hours ago        13MB
&lt;none&gt;                            &lt;none&gt;              26c81879092f        <span class="m">12</span> hours ago        415MB
mainflux/influxdb-reader-amd64    latest              602cca6b16df        <span class="m">12</span> hours ago        9.64MB
&lt;none&gt;                            &lt;none&gt;              87ab23218a98        <span class="m">12</span> hours ago        405MB
mainflux/influxdb-writer-amd64    latest              8291fcbf79c7        <span class="m">12</span> hours ago        9.57MB
&lt;none&gt;                            &lt;none&gt;              e679ddd44034        <span class="m">12</span> hours ago        403MB
mainflux/lora-amd64               latest              6ad78c136202        <span class="m">12</span> hours ago        10.5MB
&lt;none&gt;                            &lt;none&gt;              63535273c007        <span class="m">12</span> hours ago        408MB
mainflux/coap-amd64               latest              436fb919b3ef        <span class="m">12</span> hours ago        10.5MB
&lt;none&gt;                            &lt;none&gt;              91608629e556        <span class="m">12</span> hours ago        408MB
mainflux/ws-amd64                 latest              ea32ef946286        <span class="m">12</span> hours ago        10.6MB
&lt;none&gt;                            &lt;none&gt;              b042f0b98333        <span class="m">12</span> hours ago        408MB
mainflux/normalizer-amd64         latest              f457472beb17        <span class="m">12</span> hours ago        12.1MB
&lt;none&gt;                            &lt;none&gt;              95bf7a83f966        <span class="m">12</span> hours ago        413MB
mainflux/http-amd64               latest              e9c5e8cca6d2        <span class="m">12</span> hours ago        10.5MB
&lt;none&gt;                            &lt;none&gt;              19d20eb17af4        <span class="m">12</span> hours ago        407MB
mainflux/things-amd64             latest              6b91b8561a30        <span class="m">12</span> hours ago        11.7MB
&lt;none&gt;                            &lt;none&gt;              f1a3ac2c5c0f        <span class="m">12</span> hours ago        414MB
mainflux/users-amd64              latest              64a299ad8ed2        <span class="m">12</span> hours ago        10.6MB
&lt;none&gt;                            &lt;none&gt;              6779422f65aa        <span class="m">12</span> hours ago        408MB
&lt;none&gt;                            &lt;none&gt;              3b90edcfdee8        <span class="m">13</span> hours ago        11.5MB
&lt;none&gt;                            &lt;none&gt;              d53f0f373e9a        <span class="m">13</span> hours ago        413MB
&lt;none&gt;                            &lt;none&gt;              a9ff9908ae2e        <span class="m">13</span> hours ago        7.39MB
&lt;none&gt;                            &lt;none&gt;              1408f062a173        <span class="m">13</span> hours ago        396MB
&lt;none&gt;                            &lt;none&gt;              d895327d99cf        <span class="m">13</span> hours ago        10.4MB
&lt;none&gt;                            &lt;none&gt;              c17ffbb16c9e        <span class="m">13</span> hours ago        408MB
&lt;none&gt;                            &lt;none&gt;              0509f73463dd        <span class="m">13</span> hours ago        406MB
&lt;none&gt;                            &lt;none&gt;              e4853e5a8454        <span class="m">13</span> hours ago        10.2MB
&lt;none&gt;                            &lt;none&gt;              f7b9418c6859        <span class="m">13</span> hours ago        10.4MB
&lt;none&gt;                            &lt;none&gt;              fbc4d84e0341        <span class="m">13</span> hours ago        408MB
&lt;none&gt;                            &lt;none&gt;              b56da15d0023        <span class="m">13</span> hours ago        10.2MB
&lt;none&gt;                            &lt;none&gt;              003f0c53afa6        <span class="m">13</span> hours ago        406MB
&lt;none&gt;                            &lt;none&gt;              8b7bb39a178e        <span class="m">13</span> hours ago        13.2MB
&lt;none&gt;                            &lt;none&gt;              ef263981d942        <span class="m">13</span> hours ago        417MB
&lt;none&gt;                            &lt;none&gt;              1c0438894bf9        <span class="m">13</span> hours ago        13MB
&lt;none&gt;                            &lt;none&gt;              c51b3153d7b4        <span class="m">13</span> hours ago        415MB
&lt;none&gt;                            &lt;none&gt;              1d9fac869f57        <span class="m">13</span> hours ago        9.64MB
&lt;none&gt;                            &lt;none&gt;              333ace195d78        <span class="m">13</span> hours ago        405MB
&lt;none&gt;                            &lt;none&gt;              52fb3e85a3ab        <span class="m">13</span> hours ago        403MB
&lt;none&gt;                            &lt;none&gt;              00d991f250ca        <span class="m">13</span> hours ago        9.57MB
&lt;none&gt;                            &lt;none&gt;              0a28b98875f6        <span class="m">13</span> hours ago        408MB
&lt;none&gt;                            &lt;none&gt;              0802b11f9713        <span class="m">13</span> hours ago        10.5MB
&lt;none&gt;                            &lt;none&gt;              cabad6622c1e        <span class="m">13</span> hours ago        10.5MB
&lt;none&gt;                            &lt;none&gt;              c456e667acec        <span class="m">13</span> hours ago        408MB
&lt;none&gt;                            &lt;none&gt;              51f696d2c560        <span class="m">13</span> hours ago        10.6MB
&lt;none&gt;                            &lt;none&gt;              500e4e234111        <span class="m">13</span> hours ago        408MB
&lt;none&gt;                            &lt;none&gt;              c23c3e97f79d        <span class="m">13</span> hours ago        12.1MB
&lt;none&gt;                            &lt;none&gt;              8dc2bee947c6        <span class="m">13</span> hours ago        413MB
&lt;none&gt;                            &lt;none&gt;              dc9be8714e78        <span class="m">13</span> hours ago        10.5MB
&lt;none&gt;                            &lt;none&gt;              3958271baf61        <span class="m">13</span> hours ago        407MB
&lt;none&gt;                            &lt;none&gt;              f8688db1c91b        <span class="m">13</span> hours ago        11.7MB
&lt;none&gt;                            &lt;none&gt;              7060288201c9        <span class="m">13</span> hours ago        414MB
&lt;none&gt;                            &lt;none&gt;              1c11e7c44a0b        <span class="m">13</span> hours ago        10.6MB
&lt;none&gt;                            &lt;none&gt;              31ed21e0c9da        <span class="m">13</span> hours ago        408MB
nginx                             1.14.2-alpine       8a2fb25a19f5        <span class="m">4</span> months ago        16MB
golang                            1.10-alpine         7b53e4a31d21        <span class="m">6</span> months ago        259MB
node                              10.15.1-alpine      fe6ff768f798        <span class="m">6</span> months ago        70.7MB
hello-world                       latest              fce289e99eb9        <span class="m">7</span> months ago        1.84kB

</code></pre></td></tr></table>
</div>
</div><p>可以看到有很多<code>&lt;none&gt;</code>的镜像，处理方式参见<a href="#61-none%e9%95%9c%e5%83%8f%e7%9a%84%e5%a4%84%e7%90%86">6.1 <code>&lt;none&gt;</code>镜像处理</a></p>
<p>处理输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker image prune
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> eiger:
WARNING! This will remove all dangling images.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
Deleted Images:
......<span class="o">(</span>省略<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>处理好<code>&lt;none&gt;</code>镜像之后，再列一下当前docker镜像：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker images
REPOSITORY                        TAG                 IMAGE ID            CREATED             SIZE
mainflux/mqtt-amd64               latest              63c2335da152        About an hour ago   177MB
mainflux/ui-amd64                 latest              56818963b563        About an hour ago   16.4MB
&lt;none&gt;                            &lt;none&gt;              776802a00b76        <span class="m">11</span> hours ago        119MB
mainflux/bootstrap-amd64          latest              2d6bf08877ff        <span class="m">11</span> hours ago        11.5MB
mainflux/cli-amd64                latest              9a95ca2d5e58        <span class="m">12</span> hours ago        7.39MB
mainflux/postgres-reader-amd64    latest              0da4b651447e        <span class="m">12</span> hours ago        10.4MB
mainflux/postgres-writer-amd64    latest              ca8dc5c8357c        <span class="m">12</span> hours ago        10.2MB
mainflux/cassandra-reader-amd64   latest              a9abfb5cc14f        <span class="m">12</span> hours ago        10.4MB
mainflux/cassandra-writer-amd64   latest              b9017e5c7bf7        <span class="m">12</span> hours ago        10.2MB
mainflux/mongodb-reader-amd64     latest              83312eb43d4e        <span class="m">12</span> hours ago        13.2MB
mainflux/mongodb-writer-amd64     latest              c2c20ded7746        <span class="m">12</span> hours ago        13MB
mainflux/influxdb-reader-amd64    latest              602cca6b16df        <span class="m">12</span> hours ago        9.64MB
mainflux/influxdb-writer-amd64    latest              8291fcbf79c7        <span class="m">12</span> hours ago        9.57MB
mainflux/lora-amd64               latest              6ad78c136202        <span class="m">12</span> hours ago        10.5MB
mainflux/coap-amd64               latest              436fb919b3ef        <span class="m">12</span> hours ago        10.5MB
mainflux/ws-amd64                 latest              ea32ef946286        <span class="m">12</span> hours ago        10.6MB
mainflux/normalizer-amd64         latest              f457472beb17        <span class="m">12</span> hours ago        12.1MB
mainflux/http-amd64               latest              e9c5e8cca6d2        <span class="m">12</span> hours ago        10.5MB
mainflux/things-amd64             latest              6b91b8561a30        <span class="m">13</span> hours ago        11.7MB
mainflux/users-amd64              latest              64a299ad8ed2        <span class="m">13</span> hours ago        10.6MB
nginx                             1.14.2-alpine       8a2fb25a19f5        <span class="m">4</span> months ago        16MB
golang                            1.10-alpine         7b53e4a31d21        <span class="m">6</span> months ago        259MB
node                              10.15.1-alpine      fe6ff768f798        <span class="m">6</span> months ago        70.7MB
hello-world                       latest              fce289e99eb9        <span class="m">7</span> months ago        1.84kB
</code></pre></td></tr></table>
</div>
</div><p>注意：这里所列出的镜像，除了hello-world其他都是mainflux容器编译的产物！（golang/nginx/node应该是编译过程中拉取的。）</p>
<p>最后，再次提示，重新进行任何的docker的编译都将完全覆盖原本docker！！！谨慎进行任何编译操作！！！</p>
<h3 id="45-其他docker安装相关">4.5. 其他docker安装相关</h3>
<p>关于编译开发版本docker、覆盖原本docker-compose配置、清除mainflux容器安装，参见mainflux官方说明：
&lt;mainflux.readthedocs.io/en/latest/dev-guide&gt;</p>
<h3 id="46-mqtt微服务">4.6. mqtt微服务</h3>
<p>前边在编译所有微服务一节，输出信息中得到编译mqtt服务操作<code>cd mqtt/aedes &amp;&amp; npm install</code>。</p>
<p>但奇怪的是在官方说明中又给出如下说明：
mqtt微服务基于nodejs编写，并未被编译（大概意指在编译微服务一节并未将其编译）。且为了启动mqtt服务，需要下载相应的node_modules。</p>
<p>下载node_modules指令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> mqtt
npm install
</code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ <span class="nb">cd</span> mqtt
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux/mqtt$ ls
aedes  verne
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux/mqtt$ sudo npm install
npm WARN saveError ENOENT: no such file or directory, open <span class="s1">&#39;/home/eiger/gopath-default/src/github.com/mainflux/mainflux/package.json&#39;</span>
npm WARN enoent ENOENT: no such file or directory, open <span class="s1">&#39;/home/eiger/gopath-default/src/github.com/mainflux/mainflux/package.json&#39;</span>
npm WARN mainflux No description
npm WARN mainflux No repository field.
npm WARN mainflux No README data
npm WARN mainflux No license field.

audited <span class="m">12</span> packages in 6.277s
found <span class="m">0</span> vulnerabilities
</code></pre></td></tr></table>
</div>
</div><p>看上去应该是官方文档在此处出错了，应该是cd mqtt/aedes。那么这样我们其实前边已经安装好了。</p>
<p>官方文档又提到，它提供了<code>make mqtt</code>这句命令来作为前面两句操作的短名。也就是说，我们在前面使用<code>make</code>编译所有微服务的最后，完成了mqtt中node_modules的安装。</p>
<p>那么，启动mqtt的方法为：在/mainflux项目根目录下（因为需要找到根目录下的*.proto文件），执行以下命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">node mqtt/mqtt.js
</code></pre></td></tr></table>
</div>
</div><p>其实这里也是有问题的，因为mqtt.js在mqtt/aedes下，所以我们改为<code>node mqtt/aedes/mqtt.js</code></p>
<h3 id="47-其他">4.7. 其他</h3>
<p>关于.proto文件修改后重新编译以及arm平台（树莓派就是arm架构的）的交叉编译，参看官方说明，<a href="#45-%e5%85%b6%e4%bb%96docker%e5%ae%89%e8%a3%85%e7%9b%b8%e5%85%b3">4.5 其他docker安装相关</a>已给出。</p>
<h2 id="5-安装nodejs和npm">5. 安装node.js和npm</h2>
<p>终端输入：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt install nodejs
sudo apt install npm
</code></pre></td></tr></table>
</div>
</div><p>我所安装的版本分别为nodejs v8.10.0和npm v3.5.2</p>
<h3 id="51-解决npm安装ajv-keywords缺少配对问题">5.1. 解决npm安装ajv-keywords缺少配对问题</h3>
<p>问题描述：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">npm WARN ajv-keywords@2.1.1 requires a peer of ajv@^5.0.0 but none was installed.
</code></pre></td></tr></table>
</div>
</div><p>解决办法：</p>
<ol>
<li>
<p>先执行以下两句更新完软件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo npm install -g npm-install-peers
sudo npm install -g npm  <span class="c1">## 更新npm</span>
</code></pre></td></tr></table>
</div>
</div><p>执行到此处时，npm版本为v6.10.3，npm-install-peers版本为v1.2.1</p>
</li>
<li>
<p>再执行:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo npm i ajv
</code></pre></td></tr></table>
</div>
</div><p>(ps: i为install短名)</p>
<p>执行结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo npm i ajv
npm WARN saveError ENOENT: no such file or directory, open <span class="s1">&#39;/home/eiger/gopath-default/src/github.com/mainflux/mainflux/package.json&#39;</span>
npm notice created a lockfile as package-lock.json. You should commit this file.
npm WARN enoent ENOENT: no such file or directory, open <span class="s1">&#39;/home/eiger/gopath-default/src/github.com/mainflux/mainflux/package.json&#39;</span>
npm WARN mainflux No description
npm WARN mainflux No repository field.
npm WARN mainflux No README data
npm WARN mainflux No license field.

+ ajv@6.10.2
added <span class="m">6</span> packages from <span class="m">4</span> contributors and audited <span class="m">6</span> packages in 8.557s
found <span class="m">0</span> vulnerabilities

</code></pre></td></tr></table>
</div>
</div><p>从警告描述上可以看出是说，当前目录下没有package.json等文件。再联系到<a href="#42-%e7%bc%96%e8%af%91%e6%89%80%e6%9c%89%e6%9c%8d%e5%8a%a1">4.2 编译所有服务</a>遇到此问题时是安装mqtt部分出问题，因此在/mainflux/mqtt/aedes文件下发现了警告中要求的package等诸项文件。因此应当切换到此目录下再安装ajv：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> mqtt/aedes
sudo npm i ajv

</code></pre></td></tr></table>
</div>
</div><p>执行结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux/mqtt/aedes$ sudo npm i ajv
npm notice created a lockfile as package-lock.json. You should commit this file.
npm WARN ajv-keywords@2.1.1 requires a peer of ajv@^5.0.0 but none is installed. You must install peer dependencies yourself.

+ ajv@6.10.2
updated <span class="m">1</span> package and audited <span class="m">985</span> packages in 5.685s
found <span class="m">0</span> vulnerabilities

</code></pre></td></tr></table>
</div>
</div><p>从警告中看出，要求ajv@^5.0.0（ps: ^会匹配大版本下的所有依赖包，也就是说只要是ajv@5.x.x都可以），但是安装了ajv@6.10.2。</p>
<p>也就是说，我们需要手动安装ajv@5.x.x版本。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux/mqtt/aedes$ sudo npm i ajv@^5.0.0
+ ajv@5.5.2
added <span class="m">3</span> packages from <span class="m">1</span> contributor, updated <span class="m">3</span> packages and audited <span class="m">984</span> packages in 10.349s
found <span class="m">0</span> vulnerabilities
</code></pre></td></tr></table>
</div>
</div><p>现在就没有问题了。</p>
</li>
</ol>
<h3 id="52-解决node-gyp提示找不到python">5.2. 解决node-gyp提示找不到python</h3>
<p>在<a href="#44-%e7%bc%96%e8%af%91dockers">4.4 编译dockers</a>编译docker_mqtt遇到了node-gyp提示找不到python而rebuild失败的错误，并给出了一堆的报错信息。从中我们看出，node-gyp这个组件在配置时出错，提示找不到python可执行文件，建议设置python环境变量PYTHON指向其执行文件。此时本机上经过检查，已安装有python2.7.15+和python3.6.8。</p>
<p>经过百度“node-gyp提示找不到python”获取到一些信息：npm只支持pthon2.7，不支持python3。网上的解决方案多是在npm install包失败提示该错误时指定参数<code>npm install --python=python2.7</code>，但是我的情况是python2.7已经有了，如何指定PYTHON版本的问题。先不设置PYTHON变量，我们去看下报错中的这个配置文件<code>/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:484:19</code>打开后发现只有380行……</p>
<p>不管了，再来看看node-gyp这个插件的官方说明<a href="https://github.com/nodejs/node-gyp">https://github.com/nodejs/node-gyp</a>，先按照上面的说明进行一次完整安装。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ sudo npm install -g node-gyp
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> eiger:
/usr/local/bin/node-gyp -&gt; /usr/local/lib/node_modules/node-gyp/bin/node-gyp.js
+ node-gyp@5.0.3
added <span class="m">98</span> packages from <span class="m">67</span> contributors in 92.347s
</code></pre></td></tr></table>
</div>
</div><p>在node-gyp官方安装说明中指出还需要安装python2.7、make、gcc，这些在我的电脑上都已安装了（自带python2.7，安装build-essential）。</p>
<p>在官方文档中特别指出了：如果电脑上安装有多个版本的python（正是我的电脑目前的情况），需要配置python版本。配置方法：</p>
<ol>
<li>
<p>追加参数方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">node-gyp --python /path/to/python2.7
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>如果node-gyp是被npm调用的，且电脑上有多个版本python， 可以设置npm的‘python’配置键为合适的值：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">npm config <span class="nb">set</span> python /path/to/executable/python2.7
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>看上去第二种方案是我需要的。现在解释下为什么不愿意直接在系统级或者用户级设置<code>PYTHON</code>变量，因为像npm这种只支持python2的奇葩还是少数，担心影响到以后其他依赖python的程序。好了，现在尝试按照上面第二种方法为npm设置python路径。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ whereis python  <span class="c1">## whereis命令</span>
python: /usr/bin/python /usr/bin/python2.7 /usr/bin/python3.6 /usr/bin/python3.6m /usr/lib/python2.7 /usr/lib/python3.6 /usr/lib/python3.7 /etc/python /etc/python2.7 /etc/python3.6 /usr/local/lib/python2.7 /usr/local/lib/python3.6 /usr/include/python3.6m /usr/share/python /usr/share/man/man1/python.1.gz
</code></pre></td></tr></table>
</div>
</div><p>得到python2.7执行路径<code>/usr/bin/python2.7</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">npm config <span class="nb">set</span> python /usr/bin/python2.7
</code></pre></td></tr></table>
</div>
</div><p>现在npm应该可以正常rebuild了（出错是因为找不到python来满足rebuild依赖）</p>
<h2 id="6-安装docker">6. 安装Docker</h2>
<ol>
<li>
<p>更新国内软件源（在installUbuntu.md已完成相关步骤），这里给出网上修改为中科大镜像源的步骤：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
sudo sed -i <span class="s1">&#39;s/archive.ubuntu.com/mirrors.ustc.edu.cn/g&#39;</span> /etc/apt/sources.list
sudo apt update
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>安装需要的依赖包</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt install apt-transport-https ca-certificates software-properties-common curl
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>添加 GPG 密钥，并添加 Docker-ce 软件源，这里还是以中国科技大学的 Docker-ce 源为例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg <span class="p">|</span> sudo apt-key add -
sudo add-apt-repository <span class="s2">&#34;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>(ps: 这里我仍使用的是清华镜像源，即将ustc替换为tuna.tsinghua，这并不影响什么。)</p>
</li>
<li>
<p>添加成功后更新软件包缓存</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt update
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>安装 Docker-ce</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt install docker-ce
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>设置开机自启动并启动 Docker-ce（安装成功后默认已设置并启动，可忽略）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo systemctl <span class="nb">enable</span> docker
sudo systemctl start docker
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>测试运行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo docker run hello-world
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>添加当前用户到 docker 用户组，可以不用 sudo 运行 docker（可选）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo groupadd docker
sudo usermod -aG docker eiger  <span class="c1">## eiger为想要添加的用户</span>
su root
su eiger  <span class="c1">## 一定要先切root再切回eiger，这样前面做的设置才会生效！</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>测试添加用户组（可选）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker run hello-world
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="61-none镜像的处理">6.1. <code>&lt;none&gt;</code>镜像的处理</h3>
<p>关于编译过程中产生大量<code>&lt;none&gt;</code>镜像（或者描述为<code>&lt;none&gt;:&lt;none&gt;</code>镜像），可以参考<a href="https://blog.csdn.net/boling_cavalry/article/details/90727359">https://blog.csdn.net/boling_cavalry/article/details/90727359</a></p>
<p><code>&lt;none&gt;</code>镜像的产生是由于重新编译产生的产物，称为dangling镜像（摇摆的镜像），有的可能是被容器使用到的，有的则纯粹是老版本（就像蝉的遗蜕）。解决办法是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker image prune
</code></pre></td></tr></table>
</div>
</div><p>该操作会删除所有没有用到的<code>&lt;none&gt;</code>镜像，被使用的并不会删除。</p>
<p>详细描述参看官方文档和上面提到的博文。</p>
<h2 id="7-mainflux运行测试">7. mainflux运行测试</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">make <span class="nb">test</span>
</code></pre></td></tr></table>
</div>
</div><p>执行所有测试，包括Dockertest，这意味着需要运行Docker daemon/service。</p>
<p>首先，启动所有容器化的微服务，也就是将前面编译阶段得到的docker镜像跑起来：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/ui-amd64
86ae690636ed31c5d57739762193d9f098197ad8b6ba4d3b76d2f3a63a7fc64f
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/bootstrap-amd64
92a3cb2381578667ceb04dc9f2a34b0eb7f27289b1ba2140ba6f075b6e3e71c4
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/cli-amd64
1fcb0800dbbea5fb8310b13ea091599db75b425ea6cc7640eb53a850302bb134
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/postgres-reader-amd64
ee0679637a17b63ebf850d2987c6e6e3c50c3cbb9b4f1b2d3a0d4516d98cefae
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/postgres-writer-amd64
ba8649c958e2e1d974e76a4b107d9b2073829f3dc31048b24537949d131c4512
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/cassandra-reader-amd64
8dffba9623b9833eaeb264862cd1e3639a8e1d2f0aa3300ecd960f086c6872a0
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/cassandra-writer-amd64
83e0f4129a1f54620dda0892b8f31e37920a6ed5f2d2720cf271c1bc582253b5
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/mongodb-reader-amd64
3250c2d2277939051a0b47a72853f24ebb03be7c893d5a6a2d5b3ce371dca325
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/mongodb-writer-amd64
94b2fd8d1e6fbe2272d7bf921e6531a8ea8835f3a0e74de1936252b5a99e1a65
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/influxdb-reader-amd64
0e08504c0417a08feb7fd8f285ce762e00487c343b4e9f568abefe0e66aac851
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/influxdb-writer-amd64
0acf6f847cb343edd7fbdf85ef2d8f733fbeb239ee88f10fee291aecd4b868d8
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/lora-amd64
8f36bfe9f133ef1a82aea93278c7785ade392b5c1fbd68f95b5d88c315d9fec0
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/coap-amd64
01eaf38aa83a3fd08009f1ef0940514f75d21ff040fc3932b580400b1df79714
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/ws-amd64
531e1971dad242959092f27de4a71ea460873992b20d129847d7bd8fb7adc11a
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/normalizer-amd64
7b613120a6f0fa2ad5434fc772e241d9eb88a150309b59b08fc67f8c320dea27
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/http-amd64
1d4bd78f37ddd7fe7825a34771afdde2568bf89d9da7605c33eae36f2978f955
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/things-amd64
11cedbac4d9b5e794eef1853ce41ad983cbb0d37d895291ab294893b1d049bab
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d  mainflux/users-amd64
1ac6b4901c033ff8df892f9c80b88d08f9dc22e4d1318a2879979be6bae315e0
</code></pre></td></tr></table>
</div>
</div><p>此时，查看下当前运行的容器列表：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ sudo docker ps
CONTAINER ID        IMAGE                            COMMAND             CREATED             STATUS              PORTS               NAMES
0e08504c0417        mainflux/influxdb-reader-amd64   <span class="s2">&#34;/exe&#34;</span>              <span class="m">8</span> minutes ago       Up <span class="m">8</span> minutes                            exciting_feynman
3250c2d22779        mainflux/mongodb-reader-amd64    <span class="s2">&#34;/exe&#34;</span>              <span class="m">9</span> minutes ago       Up <span class="m">9</span> minutes                            dreamy_blackburn
86ae690636ed        mainflux/ui-amd64                <span class="s2">&#34;/entrypoint.sh&#34;</span>    <span class="m">13</span> minutes ago      Up <span class="m">13</span> minutes       80/tcp              silly_elgamal
</code></pre></td></tr></table>
</div>
</div><p>奇怪的是：启动容器并未失败，为何列举结果只有三个容器在运行？而且这三个容器并没有什么特别的特点。</p>
<p>另外一个未提及的是：mqtt服务的容器运行！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/mqtt-amd64
D0813 04:04:20.242132755       <span class="m">1</span> env_linux.cc:71<span class="o">]</span>            Warning: insecure environment <span class="nb">read</span> <span class="k">function</span> <span class="s1">&#39;getenv&#39;</span> used
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:30,<span class="s2">&#34;time&#34;</span>:1565669060551,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;listening&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;4203c68fb764&#34;</span>,<span class="s2">&#34;address&#34;</span>:<span class="s2">&#34;::&#34;</span>,<span class="s2">&#34;family&#34;</span>:<span class="s2">&#34;IPv6&#34;</span>,<span class="s2">&#34;port&#34;</span>:1883,<span class="s2">&#34;protocol&#34;</span>:<span class="s2">&#34;tcp&#34;</span>,<span class="s2">&#34;v&#34;</span>:1<span class="o">}</span>
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:30,<span class="s2">&#34;time&#34;</span>:1565669060552,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;listening&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;4203c68fb764&#34;</span>,<span class="s2">&#34;address&#34;</span>:<span class="s2">&#34;::&#34;</span>,<span class="s2">&#34;family&#34;</span>:<span class="s2">&#34;IPv6&#34;</span>,<span class="s2">&#34;port&#34;</span>:8880,<span class="s2">&#34;protocol&#34;</span>:<span class="s2">&#34;http&#34;</span>,<span class="s2">&#34;v&#34;</span>:1<span class="o">}</span>

events.js:174
      throw er<span class="p">;</span> // Unhandled <span class="s1">&#39;error&#39;</span> event
      ^
NatsError: Could not connect to server: Error: connect ECONNREFUSED 127.0.0.1:4222
    at Socket.stream.on <span class="o">(</span>/node_modules/nats/lib/nats.js:722:32<span class="o">)</span>
    at Socket.emit <span class="o">(</span>events.js:189:13<span class="o">)</span>
    at emitErrorNT <span class="o">(</span>internal/streams/destroy.js:82:8<span class="o">)</span>
    at emitErrorAndCloseNT <span class="o">(</span>internal/streams/destroy.js:50:3<span class="o">)</span>
    at process._tickCallback <span class="o">(</span>internal/process/next_tick.js:63:19<span class="o">)</span>
Emitted <span class="s1">&#39;error&#39;</span> event at:
    at Socket.stream.on <span class="o">(</span>/node_modules/nats/lib/nats.js:722:18<span class="o">)</span>
    at Socket.emit <span class="o">(</span>events.js:189:13<span class="o">)</span>
    <span class="o">[</span>... lines matching original stack trace ...<span class="o">]</span>
    at process._tickCallback <span class="o">(</span>internal/process/next_tick.js:63:19<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>这是第一个尝试运行的镜像，失败了。本来想放到后边讨论。</p>
<p>但是，以后台方式运行试试？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run -d mainflux/mqtt-amd64
544f66c4ed7445c62323ec37dd439ddf721629890e7a97f56bf9c7edcc1bb2d1
</code></pre></td></tr></table>
</div>
</div><p>也得到一个容器哈希？？</p>
<p>猜测，前面列举正在运行容器时没有列举出来的也是遇错了，前台运行时有错误，但后台运行仍然给出了一个哈希值。</p>
<p>也就是说，真正运行成功的只有mainflux/ui-amd64、mainflux/mongodb-reader-amd64、mainflux/influxdb-reader-amd64</p>
<p>现在将前面没有在容器列表显示出来的所有镜像重新以前台运行方式运行一次：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/bootstrap-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to postgres: dial tcp 127.0.0.1:5432: connect: connection refused&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:11:25.13973277Z&#34;</span><span class="o">}</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/cli-amd64
Usage:
  mainflux-cli <span class="o">[</span>command<span class="o">]</span>

Available Commands:
  channels    Channels management
  <span class="nb">help</span>        Help about any <span class="nb">command</span>
  messages    Send or <span class="nb">read</span> messages
  provision   Provision things and channels from config file
  things      Things management
  users       Users management
  version     Mainflux services version

Flags:
  -c, --content-type string    Mainflux message content <span class="nb">type</span> <span class="o">(</span>default <span class="s2">&#34;application/senml+json&#34;</span><span class="o">)</span>
  -h, --help                   <span class="nb">help</span> <span class="k">for</span> mainflux-cli
  -a, --http-prefix string     Mainflux http adapter prefix <span class="o">(</span>default <span class="s2">&#34;http&#34;</span><span class="o">)</span>
  -i, --insecure               Do not check <span class="k">for</span> TLS cert
  -l, --limit uint             limit query parameter <span class="o">(</span>default 100<span class="o">)</span>
  -m, --mainflux-url string    Mainflux host URL <span class="o">(</span>default <span class="s2">&#34;http://localhost&#34;</span><span class="o">)</span>
  -n, --name string            name query parameter
  -o, --offset uint            offset query parameter
  -t, --things-prefix string   Mainflux things service prefix
  -u, --users-prefix string    Mainflux users service prefix

Use <span class="s2">&#34;mainflux-cli [command] --help&#34;</span> <span class="k">for</span> more information about a command.
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/postgres-reader-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;gRPC communication is not encrypted&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:14:53.907162004Z&#34;</span><span class="o">}</span>
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to Postgres: dial tcp 127.0.0.1:5432: connect: connection refused&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:14:53.916560975Z&#34;</span><span class="o">}</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/postgres-writer-amd64
2019/08/13 04:15:25 open /config/channels.toml: no such file or directory
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/cassandra-reader-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to Cassandra cluster: gocql: unable to create session: unable to discover protocol version: dial tcp 127.0.0.1:9042: connect: connection refused&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:15:51.903650669Z&#34;</span><span class="o">}</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/cassandra-writer-amd64
2019/08/13 04:16:09 open /config/channels.toml: no such file or directory
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/mongodb-writer-amd64
2019/08/13 04:17:58 open /config/channels.toml: no such file or directory
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/influxdb-writer-amd64
2019/08/13 04:18:35 open /config/channels.toml: no such file or directory
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/lora-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to NATS: nats: no servers available for connection&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:18:54.906401806Z&#34;</span><span class="o">}</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/coap-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to NATS: nats: no servers available for connection&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:19:11.762530473Z&#34;</span><span class="o">}</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/ws-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to NATS: nats: no servers available for connection&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:19:29.355706676Z&#34;</span><span class="o">}</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/normalizer-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to NATS: nats: no servers available for connection&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:19:45.747053109Z&#34;</span><span class="o">}</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/http-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to NATS: nats: no servers available for connection&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:20:04.396013566Z&#34;</span><span class="o">}</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/things-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to postgres: dial tcp 127.0.0.1:5432: connect: connection refused&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:20:19.80428741Z&#34;</span><span class="o">}</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo docker run mainflux/users-amd64
<span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Failed to connect to postgres: dial tcp 127.0.0.1:5432: connect: connection refused&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-13T04:21:00.562341257Z&#34;</span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>从输出信息可以看出：bootstrap无法连接至postgres；cli本身是没问题的，只不过它不是个后台进程，而是个交互式进程；postgres-reader连接postgres时被拒绝；postgres-writer找不到/config/channels.toml文件；cassandra-reader连接cassandra被拒绝；cassandra-writer找不到/config/channels.toml文件；mongodb-writer、influxdb-writer也找不到/config/channels.toml文件；lora、coap、ws、normalizer、http连接不到nats服务器；things和users连接不到postgres。</p>
<p>对了，mqtt的报错信息其实是在event.js文件中连接不到127.0.0.1:4222，并且在其调用路径中看到下一级是nats.go抛出错误，这说明mqtt其实也是连接不到nats服务器的问题。</p>
<p>综上： 需要安装并启动postgres、cassandra、nats，检查/config/channels.toml。</p>
<p>参照<a href="#10-postgrescassandranats%e5%ae%89%e8%a3%85">10. postgres、cassandra、nats安装</a>安装完成这三个软件服务。</p>
<p>注意：在安装cassandra的过程中发现cassandra默认端口是7199，而在上面的报错信息中cassandra使用的是端口9042，这点后续需要注意！留待修改。 nats和postgres用的都是默认端口所以不用管。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ ls
api.go        cli              doc.go  Gopkg.lock      internal.proto  logger       message.go     mkdocs.yml    package-lock.json  scripts    ui          writers
bootstrap     cmd              docker  Gopkg.toml      k8s             lora         message.pb.go  mqtt          publisher.go       sdk        users       ws
build         coap             docs    http            LICENSE         MAINTAINERS  message.proto  node_modules  readers            things     vendor
CHANGELOG.md  CONTRIBUTING.md  env.go  internal.pb.go  load-test       Makefile     metrics        normalizer    README.md          topics.go  version.go
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ <span class="nb">cd</span> config
bash: cd: config: No such file or directory
</code></pre></td></tr></table>
</div>
</div><p>显示mainflux项目目录下没有config文件夹 :(</p>
<p>现在我们切换到/home/eiger/gopath-default/src/github.com/mainflux/mainflux/config来看看这个channels.toml是个什么情况。</p>
<p>前边的输出信息显示四个数据库软件（postgres、cassandra、mongodb、influxdb）的writer服务都找不到config/channels.toml。只看其中一个服务就好了，选择最熟悉的mongodb-writer去看其源代码。</p>
<p>mongodb-writer部分代码主要分cmd/mongodb-writer/main.go（入口文件）和writers/api、writers/mongodb、writers/。</p>
<p>先看入口文件，在入口文件中有定义：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
    <span class="nx">svcName</span> <span class="p">=</span> <span class="s">&#34;mongodb-writer&#34;</span>

    <span class="nx">defNatsURL</span>     <span class="p">=</span> <span class="nx">nats</span><span class="p">.</span><span class="nx">DefaultURL</span>
    <span class="nx">defLogLevel</span>    <span class="p">=</span> <span class="s">&#34;error&#34;</span>
    <span class="nx">defPort</span>        <span class="p">=</span> <span class="s">&#34;8180&#34;</span>
    <span class="nx">defDBName</span>      <span class="p">=</span> <span class="s">&#34;mainflux&#34;</span>
    <span class="nx">defDBHost</span>      <span class="p">=</span> <span class="s">&#34;localhost&#34;</span>
    <span class="nx">defDBPort</span>      <span class="p">=</span> <span class="s">&#34;27017&#34;</span>
    <span class="nx">defChanCfgPath</span> <span class="p">=</span> <span class="s">&#34;/config/channels.toml&#34;</span>

    <span class="nx">envNatsURL</span>     <span class="p">=</span> <span class="s">&#34;MF_NATS_URL&#34;</span>
    <span class="nx">envLogLevel</span>    <span class="p">=</span> <span class="s">&#34;MF_MONGO_WRITER_LOG_LEVEL&#34;</span>
    <span class="nx">envPort</span>        <span class="p">=</span> <span class="s">&#34;MF_MONGO_WRITER_PORT&#34;</span>
    <span class="nx">envDBName</span>      <span class="p">=</span> <span class="s">&#34;MF_MONGO_WRITER_DB_NAME&#34;</span>
    <span class="nx">envDBHost</span>      <span class="p">=</span> <span class="s">&#34;MF_MONGO_WRITER_DB_HOST&#34;</span>
    <span class="nx">envDBPort</span>      <span class="p">=</span> <span class="s">&#34;MF_MONGO_WRITER_DB_PORT&#34;</span>
    <span class="nx">envChanCfgPath</span> <span class="p">=</span> <span class="s">&#34;MF_MONGO_WRITER_CHANNELS_CONFIG&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">loadConfigs</span><span class="p">()</span> <span class="nx">config</span> <span class="p">{</span>
  <span class="nx">chanCfgPath</span> <span class="o">:=</span> <span class="nx">mainflux</span><span class="p">.</span><span class="nf">Env</span><span class="p">(</span><span class="nx">envChanCfgPath</span><span class="p">,</span> <span class="nx">defChanCfgPath</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">config</span><span class="p">{</span>
    <span class="nx">natsURL</span><span class="p">:</span>  <span class="nx">mainflux</span><span class="p">.</span><span class="nf">Env</span><span class="p">(</span><span class="nx">envNatsURL</span><span class="p">,</span> <span class="nx">defNatsURL</span><span class="p">),</span>
    <span class="nx">logLevel</span><span class="p">:</span> <span class="nx">mainflux</span><span class="p">.</span><span class="nf">Env</span><span class="p">(</span><span class="nx">envLogLevel</span><span class="p">,</span> <span class="nx">defLogLevel</span><span class="p">),</span>
    <span class="nx">port</span><span class="p">:</span>     <span class="nx">mainflux</span><span class="p">.</span><span class="nf">Env</span><span class="p">(</span><span class="nx">envPort</span><span class="p">,</span> <span class="nx">defPort</span><span class="p">),</span>
    <span class="nx">dbName</span><span class="p">:</span>   <span class="nx">mainflux</span><span class="p">.</span><span class="nf">Env</span><span class="p">(</span><span class="nx">envDBName</span><span class="p">,</span> <span class="nx">defDBName</span><span class="p">),</span>
    <span class="nx">dbHost</span><span class="p">:</span>   <span class="nx">mainflux</span><span class="p">.</span><span class="nf">Env</span><span class="p">(</span><span class="nx">envDBHost</span><span class="p">,</span> <span class="nx">defDBHost</span><span class="p">),</span>
    <span class="nx">dbPort</span><span class="p">:</span>   <span class="nx">mainflux</span><span class="p">.</span><span class="nf">Env</span><span class="p">(</span><span class="nx">envDBPort</span><span class="p">,</span> <span class="nx">defDBPort</span><span class="p">),</span>
    <span class="nx">channels</span><span class="p">:</span> <span class="nf">loadChansConfig</span><span class="p">(</span><span class="nx">chanCfgPath</span><span class="p">),</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">loadChansConfig</span><span class="p">(</span><span class="nx">chanConfigPath</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span> <span class="p">{</span>
  <span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="nx">chanConfigPath</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">chanCfg</span> <span class="nx">chanConfig</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">toml</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">chanCfg</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">chans</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{}</span>
  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ch</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">chanCfg</span><span class="p">.</span><span class="nx">Channels</span><span class="p">.</span><span class="nx">List</span> <span class="p">{</span>
    <span class="nx">chans</span><span class="p">[</span><span class="nx">ch</span><span class="p">]</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">chans</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>直接可以看到其配置文件路径已经在代码文件中写入了。那说明config/channels.toml是代码内决定的配置文件，但是我们从github拉取项目却没得到这个文件。这是因为通常配置文件都不会上传到项目中。这表示我们现在需要进一步查看mainflux使用文档，想办法生成这个channels.toml。</p>
<p>在官方文档<a href="https://mainflux.readthedocs.io/en/latest/getting-started/">https://mainflux.readthedocs.io/en/latest/getting-started/</a>中可以看到</p>
<h2 id="8-mainflux安装">8. mainflux安装</h2>
<p>安装GO二进制可执行文件非常容易，只需要将build生成的所有可执行文件手动复制到<code>$GOBIN</code>目录下并确保<code>GOBIN</code>被添加到<code>$PATH</code>变量。</p>
<p>当然，也可以执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">make install
</code></pre></td></tr></table>
</div>
</div><p>自动完成/mainflux/build下二进制文件复制到$GOBIN操作。</p>
<p>但是注意：mqtt adapter是nodejs脚本，仍保留在/mainflux/mqtt/aedes而不被复制。</p>
<p>执行完<code>make install</code>后，可以发现确实将文件复制到了$GOBIN下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ ls ~/gopath-default/bin
protoc-gen-go  protoc-gen-gofast
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ make install
cp build/* /home/eiger/gopath-default/bin
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ ls ~/gopath-default/bin
mainflux-bootstrap         mainflux-cli   mainflux-influxdb-reader  mainflux-mongodb-reader  mainflux-postgres-reader  mainflux-users  protoc-gen-gofast
mainflux-cassandra-reader  mainflux-coap  mainflux-influxdb-writer  mainflux-mongodb-writer  mainflux-postgres-writer  mainflux-ws
mainflux-cassandra-writer  mainflux-http  mainflux-lora             mainflux-normalizer      mainflux-things           protoc-gen-go
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$
</code></pre></td></tr></table>
</div>
</div><h2 id="9-mainflux部署">9. mainflux部署</h2>
<h3 id="91-前提">9.1 前提</h3>
<h2 id="10-postgrescassandranats安装">10. postgres、cassandra、nats安装</h2>
<p>在<a href="#7-mainflux%e8%bf%90%e8%a1%8c%e6%b5%8b%e8%af%95">7. mainflux运行测试</a>中我们发现需要安装postgres、cassandra、nats三个软件。</p>
<h3 id="101安装postgres">10.1.安装postgres</h3>
<p>postgres，或者称PostgreSQL，是一个关系型数据库管理系统，提供SQL查询语言及其他各种高级功能。具体描述参见其官方资料。</p>
<p>安装方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt update
sudo apt install postgres postgres-contrib
</code></pre></td></tr></table>
</div>
</div><p>安装输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ sudo apt install postgresql postgresql-contrib
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  libpq5 postgresql-10 postgresql-client-10 postgresql-client-common
  postgresql-common sysstat
Suggested packages:
  postgresql-doc locales-all postgresql-doc-10 libjson-perl isag
The following NEW packages will be installed:
  libpq5 postgresql postgresql-10 postgresql-client-10
  postgresql-client-common postgresql-common postgresql-contrib sysstat
<span class="m">0</span> upgraded, <span class="m">8</span> newly installed, <span class="m">0</span> to remove and <span class="m">7</span> not upgraded.
Need to get 5,293 kB of archives.
After this operation, 20.9 MB of additional disk space will be used.
Do you want to <span class="k">continue</span>? <span class="o">[</span>Y/n<span class="o">]</span> y
Get:1 http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic-updates/main amd64 libpq5 amd64 10.10-0ubuntu0.18.04.1 <span class="o">[</span><span class="m">108</span> kB<span class="o">]</span>
Get:2 http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic/main amd64 postgresql-client-common all <span class="m">190</span> <span class="o">[</span>29.5 kB<span class="o">]</span>
Get:3 http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic-updates/main amd64 postgresql-client-10 amd64 10.10-0ubuntu0.18.04.1 <span class="o">[</span><span class="m">935</span> kB<span class="o">]</span>
Get:4 http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic/main amd64 postgresql-common all <span class="m">190</span> <span class="o">[</span><span class="m">157</span> kB<span class="o">]</span>
Get:5 http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic-updates/main amd64 postgresql-10 amd64 10.10-0ubuntu0.18.04.1 <span class="o">[</span>3,758 kB<span class="o">]</span>
Get:6 http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic/main amd64 postgresql all 10+190 <span class="o">[</span>5,784 B<span class="o">]</span>
Get:7 http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic/main amd64 postgresql-contrib all 10+190 <span class="o">[</span>5,796 B<span class="o">]</span>
Get:8 http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic/main amd64 sysstat amd64 11.6.1-1 <span class="o">[</span><span class="m">295</span> kB<span class="o">]</span>
Fetched 5,293 kB in 5s <span class="o">(</span>1,037 kB/s<span class="o">)</span>
Preconfiguring packages ...
Selecting previously unselected package libpq5:amd64.
<span class="o">(</span>Reading database ... <span class="m">174645</span> files and directories currently installed.<span class="o">)</span>
Preparing to unpack .../0-libpq5_10.10-0ubuntu0.18.04.1_amd64.deb ...
Unpacking libpq5:amd64 <span class="o">(</span>10.10-0ubuntu0.18.04.1<span class="o">)</span> ...
Selecting previously unselected package postgresql-client-common.
Preparing to unpack .../1-postgresql-client-common_190_all.deb ...
Unpacking postgresql-client-common <span class="o">(</span>190<span class="o">)</span> ...
Selecting previously unselected package postgresql-client-10.
Preparing to unpack .../2-postgresql-client-10_10.10-0ubuntu0.18.04.1_amd64.deb ...
Unpacking postgresql-client-10 <span class="o">(</span>10.10-0ubuntu0.18.04.1<span class="o">)</span> ...
Selecting previously unselected package postgresql-common.
Preparing to unpack .../3-postgresql-common_190_all.deb ...
Adding <span class="s1">&#39;diversion of /usr/bin/pg_config to /usr/bin/pg_config.libpq-dev by postgresql-common&#39;</span>
Unpacking postgresql-common <span class="o">(</span>190<span class="o">)</span> ...
Selecting previously unselected package postgresql-10.
Preparing to unpack .../4-postgresql-10_10.10-0ubuntu0.18.04.1_amd64.deb ...
Unpacking postgresql-10 <span class="o">(</span>10.10-0ubuntu0.18.04.1<span class="o">)</span> ...
Selecting previously unselected package postgresql.
Preparing to unpack .../5-postgresql_10+190_all.deb ...
Unpacking postgresql <span class="o">(</span>10+190<span class="o">)</span> ...
Selecting previously unselected package postgresql-contrib.
Preparing to unpack .../6-postgresql-contrib_10+190_all.deb ...
Unpacking postgresql-contrib <span class="o">(</span>10+190<span class="o">)</span> ...
Selecting previously unselected package sysstat.
Preparing to unpack .../7-sysstat_11.6.1-1_amd64.deb ...
Unpacking sysstat <span class="o">(</span>11.6.1-1<span class="o">)</span> ...
Setting up sysstat <span class="o">(</span>11.6.1-1<span class="o">)</span> ...

Creating config file /etc/default/sysstat with new version
update-alternatives: using /usr/bin/sar.sysstat to provide /usr/bin/sar <span class="o">(</span>sar<span class="o">)</span> in auto mode
Created symlink /etc/systemd/system/multi-user.target.wants/sysstat.service → /lib/systemd/system/sysstat.service.
Processing triggers <span class="k">for</span> ureadahead <span class="o">(</span>0.100.0-21<span class="o">)</span> ...
Setting up libpq5:amd64 <span class="o">(</span>10.10-0ubuntu0.18.04.1<span class="o">)</span> ...
Processing triggers <span class="k">for</span> libc-bin <span class="o">(</span>2.27-3ubuntu1<span class="o">)</span> ...
Setting up postgresql-client-common <span class="o">(</span>190<span class="o">)</span> ...
Processing triggers <span class="k">for</span> systemd <span class="o">(</span>237-3ubuntu10.25<span class="o">)</span> ...
Setting up postgresql-common <span class="o">(</span>190<span class="o">)</span> ...
Adding user postgres to group ssl-cert

Creating config file /etc/postgresql-common/createcluster.conf with new version
Building PostgreSQL dictionaries from installed myspell/hunspell packages...
  en_us
Removing obsolete dictionary files:
Created symlink /etc/systemd/system/multi-user.target.wants/postgresql.service → /lib/systemd/system/postgresql.service.
Processing triggers <span class="k">for</span> man-db <span class="o">(</span>2.8.3-2ubuntu0.1<span class="o">)</span> ...
Setting up postgresql-client-10 <span class="o">(</span>10.10-0ubuntu0.18.04.1<span class="o">)</span> ...
update-alternatives: using /usr/share/postgresql/10/man/man1/psql.1.gz to provide /usr/share/man/man1/psql.1.gz <span class="o">(</span>psql.1.gz<span class="o">)</span> in auto mode
Setting up postgresql-10 <span class="o">(</span>10.10-0ubuntu0.18.04.1<span class="o">)</span> ...
Creating new PostgreSQL cluster 10/main ...
/usr/lib/postgresql/10/bin/initdb -D /var/lib/postgresql/10/main --auth-local peer --auth-host md5
The files belonging to this database system will be owned by user <span class="s2">&#34;postgres&#34;</span>.
This user must also own the server process.

The database cluster will be initialized with locale <span class="s2">&#34;en_US.UTF-8&#34;</span>.
The default database encoding has accordingly been <span class="nb">set</span> to <span class="s2">&#34;UTF8&#34;</span>.
The default text search configuration will be <span class="nb">set</span> to <span class="s2">&#34;english&#34;</span>.

Data page checksums are disabled.

fixing permissions on existing directory /var/lib/postgresql/10/main ... ok
creating subdirectories ... ok
selecting default max_connections ... <span class="m">100</span>
selecting default shared_buffers ... 128MB
selecting default timezone ... America/New_York
selecting dynamic shared memory implementation ... posix
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok

Success. You can now start the database server using:

    /usr/lib/postgresql/10/bin/pg_ctl -D /var/lib/postgresql/10/main -l logfile start

Ver Cluster Port Status Owner    Data directory              Log file
<span class="m">10</span>  main    <span class="m">5432</span> down   postgres /var/lib/postgresql/10/main /var/log/postgresql/postgresql-10-main.log
update-alternatives: using /usr/share/postgresql/10/man/man1/postmaster.1.gz to provide /usr/share/man/man1/postmaster.1.gz <span class="o">(</span>postmaster.1.gz<span class="o">)</span> in auto mode
Setting up postgresql <span class="o">(</span>10+190<span class="o">)</span> ...
Setting up postgresql-contrib <span class="o">(</span>10+190<span class="o">)</span> ...
Processing triggers <span class="k">for</span> ureadahead <span class="o">(</span>0.100.0-21<span class="o">)</span> ...
Processing triggers <span class="k">for</span> systemd <span class="o">(</span>237-3ubuntu10.25<span class="o">)</span> ...
</code></pre></td></tr></table>
</div>
</div><p>从中可以获取到一些postgres的默认信息。比较重要的是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">Success. You can now start the database server using:

    /usr/lib/postgresql/10/bin/pg_ctl -D /var/lib/postgresql/10/main -l logfile start

Ver Cluster Port Status Owner    Data directory              Log file
<span class="m">10</span>  main    <span class="m">5432</span> down   postgres /var/lib/postgresql/10/main /var/log/postgresql/postgresql-10-main.log
</code></pre></td></tr></table>
</div>
</div><p>启动方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">/usr/lib/postgresql/10/bin/pg_ctl -D /var/lib/postgresql/10/main -l logfile start
</code></pre></td></tr></table>
</div>
</div><p>版本信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ psql --version
psql <span class="o">(</span>PostgreSQL<span class="o">)</span> 10.10 <span class="o">(</span>Ubuntu 10.10-0ubuntu0.18.04.1<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>测试服务器是否启动：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt install nmap  <span class="c1">## 安装nmap工具，安装过就不用再安装</span>
nmap 127.0.0.1
</code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ nmap 127.0.0.1

Starting Nmap 7.60 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2019-08-13 02:21 EDT
Nmap scan report <span class="k">for</span> localhost <span class="o">(</span>127.0.0.1<span class="o">)</span>
Host is up <span class="o">(</span>0.00018s latency<span class="o">)</span>.
Not shown: <span class="m">996</span> closed ports
PORT     STATE SERVICE
80/tcp   open  http
631/tcp  open  ipp
5432/tcp open  postgresql
7070/tcp open  realserver

Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 0.07 seconds
</code></pre></td></tr></table>
</div>
</div><p>可以看到，在127.0.0.1这个本机ip下开启了5432端口，用于postgresql的tcp监听。</p>
<p>注意，安装完成后，默认创建了postgres用户，且只有在该用户下才可以访问postgresql数据库。</p>
<p>通过<code>sudo nano /etc/shadow</code>可以查看到文件末尾有postgres用户名的存在。（ps: 关于linux用户名用户组相关，参阅<a href="https://www.cnblogs.com/jackyyou/p/5498083.html">https://www.cnblogs.com/jackyyou/p/5498083.html</a>）</p>
<ul>
<li>
<p>修改postgres用户密码（最开始是随机密码）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo -u postgres psql
psql <span class="o">(</span>10.10 <span class="o">(</span>Ubuntu 10.10-0ubuntu0.18.04.1<span class="o">))</span>
Type <span class="s2">&#34;help&#34;</span> <span class="k">for</span> help.

<span class="nv">postgres</span><span class="o">=</span><span class="c1"># ALTER USER postgres WITH PASSWORD &#39;YOURPASSWDSTRING&#39;;</span>
ALTER ROLE
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># \q</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$
</code></pre></td></tr></table>
</div>
</div><p>这样，postgres中postgres这个用户的密码就修改成我们想要的了，现在还需要修改电脑系统中postgres这个用户的密码，与前一致：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ sudo su
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> eiger:
root@eiger-ThinkPad-X1-Carbon-3rd:/home/eiger# sudo passwd -d postgres
passwd: password expiry information changed.
root@eiger-ThinkPad-X1-Carbon-3rd:/home/eiger# sudo -u postgres passwd
Enter new UNIX password:
Retype new UNIX password:
passwd: password updated successfully
root@eiger-ThinkPad-X1-Carbon-3rd:/home/eiger# su postgres
postgres@eiger-ThinkPad-X1-Carbon-3rd:/home/eiger$ psql
psql <span class="o">(</span>10.10 <span class="o">(</span>Ubuntu 10.10-0ubuntu0.18.04.1<span class="o">))</span>
Type <span class="s2">&#34;help&#34;</span> <span class="k">for</span> help.

<span class="nv">postgres</span><span class="o">=</span><span class="c1"># \q</span>
postgres@eiger-ThinkPad-X1-Carbon-3rd:/home/eiger$ su eiger
Password:
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ psql
psql: FATAL:  role <span class="s2">&#34;eiger&#34;</span> does not exist
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$
</code></pre></td></tr></table>
</div>
</div><p>如此，切换成postgre系统用户，即可登录使用psql。</p>
</li>
</ul>
<p>关于postgres的使用，暂略。</p>
<h3 id="102-安装cassandra">10.2. 安装cassandra</h3>
<p>安装参考：官方文档及博文<a href="https://blog.csdn.net/yamaxifeng_132/article/details/78824579">https://blog.csdn.net/yamaxifeng_132/article/details/78824579</a></p>
<p>Cassandra是Facebook开发的开源分布式NoSQL（非关系型）数据库，基于Java开发，没有提供windows安装版本。</p>
<p>安装Cassandra需要先安装好Java的环境，参见<a href="#104-%e5%ae%89%e8%a3%85java%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83java-12">10.4 jdk12安装</a>（后面发现安装错了，如果想一次到位，直接安装jdk8，参见<a href="#105-%e5%ae%89%e8%a3%85java%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83java-8">10.5 jdk8安装</a>）</p>
<p>cassandra下载：<a href="http://cassandra.apache.org/download/">http://cassandra.apache.org/download/</a>
选择最新的发行版下载即可。我下载的是当前最新发行版3.11.4。
解压后，打开/apache-cassandra-3.11.4/conf/cassandra-env.sh，可以看到：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$JVM_VERSION</span><span class="s2">&#34;</span> <span class="se">\&lt;</span> <span class="s2">&#34;1.8&#34;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&#34;Cassandra 3.0 and later require Java 8u40 or later.&#34;</span>
    <span class="nb">exit</span> 1<span class="p">;</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$JVM_VERSION</span><span class="s2">&#34;</span> <span class="se">\&lt;</span> <span class="s2">&#34;1.8&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$JVM_PATCH_VERSION</span><span class="s2">&#34;</span> -lt <span class="m">40</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&#34;Cassandra 3.0 and later require Java 8u40 or later.&#34;</span>
    <span class="nb">exit</span> 1<span class="p">;</span>
<span class="k">fi</span>

</code></pre></td></tr></table>
</div>
</div><p>从中可看出当前版本的cassandra要求jdk 8u40或更高版本，前面所安装的java符合要求。</p>
<p>先将cassandra解压目录复制到/usr/local下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/Downloads$ sudo cp -r apache-cassandra-3.11.4 /usr/local
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> eiger:
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/Downloads$ ls /usr/local
apache-cassandra-3.11.4  bin  etc  games  go  include  lib  man  protobuf-3.9.1-linux-x86_64  sbin  share  src
</code></pre></td></tr></table>
</div>
</div><p>接下来设置环境变量，在/etc/profile文件末尾追加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">export</span> <span class="nv">CASSANDRA_HOME</span><span class="o">=</span>/usr/local/apache-cassandra-3.11.4
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="si">${</span><span class="nv">CASSANDRA_HOME</span><span class="si">}</span>/bin
</code></pre></td></tr></table>
</div>
</div><p>接下来是测试cassandra的安装：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ cassandra
cassandra: <span class="nb">command</span> not found
eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4/bin$ ./cassandra
Cassandra 3.0 and later require Java 8u40 or later.
</code></pre></td></tr></table>
</div>
</div><p>从结果可以看出，首先环境变量的设置是失败的，但仔细比对后，发现设置并未出错。再次输入<code>env</code>来查看环境变量：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4/bin$ env
<span class="nv">CLUTTER_IM_MODULE</span><span class="o">=</span>xim
<span class="nv">LS_COLORS</span><span class="o">=</span><span class="nv">rs</span><span class="o">=</span>0:di<span class="o">=</span>01<span class="p">;</span>34:ln<span class="o">=</span>01<span class="p">;</span>36:mh<span class="o">=</span>00:pi<span class="o">=</span>40<span class="p">;</span>33:so<span class="o">=</span>01<span class="p">;</span>35:do<span class="o">=</span>01<span class="p">;</span>35:bd<span class="o">=</span>40<span class="p">;</span>33<span class="p">;</span>01:cd<span class="o">=</span>40<span class="p">;</span>33<span class="p">;</span>01:or<span class="o">=</span>40<span class="p">;</span>31<span class="p">;</span>01:mi<span class="o">=</span>00:su<span class="o">=</span>37<span class="p">;</span>41:sg<span class="o">=</span>30<span class="p">;</span>43:ca<span class="o">=</span>30<span class="p">;</span>41:tw<span class="o">=</span>30<span class="p">;</span>42:ow<span class="o">=</span>34<span class="p">;</span>42:st<span class="o">=</span>37<span class="p">;</span>44:ex<span class="o">=</span>01<span class="p">;</span>32:*.tar<span class="o">=</span>01<span class="p">;</span>31:*.tgz<span class="o">=</span>01<span class="p">;</span>31:*.arc<span class="o">=</span>01<span class="p">;</span>31:*.arj<span class="o">=</span>01<span class="p">;</span>31:*.taz<span class="o">=</span>01<span class="p">;</span>31:*.lha<span class="o">=</span>01<span class="p">;</span>31:*.lz4<span class="o">=</span>01<span class="p">;</span>31:*.lzh<span class="o">=</span>01<span class="p">;</span>31:*.lzma<span class="o">=</span>01<span class="p">;</span>31:*.tlz<span class="o">=</span>01<span class="p">;</span>31:*.txz<span class="o">=</span>01<span class="p">;</span>31:*.tzo<span class="o">=</span>01<span class="p">;</span>31:*.t7z<span class="o">=</span>01<span class="p">;</span>31:*.zip<span class="o">=</span>01<span class="p">;</span>31:*.z<span class="o">=</span>01<span class="p">;</span>31:*.Z<span class="o">=</span>01<span class="p">;</span>31:*.dz<span class="o">=</span>01<span class="p">;</span>31:*.gz<span class="o">=</span>01<span class="p">;</span>31:*.lrz<span class="o">=</span>01<span class="p">;</span>31:*.lz<span class="o">=</span>01<span class="p">;</span>31:*.lzo<span class="o">=</span>01<span class="p">;</span>31:*.xz<span class="o">=</span>01<span class="p">;</span>31:*.zst<span class="o">=</span>01<span class="p">;</span>31:*.tzst<span class="o">=</span>01<span class="p">;</span>31:*.bz2<span class="o">=</span>01<span class="p">;</span>31:*.bz<span class="o">=</span>01<span class="p">;</span>31:*.tbz<span class="o">=</span>01<span class="p">;</span>31:*.tbz2<span class="o">=</span>01<span class="p">;</span>31:*.tz<span class="o">=</span>01<span class="p">;</span>31:*.deb<span class="o">=</span>01<span class="p">;</span>31:*.rpm<span class="o">=</span>01<span class="p">;</span>31:*.jar<span class="o">=</span>01<span class="p">;</span>31:*.war<span class="o">=</span>01<span class="p">;</span>31:*.ear<span class="o">=</span>01<span class="p">;</span>31:*.sar<span class="o">=</span>01<span class="p">;</span>31:*.rar<span class="o">=</span>01<span class="p">;</span>31:*.alz<span class="o">=</span>01<span class="p">;</span>31:*.ace<span class="o">=</span>01<span class="p">;</span>31:*.zoo<span class="o">=</span>01<span class="p">;</span>31:*.cpio<span class="o">=</span>01<span class="p">;</span>31:*.7z<span class="o">=</span>01<span class="p">;</span>31:*.rz<span class="o">=</span>01<span class="p">;</span>31:*.cab<span class="o">=</span>01<span class="p">;</span>31:*.wim<span class="o">=</span>01<span class="p">;</span>31:*.swm<span class="o">=</span>01<span class="p">;</span>31:*.dwm<span class="o">=</span>01<span class="p">;</span>31:*.esd<span class="o">=</span>01<span class="p">;</span>31:*.jpg<span class="o">=</span>01<span class="p">;</span>35:*.jpeg<span class="o">=</span>01<span class="p">;</span>35:*.mjpg<span class="o">=</span>01<span class="p">;</span>35:*.mjpeg<span class="o">=</span>01<span class="p">;</span>35:*.gif<span class="o">=</span>01<span class="p">;</span>35:*.bmp<span class="o">=</span>01<span class="p">;</span>35:*.pbm<span class="o">=</span>01<span class="p">;</span>35:*.pgm<span class="o">=</span>01<span class="p">;</span>35:*.ppm<span class="o">=</span>01<span class="p">;</span>35:*.tga<span class="o">=</span>01<span class="p">;</span>35:*.xbm<span class="o">=</span>01<span class="p">;</span>35:*.xpm<span class="o">=</span>01<span class="p">;</span>35:*.tif<span class="o">=</span>01<span class="p">;</span>35:*.tiff<span class="o">=</span>01<span class="p">;</span>35:*.png<span class="o">=</span>01<span class="p">;</span>35:*.svg<span class="o">=</span>01<span class="p">;</span>35:*.svgz<span class="o">=</span>01<span class="p">;</span>35:*.mng<span class="o">=</span>01<span class="p">;</span>35:*.pcx<span class="o">=</span>01<span class="p">;</span>35:*.mov<span class="o">=</span>01<span class="p">;</span>35:*.mpg<span class="o">=</span>01<span class="p">;</span>35:*.mpeg<span class="o">=</span>01<span class="p">;</span>35:*.m2v<span class="o">=</span>01<span class="p">;</span>35:*.mkv<span class="o">=</span>01<span class="p">;</span>35:*.webm<span class="o">=</span>01<span class="p">;</span>35:*.ogm<span class="o">=</span>01<span class="p">;</span>35:*.mp4<span class="o">=</span>01<span class="p">;</span>35:*.m4v<span class="o">=</span>01<span class="p">;</span>35:*.mp4v<span class="o">=</span>01<span class="p">;</span>35:*.vob<span class="o">=</span>01<span class="p">;</span>35:*.qt<span class="o">=</span>01<span class="p">;</span>35:*.nuv<span class="o">=</span>01<span class="p">;</span>35:*.wmv<span class="o">=</span>01<span class="p">;</span>35:*.asf<span class="o">=</span>01<span class="p">;</span>35:*.rm<span class="o">=</span>01<span class="p">;</span>35:*.rmvb<span class="o">=</span>01<span class="p">;</span>35:*.flc<span class="o">=</span>01<span class="p">;</span>35:*.avi<span class="o">=</span>01<span class="p">;</span>35:*.fli<span class="o">=</span>01<span class="p">;</span>35:*.flv<span class="o">=</span>01<span class="p">;</span>35:*.gl<span class="o">=</span>01<span class="p">;</span>35:*.dl<span class="o">=</span>01<span class="p">;</span>35:*.xcf<span class="o">=</span>01<span class="p">;</span>35:*.xwd<span class="o">=</span>01<span class="p">;</span>35:*.yuv<span class="o">=</span>01<span class="p">;</span>35:*.cgm<span class="o">=</span>01<span class="p">;</span>35:*.emf<span class="o">=</span>01<span class="p">;</span>35:*.ogv<span class="o">=</span>01<span class="p">;</span>35:*.ogx<span class="o">=</span>01<span class="p">;</span>35:*.aac<span class="o">=</span>00<span class="p">;</span>36:*.au<span class="o">=</span>00<span class="p">;</span>36:*.flac<span class="o">=</span>00<span class="p">;</span>36:*.m4a<span class="o">=</span>00<span class="p">;</span>36:*.mid<span class="o">=</span>00<span class="p">;</span>36:*.midi<span class="o">=</span>00<span class="p">;</span>36:*.mka<span class="o">=</span>00<span class="p">;</span>36:*.mp3<span class="o">=</span>00<span class="p">;</span>36:*.mpc<span class="o">=</span>00<span class="p">;</span>36:*.ogg<span class="o">=</span>00<span class="p">;</span>36:*.ra<span class="o">=</span>00<span class="p">;</span>36:*.wav<span class="o">=</span>00<span class="p">;</span>36:*.oga<span class="o">=</span>00<span class="p">;</span>36:*.opus<span class="o">=</span>00<span class="p">;</span>36:*.spx<span class="o">=</span>00<span class="p">;</span>36:*.xspf<span class="o">=</span>00<span class="p">;</span>36:
<span class="nv">LESSCLOSE</span><span class="o">=</span>/usr/bin/lesspipe %s %s
<span class="nv">XDG_MENU_PREFIX</span><span class="o">=</span>gnome-
<span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8
<span class="nv">DISPLAY</span><span class="o">=</span>:0
<span class="nv">OLDPWD</span><span class="o">=</span>/usr/local/apache-cassandra-3.11.4
<span class="nv">GNOME_SHELL_SESSION_MODE</span><span class="o">=</span>ubuntu
<span class="nv">COLORTERM</span><span class="o">=</span>truecolor
<span class="nv">USERNAME</span><span class="o">=</span>eiger
<span class="nv">GOPROXY</span><span class="o">=</span>https://goproxy.io
<span class="nv">XDG_VTNR</span><span class="o">=</span><span class="m">1</span>
<span class="nv">SSH_AUTH_SOCK</span><span class="o">=</span>/run/user/1000/keyring/ssh
<span class="nv">XDG_SESSION_ID</span><span class="o">=</span><span class="m">1</span>
<span class="nv">USER</span><span class="o">=</span>eiger
<span class="nv">DESKTOP_SESSION</span><span class="o">=</span>ubuntu
<span class="nv">QT4_IM_MODULE</span><span class="o">=</span>fcitx
<span class="nv">GOPATH</span><span class="o">=</span>/home/eiger/gopath-default
<span class="nv">TEXTDOMAINDIR</span><span class="o">=</span>/usr/share/locale/
<span class="nv">GNOME_TERMINAL_SCREEN</span><span class="o">=</span>/org/gnome/Terminal/screen/186c6fb3_93c3_47ec_820d_c58dcdd15bf3
<span class="nv">PWD</span><span class="o">=</span>/usr/local/apache-cassandra-3.11.4/bin
<span class="nv">HOME</span><span class="o">=</span>/home/eiger
<span class="nv">GOROOT</span><span class="o">=</span>/usr/local/go
<span class="nv">TEXTDOMAIN</span><span class="o">=</span>im-config
<span class="nv">SSH_AGENT_PID</span><span class="o">=</span><span class="m">958</span>
<span class="nv">QT_ACCESSIBILITY</span><span class="o">=</span><span class="m">1</span>
<span class="nv">XDG_SESSION_TYPE</span><span class="o">=</span>x11
<span class="nv">XDG_DATA_DIRS</span><span class="o">=</span>/usr/share/ubuntu:/usr/local/share:/usr/share:/var/lib/snapd/desktop
<span class="nv">XDG_SESSION_DESKTOP</span><span class="o">=</span>ubuntu
<span class="nv">GJS_DEBUG_OUTPUT</span><span class="o">=</span>stderr
<span class="nv">GTK_MODULES</span><span class="o">=</span>gail:atk-bridge
<span class="nv">WINDOWPATH</span><span class="o">=</span><span class="m">1</span>
<span class="nv">TERM</span><span class="o">=</span>xterm-256color
<span class="nv">SHELL</span><span class="o">=</span>/bin/bash
<span class="nv">VTE_VERSION</span><span class="o">=</span><span class="m">5202</span>
<span class="nv">QT_IM_MODULE</span><span class="o">=</span>fcitx
<span class="nv">XMODIFIERS</span><span class="o">=</span>@im<span class="o">=</span>fcitx
<span class="nv">IM_CONFIG_PHASE</span><span class="o">=</span><span class="m">2</span>
<span class="nv">XDG_CURRENT_DESKTOP</span><span class="o">=</span>ubuntu:GNOME
<span class="nv">GPG_AGENT_INFO</span><span class="o">=</span>/run/user/1000/gnupg/S.gpg-agent:0:1
<span class="nv">GNOME_TERMINAL_SERVICE</span><span class="o">=</span>:1.85
<span class="nv">XDG_SEAT</span><span class="o">=</span>seat0
<span class="nv">SHLVL</span><span class="o">=</span><span class="m">1</span>
<span class="nv">GDMSESSION</span><span class="o">=</span>ubuntu
<span class="nv">GNOME_DESKTOP_SESSION_ID</span><span class="o">=</span>this-is-deprecated
<span class="nv">LOGNAME</span><span class="o">=</span>eiger
<span class="nv">DBUS_SESSION_BUS_ADDRESS</span><span class="o">=</span>unix:path<span class="o">=</span>/run/user/1000/bus
<span class="nv">XDG_RUNTIME_DIR</span><span class="o">=</span>/run/user/1000
<span class="nv">XAUTHORITY</span><span class="o">=</span>/run/user/1000/gdm/Xauthority
<span class="nv">GOBIN</span><span class="o">=</span>/home/eiger/gopath-default/bin
<span class="nv">XDG_CONFIG_DIRS</span><span class="o">=</span>/etc/xdg/xdg-ubuntu:/etc/xdg
<span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/go/bin:/home/eiger/gopath-default/bin:/usr/local/protobuf-3.9.1-linux-x86_64/bin
<span class="nv">GJS_DEBUG_TOPICS</span><span class="o">=</span>JS ERROR<span class="p">;</span>JS LOG
<span class="nv">SESSION_MANAGER</span><span class="o">=</span>local/eiger-ThinkPad-X1-Carbon-3rd:@/tmp/.ICE-unix/868,unix/eiger-ThinkPad-X1-Carbon-3rd:/tmp/.ICE-unix/868
<span class="nv">LESSOPEN</span><span class="o">=</span><span class="p">|</span> /usr/bin/lesspipe %s
<span class="nv">GTK_IM_MODULE</span><span class="o">=</span>fcitx
<span class="nv">_</span><span class="o">=</span>/usr/bin/env
</code></pre></td></tr></table>
</div>
</div><p>很不幸的是，PATH中不仅没有CASSANDRA，连之前设置了的JDK也没了。我们再次打开/etc/profile看下目前的环境变量设置情况：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># go environment</span>
<span class="c1"># export PATH=$PATH:/usr/local/go/bin</span>
<span class="nb">export</span> <span class="nv">GOROOT</span><span class="o">=</span>/usr/local/go
<span class="nb">export</span> <span class="nv">GOPATH</span><span class="o">=</span>/home/eiger/gopath-default
<span class="nb">export</span> <span class="nv">GOBIN</span><span class="o">=</span><span class="nv">$GOPATH</span>/bin
<span class="nb">export</span> <span class="nv">GOPROXY</span><span class="o">=</span>https://goproxy.io
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$GOROOT</span>/bin
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$GOPATH</span>/bin
<span class="c1"># protoc</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/protobuf-3.9.1-linux-x86_64/bin
<span class="c1"># cassandra</span>
<span class="nb">export</span> <span class="nv">CASSANDRA_HOME</span><span class="o">=</span>/usr/local/apache-cassandra-3.11.4
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="si">${</span><span class="nv">CASSANDRA_HOME</span><span class="si">}</span>/bin
<span class="c1"># jdk</span>
<span class="nb">export</span> <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/lib/jvm/jdk-12.0.2
<span class="nb">export</span> <span class="nv">CLASSPATH</span><span class="o">=</span>.:<span class="si">${</span><span class="nv">JAVA_HOME</span><span class="si">}</span>/lib
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="si">${</span><span class="nv">JAVA_HOME</span><span class="si">}</span>/bin
</code></pre></td></tr></table>
</div>
</div><p>看了下并没有问题，重新执行一遍<code>source /etc/profile</code>再查看env：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/go/bin:/home/eiger/gopath-default/bin:/usr/local/protobuf-3.9.1-linux-x86_64/bin:/usr/local/go/bin:/home/eiger/gopath-default/bin:/usr/local/protobuf-3.9.1-linux-x86_64/bin:/usr/local/apache-cassandra-3.11.4/bin:/usr/lib/jvm/jdk-12.0.2/bin
</code></pre></td></tr></table>
</div>
</div><p>又正常了，神奇&hellip;</p>
<p>现在试试在任意位置直接调用cassandra：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ <span class="o">[</span>0.000s<span class="o">][</span>warning<span class="o">][</span>gc<span class="o">]</span> -Xloggc is deprecated. Will use -Xlog:gc:/usr/local/apache-cassandra-3.11.4/logs/gc.log instead.
intx <span class="nv">ThreadPriorityPolicy</span><span class="o">=</span><span class="m">42</span> is outside the allowed range <span class="o">[</span> <span class="m">0</span> ... <span class="m">1</span> <span class="o">]</span>
Improperly specified VM option <span class="s1">&#39;ThreadPriorityPolicy=42&#39;</span>
Error: Could not create the Java Virtual Machine.
Error: A fatal exception has occurred. Program will exit.
</code></pre></td></tr></table>
</div>
</div><p>结果是能调用，但是报错了。而且错误和前边<code>${CASSANDRA_HOME}/bin</code>下执行<code>./cassandra</code>报的错还不一样。</p>
<p>根据前面的错误，提示说需要JAVA 8u40或往后版本，可能前面的想法是错的，它要求的是统一大版本下的更高版本，而不能是更高大版本，也就是说我安装JAVA 12是安装了一个不符要求的版本。这样的话，参照session 10.5安装java 8，过程略过。</p>
<p>安装好java8后重新进行测试：</p>
<ul>
<li>执行<code>cassandra</code>后输出了很长的信息，这里不展示，大致意思是各种权限不足，因此加上sudo，但蛋疼的是加上sudo之后提示cassandra命令找不到，这和前面使用docker时一样，都遇到了加上sudo找不到命令的问题。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 输入cassandra后产生了很长的报错信息</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ cassandra
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM warning: Cannot open file /usr/local/apache-cassandra-3.11.4/logs/gc.log due to No such file or directory
<span class="c1"># sudo cassandra找不到命令</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ sudo cassandra
sudo: cassandra: <span class="nb">command</span> not found
</code></pre></td></tr></table>
</div>
</div><p>参照<a href="#111-sudoxxx%e6%89%be%e4%b8%8d%e5%88%b0xxx%e5%91%bd%e4%bb%a4">11.1 sudo+xxx:找不到xxx命令</a>解决该问题后，重新输入<code>sudo cassandra</code>测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/Downloads$ sudo cassandra
Running Cassandra as root user or group is not recommended - please start Cassandra using a different system user.
If you really want to force running Cassandra as root, use -R <span class="nb">command</span> line option.
</code></pre></td></tr></table>
</div>
</div><p>现在没有问题了，尽管cassandra发出警告说不建议使用root用户运行cassandra，但是不管了，反正只是测试用。</p>
<p>输入：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo cassandra -R
</code></pre></td></tr></table>
</div>
</div><p>结果仍然是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/Downloads$ sudo cassandra -R
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/Downloads$ Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM warning: Cannot open file /usr/local/apache-cassandra-3.11.4/logs/gc.log due to No such file or directory
</code></pre></td></tr></table>
</div>
</div><p>还是尝试下提升当前用户权限<code>sudo chown -R $USER:$(id -gn $USER) /home/eiger/.config</code>是否可以让<code>cassandra</code>运行成功，但是仍然报错，从报错信息中分析得出，问题出在无论是eiger用户还是root用户都无法在/usr/local/cassandra_homedir下创建目录、写入数据，从这一点看，修改该目录及其子目录的读写权限应该是可以解决问题的。</p>
<p>同时在stackoverflow上发现一个问题求助： <a href="https://stackoverflow.com/questions/47976248/gc-log-file-error-when-running-cassandra">https://stackoverflow.com/questions/47976248/gc-log-file-error-when-running-cassandra</a>，与当前遇到的问题一致。</p>
<p>其中给出的解决方法及解释是：</p>
<p>cassandra用一个gc.log文件来记录所有的gc（垃圾回收）日志， gc.log文件路径在cassandra-env.sh文件中定义：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">#GC log path has to be defined here because it needs to access CASSANDRA_HOME</span>
<span class="nv">JVM_OPTS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$JVM_OPTS</span><span class="s2"> -Xloggc:</span><span class="si">${</span><span class="nv">CASSANDRA_HOME</span><span class="si">}</span><span class="s2">/logs/gc.log&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>据此给出的解决方法就是：确保cassandra目录下有logs文件夹，并确保它能被cassandra修改写入。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4$ ls
bin                  conf  interface  LICENSE.txt  NOTICE.txt
CASSANDRA-14092.txt  data  javadoc    logs         pylib
CHANGES.txt          doc   lib        NEWS.txt     tools
eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4$ ls logs
debug.log  system.log
</code></pre></td></tr></table>
</div>
</div><p>先查看logs文件夹权限：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4$ ll logs
total <span class="m">740</span>
drwxr-xr-x  <span class="m">2</span> root root   <span class="m">4096</span> Aug <span class="m">13</span> 23:42 ./
drwxr-xr-x <span class="m">12</span> root root   <span class="m">4096</span> Aug <span class="m">13</span> 23:58 ../
-rw-r--r--  <span class="m">1</span> root root <span class="m">701303</span> Aug <span class="m">13</span> 23:43 debug.log
-rw-r--r--  <span class="m">1</span> root root  <span class="m">42050</span> Aug <span class="m">13</span> 23:43 system.log
</code></pre></td></tr></table>
</div>
</div><p>显然，logs文件夹及内容仅归root用户所有。合理的做法当然是为需要使用cassandra的用户提升写权限，但是这里就直接提升所有用户权限了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4$ sudo chmod -R <span class="m">777</span> logs
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> eiger:
eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4$ ll logs
total <span class="m">740</span>
drwxrwxrwx  <span class="m">2</span> root root   <span class="m">4096</span> Aug <span class="m">13</span> 23:42 ./
drwxr-xr-x <span class="m">12</span> root root   <span class="m">4096</span> Aug <span class="m">13</span> 23:58 ../
-rwxrwxrwx  <span class="m">1</span> root root <span class="m">701303</span> Aug <span class="m">13</span> 23:43 debug.log*
-rwxrwxrwx  <span class="m">1</span> root root  <span class="m">42050</span> Aug <span class="m">13</span> 23:43 system.log*
</code></pre></td></tr></table>
</div>
</div><p>我们再来执行下<code>cassandra</code>试试，这一次没有再出现找不到logs/gc.log的问题，但是在冗长的输出信息中有了一个新的错误：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 前边省略</span>
ERROR <span class="o">[</span>main<span class="o">]</span> 2019-08-14 00:40:31,492 CassandraDaemon.java:749 - Port already in use: 7199<span class="p">;</span> nested exception is:
    java.net.BindException: Address already in use <span class="o">(</span>Bind failed<span class="o">)</span>
java.net.BindException: Address already in use <span class="o">(</span>Bind failed<span class="o">)</span>
<span class="c1"># 后边省略</span>
</code></pre></td></tr></table>
</div>
</div><p>显示7199端口已经被占用。嗯&hellip;现在我们需要去查看下7199端口被谁用了，再考虑是否修改cassandra端口。</p>
<p>先使用nmap查看下localhost的端口使用情况：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ nmap 127.0.0.1

Starting Nmap 7.60 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2019-08-14 00:51 EDT
Nmap scan report <span class="k">for</span> localhost <span class="o">(</span>127.0.0.1<span class="o">)</span>
Host is up <span class="o">(</span>0.00014s latency<span class="o">)</span>.
Not shown: <span class="m">995</span> closed ports
PORT     STATE SERVICE
80/tcp   open  http
631/tcp  open  ipp
5432/tcp open  postgresql
7000/tcp open  afs3-fileserver
7070/tcp open  realserver

Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 0.06 seconds
</code></pre></td></tr></table>
</div>
</div><p>奇怪的是，7199并未被占用。再用<code>lsof -i:7199</code>和<code>netstat -a | grep 7199</code>查看下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ lsof -i:7199
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ netstat -a <span class="p">|</span> grep <span class="m">7199</span>
tcp        <span class="m">0</span>      <span class="m">0</span> localhost:7199          0.0.0.0:*               LISTEN
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ netstat -ap <span class="p">|</span> grep <span class="m">7199</span>
<span class="o">(</span>Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.<span class="o">)</span>
tcp        <span class="m">0</span>      <span class="m">0</span> localhost:7199          0.0.0.0:*               LISTEN      -
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ sudo netstat -ap <span class="p">|</span> grep <span class="m">7199</span>
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> eiger:
tcp        <span class="m">0</span>      <span class="m">0</span> localhost:7199          0.0.0.0:*               LISTEN      26555/java
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$
</code></pre></td></tr></table>
</div>
</div><p>这说明端口7199被一个java进程监听，但并未建立连接。按照目前的安装进度可以确定java只被cassandra调用了，也就是说7199应该就是被cassandra使用的，这很奇怪&hellip;</p>
<p>现在尝试将使用7199端口的程序关闭</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ sudo <span class="nb">kill</span> -9 <span class="m">26555</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ sudo netstat -ap <span class="p">|</span> grep <span class="m">7199</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$
</code></pre></td></tr></table>
</div>
</div><p>再来启动下cassandra，输出了一长串信息，好的是不再报端口被占用的错，但出现了新状况：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 直接运行`cassandra`</span>
<span class="c1"># 前边省略</span>
WARN  <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:15:07,571 NativeLibrary.java:187 - Unable to lock JVM memory <span class="o">(</span>ENOMEM<span class="o">)</span>. This can result in part of the JVM being swapped out, especially with mmapped I/O enabled. Increase RLIMIT_MEMLOCK or run Cassandra as root.
WARN  <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:15:07,572 StartupChecks.java:136 - jemalloc shared library could not be preloaded to speed up memory allocations
WARN  <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:15:07,573 StartupChecks.java:169 - JMX is not enabled to receive remote connections. Please see cassandra-env.sh <span class="k">for</span> more info.
INFO  <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:15:07,576 SigarLibrary.java:44 - Initializing SIGAR library
WARN  <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:15:07,599 SigarLibrary.java:174 - Cassandra server running in degraded mode. Is swap disabled? : false,  Address space adequate? : true,  nofile limit adequate? : false, nproc limit adequate? : <span class="nb">false</span>
WARN  <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:15:07,606 StartupChecks.java:311 - Maximum number of memory map areas per process <span class="o">(</span>vm.max_map_count<span class="o">)</span> <span class="m">65530</span> is too low, recommended value: 1048575, you can change it with sysctl.
ERROR <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:15:07,625 Directories.java:130 - Doesn<span class="err">&#39;</span>t have write permissions <span class="k">for</span> /usr/local/apache-cassandra-3.11.4/data/data directory
ERROR <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:15:07,626 CassandraDaemon.java:749 - Insufficient permissions on directory /usr/local/apache-cassandra-3.11.4/data/data
</code></pre></td></tr></table>
</div>
</div><p>警告内容主要关乎cassandra的一些配置，当正式需要使用它时再关心这些问题。</p>
<p>错误内容是当前用户eiger对<code>/cassandra/data/data</code>没有写权限，嗯&hellip;设置下权限好了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ <span class="nb">cd</span> /usr/local/apache-cassandra-3.11.4/
eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4$ ls
bin  CASSANDRA-14092.txt  CHANGES.txt  conf  data  doc  interface  javadoc  lib  LICENSE.txt  logs  NEWS.txt  NOTICE.txt  pylib  tools
eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4$ sudo chmod -R <span class="m">777</span> data
eiger@eiger-ThinkPad-X1-Carbon-3rd:/usr/local/apache-cassandra-3.11.4$ ll data
total <span class="m">24</span>
drwxrwxrwx  <span class="m">6</span> root root <span class="m">4096</span> Aug <span class="m">13</span> 23:43 ./
drwxr-xr-x <span class="m">12</span> root root <span class="m">4096</span> Aug <span class="m">13</span> 23:58 ../
drwxrwxrwx  <span class="m">2</span> root root <span class="m">4096</span> Aug <span class="m">13</span> 23:43 commitlog/
drwxrwxrwx  <span class="m">7</span> root root <span class="m">4096</span> Aug <span class="m">13</span> 23:43 data/
drwxrwxrwx  <span class="m">2</span> root root <span class="m">4096</span> Aug <span class="m">13</span> 23:43 hints/
drwxrwxrwx  <span class="m">2</span> root root <span class="m">4096</span> Aug <span class="m">13</span> 23:43 saved_caches/
</code></pre></td></tr></table>
</div>
</div><p>再执行下<code>cassandra</code>试试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 直接运行`cassandra`</span>
<span class="c1"># 前边省略</span>
INFO  <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:22:15,674 StorageService.java:1483 - JOINING: Finish joining ring
INFO  <span class="o">[</span>main<span class="o">]</span> 2019-08-14 02:22:15,835 StorageService.java:2327 - Node localhost/127.0.0.1 state jump to NORMAL
</code></pre></td></tr></table>
</div>
</div><p>在输出信息中只看到几行警告（关于远程调用的一些东西，因为cassandra是个分布式的数据库，我们这里只是在本地开启了一个cassandra节点），其余正常，而且，根据网上关于安装cassandra的一些博客，当看到最后输出这两行信息，那说明cassandra正常启动了。</p>
<p>总算完成了，这就是个大坑！</p>
<h3 id="103-安装nats">10.3. 安装nats</h3>
<p>nats是一个开源的消息中间件，或者叫消息系统。在这类系统中，一个或多个消息发布者将特定主题消息发送给一个消息终结者，消息中介者再将消息分发给任意客户端（主题的订阅者），这样的结构使得消息发布和消息订阅解耦合，大大提升了系统的伸缩性和扩容性。</p>
<p>下载地址：<a href="https://github.com/nats-io/nats-server/releases">https://github.com/nats-io/nats-server/releases</a>， 选择linux-amd64版本下载。
解压后可以看到内部只有一个nats-server可执行文件和license以及readme文件，那么只要把nats-server复制到指定目录即可（放哪都可以，只不过启动路径不同）。我选择将其复制到/usr/local/bin下，因为这个目录是默认的PATH，不需要自己再导出为环境变量了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/Downloads$ <span class="nb">cd</span> nats-server-v2.0.2-linux-amd64/
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/Downloads/nats-server-v2.0.2-linux-amd64$ ls
LICENSE  nats-server  README.md
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/Downloads/nats-server-v2.0.2-linux-amd64$ sudo cp nats-server /usr/local/bin
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> eiger:
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/Downloads/nats-server-v2.0.2-linux-amd64$ <span class="nb">cd</span> ~
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ nats-server
<span class="o">[</span>14426<span class="o">]</span> 2019/08/13 04:08:08.391981 <span class="o">[</span>INF<span class="o">]</span> Starting nats-server version 2.0.2
<span class="o">[</span>14426<span class="o">]</span> 2019/08/13 04:08:08.392040 <span class="o">[</span>INF<span class="o">]</span> Git commit <span class="o">[</span>not set<span class="o">]</span>
<span class="o">[</span>14426<span class="o">]</span> 2019/08/13 04:08:08.392148 <span class="o">[</span>INF<span class="o">]</span> Listening <span class="k">for</span> client connections on 0.0.0.0:4222
<span class="o">[</span>14426<span class="o">]</span> 2019/08/13 04:08:08.392156 <span class="o">[</span>INF<span class="o">]</span> Server id is NDPVONLH4TUGRYY357FPWWGIZWUQLGLIBJIDSDXFLVVPS2P72C7YZNA5
<span class="o">[</span>14426<span class="o">]</span> 2019/08/13 04:08:08.392160 <span class="o">[</span>INF<span class="o">]</span> Server is ready
</code></pre></td></tr></table>
</div>
</div><p>现在nats-server就安装好了。默认端口是4222。</p>
<p>其他方式安装及用法等参考<a href="https://nats-io.github.io/docs/nats_server/installation.html">https://nats-io.github.io/docs/nats_server/installation.html</a></p>
<h3 id="104-安装java开发环境java-12">10.4. 安装Java开发环境（Java 12）</h3>
<p>首先介绍下Java开发环境。经常看到JDK、JRE，而且还有SE、EE等等版本。他们的关系是什么呢？</p>
<p>JDK指Java Development Kit，开发套件；JRE指Java Runtime Environment，运行时环境。通常，开发时使用JDK来进行应用开发及测试，JRE则用于实际生产环境中的部署。用集合的概念描述的话，JRE是JDK的子集，JDK多了很多开发用的东西，比如说调试工具。</p>
<p>而EE、SE等版本，SE是标准版，免费使用，而EE是企业版，面向企业，收费应用。</p>
<p>因此，我们通常讲的配置Java开发环境往往指的是安装JDK SE。</p>
<p>首先到官网下载jdk包 <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk12-downloads-5295953.html">https://www.oracle.com/technetwork/java/javase/downloads/jdk12-downloads-5295953.html</a>，
我所使用的电脑可以下载linux-amd64版本的.tar.gz包、.deb包、.rpm包。
这里建议下载.tar.gz压缩包，自己解压后放到一个路径比如说/usr/local下，这样自己很清楚装在哪。</p>
<p>当然我下载了.deb包，由于网速较差，就不再下.tar.gz了。</p>
<p>安装jdk的deb包或者rpm的坑在于：它的安装信息接近于0，既不告诉你安装到哪去了，也不自动帮你注册环境变量。</p>
<p>所以当你安装完成，兴冲冲地输入<code>java --version</code>，很遗憾，该命令不存在。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:/tmp/mozilla_eiger0$ sudo dpkg -i jdk-12.0.2_linux-x64_bin.deb
<span class="o">(</span>Reading database ... <span class="m">176755</span> files and directories currently installed.<span class="o">)</span>
Preparing to unpack jdk-12.0.2_linux-x64_bin.deb ...
Unpacking jdk-12.0.2 <span class="o">(</span>12.0.2-1<span class="o">)</span> over <span class="o">(</span>12.0.2-1<span class="o">)</span> ...
Setting up jdk-12.0.2 <span class="o">(</span>12.0.2-1<span class="o">)</span> ...
eiger@eiger-ThinkPad-X1-Carbon-3rd:/tmp/mozilla_eiger0$ java --version

Command <span class="s1">&#39;java&#39;</span> not found, but can be installed with:

sudo apt install default-jre
sudo apt install openjdk-11-jre-headless
sudo apt install openjdk-8-jre-headless
</code></pre></td></tr></table>
</div>
</div><p>(ps: 虽然apt提供了openjdk和openjre的直接下载，但要注意openjdk和jdk之间的关系，openjdk是jdk中最基本的部分，缺少一些内容，为了避免踩坑，还是老老实实安装jdk、jre)</p>
<p>好了，想办法找到jdk安装到哪个地方吧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:/tmp/mozilla_eiger0$ sudo dpkg -L jdk-12.0.2
/.
/usr
/usr/lib
/usr/lib/jvm
/usr/lib/jvm/jdk-12.0.2
/usr/lib/jvm/jdk-12.0.2/release
/usr/lib/jvm/jdk-12.0.2/jmods
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jlink.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jdwp.agent.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jstatd.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.unsupported.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.smartcardio.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.sctp.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.naming.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.management.agent.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.internal.jvmstat.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.pack.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.internal.le.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.naming.dns.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.transaction.xa.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.net.http.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.sql.rowset.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.localedata.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.security.jgss.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.internal.ed.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.naming.rmi.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.management.rmi.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.security.sasl.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jshell.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.internal.vm.compiler.management.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.hotspot.agent.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.internal.vm.ci.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.desktop.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.security.auth.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.security.jgss.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jfr.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.rmic.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.rmi.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.scripting.nashorn.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.aot.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jconsole.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.crypto.cryptoki.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.base.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.xml.dom.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jdeps.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.management.jfr.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.se.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.zipfs.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.instrument.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.editpad.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.sql.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.management.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.javadoc.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.crypto.ec.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jartool.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.charsets.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.xml.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.attach.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.datatransfer.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jsobject.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.dynalink.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.logging.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.internal.opt.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.unsupported.desktop.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.compiler.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.net.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jcmd.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.scripting.nashorn.shell.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.compiler.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.jdi.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.management.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.prefs.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.internal.vm.compiler.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.xml.crypto.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.accessibility.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/jdk.httpserver.jmod
/usr/lib/jvm/jdk-12.0.2/jmods/java.scripting.jmod
/usr/lib/jvm/jdk-12.0.2/bin
/usr/lib/jvm/jdk-12.0.2/bin/rmiregistry
/usr/lib/jvm/jdk-12.0.2/bin/rmic
/usr/lib/jvm/jdk-12.0.2/bin/jfr
/usr/lib/jvm/jdk-12.0.2/bin/java
/usr/lib/jvm/jdk-12.0.2/bin/jinfo
/usr/lib/jvm/jdk-12.0.2/bin/unpack200
/usr/lib/jvm/jdk-12.0.2/bin/jimage
/usr/lib/jvm/jdk-12.0.2/bin/jhsdb
/usr/lib/jvm/jdk-12.0.2/bin/javadoc
/usr/lib/jvm/jdk-12.0.2/bin/jps
/usr/lib/jvm/jdk-12.0.2/bin/jarsigner
/usr/lib/jvm/jdk-12.0.2/bin/jmod
/usr/lib/jvm/jdk-12.0.2/bin/jdb
/usr/lib/jvm/jdk-12.0.2/bin/jcmd
/usr/lib/jvm/jdk-12.0.2/bin/jjs
/usr/lib/jvm/jdk-12.0.2/bin/jmap
/usr/lib/jvm/jdk-12.0.2/bin/jdeprscan
/usr/lib/jvm/jdk-12.0.2/bin/javap
/usr/lib/jvm/jdk-12.0.2/bin/jconsole
/usr/lib/jvm/jdk-12.0.2/bin/jrunscript
/usr/lib/jvm/jdk-12.0.2/bin/jstat
/usr/lib/jvm/jdk-12.0.2/bin/keytool
/usr/lib/jvm/jdk-12.0.2/bin/jlink
/usr/lib/jvm/jdk-12.0.2/bin/jdeps
/usr/lib/jvm/jdk-12.0.2/bin/rmid
/usr/lib/jvm/jdk-12.0.2/bin/jstack
/usr/lib/jvm/jdk-12.0.2/bin/jar
/usr/lib/jvm/jdk-12.0.2/bin/jstatd
/usr/lib/jvm/jdk-12.0.2/bin/jaotc
/usr/lib/jvm/jdk-12.0.2/bin/serialver
/usr/lib/jvm/jdk-12.0.2/bin/jshell
/usr/lib/jvm/jdk-12.0.2/bin/pack200
/usr/lib/jvm/jdk-12.0.2/bin/javac
/usr/lib/jvm/jdk-12.0.2/conf
/usr/lib/jvm/jdk-12.0.2/conf/security
/usr/lib/jvm/jdk-12.0.2/conf/security/policy
/usr/lib/jvm/jdk-12.0.2/conf/security/policy/unlimited
/usr/lib/jvm/jdk-12.0.2/conf/security/policy/unlimited/default_local.policy
/usr/lib/jvm/jdk-12.0.2/conf/security/policy/unlimited/default_US_export.policy
/usr/lib/jvm/jdk-12.0.2/conf/security/policy/README.txt
/usr/lib/jvm/jdk-12.0.2/conf/security/policy/limited
/usr/lib/jvm/jdk-12.0.2/conf/security/policy/limited/exempt_local.policy
/usr/lib/jvm/jdk-12.0.2/conf/security/policy/limited/default_local.policy
/usr/lib/jvm/jdk-12.0.2/conf/security/policy/limited/default_US_export.policy
/usr/lib/jvm/jdk-12.0.2/conf/security/java.policy
/usr/lib/jvm/jdk-12.0.2/conf/security/java.security
/usr/lib/jvm/jdk-12.0.2/conf/net.properties
/usr/lib/jvm/jdk-12.0.2/conf/sdp
/usr/lib/jvm/jdk-12.0.2/conf/sdp/sdp.conf.template
/usr/lib/jvm/jdk-12.0.2/conf/logging.properties
/usr/lib/jvm/jdk-12.0.2/conf/sound.properties
/usr/lib/jvm/jdk-12.0.2/conf/management
/usr/lib/jvm/jdk-12.0.2/conf/management/management.properties
/usr/lib/jvm/jdk-12.0.2/conf/management/jmxremote.access
/usr/lib/jvm/jdk-12.0.2/conf/management/jmxremote.password.template
/usr/lib/jvm/jdk-12.0.2/man
/usr/lib/jvm/jdk-12.0.2/man/man1
/usr/lib/jvm/jdk-12.0.2/man/man1/jmod.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jaccessinspector.1
/usr/lib/jvm/jdk-12.0.2/man/man1/rmic.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jhsdb.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jshell.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jconsole.1
/usr/lib/jvm/jdk-12.0.2/man/man1/rmid.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jmap.1
/usr/lib/jvm/jdk-12.0.2/man/man1/ktab.1
/usr/lib/jvm/jdk-12.0.2/man/man1/rmiregistry.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jdeps.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jar.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jdeprscan.1
/usr/lib/jvm/jdk-12.0.2/man/man1/klist.1
/usr/lib/jvm/jdk-12.0.2/man/man1/keytool.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jaccesswalker.1
/usr/lib/jvm/jdk-12.0.2/man/man1/pack200.1
/usr/lib/jvm/jdk-12.0.2/man/man1/javadoc.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jstat.1
/usr/lib/jvm/jdk-12.0.2/man/man1/kinit.1
/usr/lib/jvm/jdk-12.0.2/man/man1/javap.1
/usr/lib/jvm/jdk-12.0.2/man/man1/java.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jstatd.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jstack.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jps.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jlink.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jinfo.1
/usr/lib/jvm/jdk-12.0.2/man/man1/serialver.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jrunscript.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jarsigner.1
/usr/lib/jvm/jdk-12.0.2/man/man1/unpack200.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jcmd.1
/usr/lib/jvm/jdk-12.0.2/man/man1/javac.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jdb.1
/usr/lib/jvm/jdk-12.0.2/man/man1/jjs.1
/usr/lib/jvm/jdk-12.0.2/legal
/usr/lib/jvm/jdk-12.0.2/legal/jdk.unsupported.desktop
/usr/lib/jvm/jdk-12.0.2/legal/java.logging
/usr/lib/jvm/jdk-12.0.2/legal/java.naming
/usr/lib/jvm/jdk-12.0.2/legal/jdk.httpserver
/usr/lib/jvm/jdk-12.0.2/legal/jdk.accessibility
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jdeps
/usr/lib/jvm/jdk-12.0.2/legal/jdk.localedata
/usr/lib/jvm/jdk-12.0.2/legal/jdk.localedata/thaidict.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.vm.compiler
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jlink
/usr/lib/jvm/jdk-12.0.2/legal/java.net.http
/usr/lib/jvm/jdk-12.0.2/legal/java.datatransfer
/usr/lib/jvm/jdk-12.0.2/legal/java.security.sasl
/usr/lib/jvm/jdk-12.0.2/legal/java.scripting
/usr/lib/jvm/jdk-12.0.2/legal/java.sql
/usr/lib/jvm/jdk-12.0.2/legal/jdk.sctp
/usr/lib/jvm/jdk-12.0.2/legal/java.management
/usr/lib/jvm/jdk-12.0.2/legal/jdk.hotspot.agent
/usr/lib/jvm/jdk-12.0.2/legal/jdk.crypto.ec
/usr/lib/jvm/jdk-12.0.2/legal/jdk.crypto.ec/ecc.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jsobject
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.opt
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.opt/jopt-simple.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jartool
/usr/lib/jvm/jdk-12.0.2/legal/jdk.crypto.cryptoki
/usr/lib/jvm/jdk-12.0.2/legal/jdk.crypto.cryptoki/pkcs11wrapper.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.crypto.cryptoki/pkcs11cryptotoken.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.editpad
/usr/lib/jvm/jdk-12.0.2/legal/jdk.naming.dns
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.vm.compiler.management
/usr/lib/jvm/jdk-12.0.2/legal/java.prefs
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.vm.ci
/usr/lib/jvm/jdk-12.0.2/legal/java.xml.crypto
/usr/lib/jvm/jdk-12.0.2/legal/java.xml.crypto/santuario.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.zipfs
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jcmd
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/giflib.md
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/harfbuzz.md
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/colorimaging.md
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/jpeg.md
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/xwd.md
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/mesa3d.md
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/opengl.md
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/libpng.md
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/lcms.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jfr
/usr/lib/jvm/jdk-12.0.2/legal/jdk.attach
/usr/lib/jvm/jdk-12.0.2/legal/jdk.scripting.nashorn
/usr/lib/jvm/jdk-12.0.2/legal/jdk.scripting.nashorn/double-conversion.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.scripting.nashorn/joni.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.xml.dom
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jstatd
/usr/lib/jvm/jdk-12.0.2/legal/jdk.management.agent
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jconsole
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jdwp.agent
/usr/lib/jvm/jdk-12.0.2/legal/jdk.net
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jshell
/usr/lib/jvm/jdk-12.0.2/legal/jdk.management
/usr/lib/jvm/jdk-12.0.2/legal/jdk.security.jgss
/usr/lib/jvm/jdk-12.0.2/legal/java.smartcardio
/usr/lib/jvm/jdk-12.0.2/legal/java.smartcardio/pcsclite.md
/usr/lib/jvm/jdk-12.0.2/legal/java.sql.rowset
/usr/lib/jvm/jdk-12.0.2/legal/java.base
/usr/lib/jvm/jdk-12.0.2/legal/java.base/cldr.md
/usr/lib/jvm/jdk-12.0.2/legal/java.base/aes.md
/usr/lib/jvm/jdk-12.0.2/legal/java.base/unicode.md
/usr/lib/jvm/jdk-12.0.2/legal/java.base/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.base/icu.md
/usr/lib/jvm/jdk-12.0.2/legal/java.base/c-libutl.md
/usr/lib/jvm/jdk-12.0.2/legal/java.base/asm.md
/usr/lib/jvm/jdk-12.0.2/legal/java.base/public_suffix.md
/usr/lib/jvm/jdk-12.0.2/legal/java.base/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.xml
/usr/lib/jvm/jdk-12.0.2/legal/java.xml/bcel.md
/usr/lib/jvm/jdk-12.0.2/legal/java.xml/xalan.md
/usr/lib/jvm/jdk-12.0.2/legal/java.xml/jcup.md
/usr/lib/jvm/jdk-12.0.2/legal/java.xml/xerces.md
/usr/lib/jvm/jdk-12.0.2/legal/java.xml/dom.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.management.jfr
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jdi
/usr/lib/jvm/jdk-12.0.2/legal/java.transaction.xa
/usr/lib/jvm/jdk-12.0.2/legal/jdk.javadoc
/usr/lib/jvm/jdk-12.0.2/legal/jdk.javadoc/jquery-migrate.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.javadoc/pako.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.javadoc/jquery.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.javadoc/jqueryUI.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.javadoc/jszip.md
/usr/lib/jvm/jdk-12.0.2/legal/java.security.jgss
/usr/lib/jvm/jdk-12.0.2/legal/java.se
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.le
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.le/jline.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.dynalink
/usr/lib/jvm/jdk-12.0.2/legal/jdk.dynalink/dynalink.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.naming.rmi
/usr/lib/jvm/jdk-12.0.2/legal/java.compiler
/usr/lib/jvm/jdk-12.0.2/legal/jdk.unsupported
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.jvmstat
/usr/lib/jvm/jdk-12.0.2/legal/jdk.pack
/usr/lib/jvm/jdk-12.0.2/legal/jdk.compiler
/usr/lib/jvm/jdk-12.0.2/legal/java.management.rmi
/usr/lib/jvm/jdk-12.0.2/legal/jdk.scripting.nashorn.shell
/usr/lib/jvm/jdk-12.0.2/legal/jdk.aot
/usr/lib/jvm/jdk-12.0.2/legal/java.instrument
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.ed
/usr/lib/jvm/jdk-12.0.2/legal/jdk.security.auth
/usr/lib/jvm/jdk-12.0.2/legal/jdk.rmic
/usr/lib/jvm/jdk-12.0.2/legal/jdk.charsets
/usr/lib/jvm/jdk-12.0.2/legal/java.rmi
/usr/lib/jvm/jdk-12.0.2/include
/usr/lib/jvm/jdk-12.0.2/include/classfile_constants.h
/usr/lib/jvm/jdk-12.0.2/include/jvmticmlr.h
/usr/lib/jvm/jdk-12.0.2/include/linux
/usr/lib/jvm/jdk-12.0.2/include/linux/jni_md.h
/usr/lib/jvm/jdk-12.0.2/include/linux/jawt_md.h
/usr/lib/jvm/jdk-12.0.2/include/jawt.h
/usr/lib/jvm/jdk-12.0.2/include/jdwpTransport.h
/usr/lib/jvm/jdk-12.0.2/include/jni.h
/usr/lib/jvm/jdk-12.0.2/include/jvmti.h
/usr/lib/jvm/jdk-12.0.2/lib
/usr/lib/jvm/jdk-12.0.2/lib/security
/usr/lib/jvm/jdk-12.0.2/lib/security/blacklisted.certs
/usr/lib/jvm/jdk-12.0.2/lib/security/cacerts
/usr/lib/jvm/jdk-12.0.2/lib/security/public_suffix_list.dat
/usr/lib/jvm/jdk-12.0.2/lib/security/default.policy
/usr/lib/jvm/jdk-12.0.2/lib/jvm.cfg
/usr/lib/jvm/jdk-12.0.2/lib/libinstrument.so
/usr/lib/jvm/jdk-12.0.2/lib/libprefs.so
/usr/lib/jvm/jdk-12.0.2/lib/jspawnhelper
/usr/lib/jvm/jdk-12.0.2/lib/libjli.so
/usr/lib/jvm/jdk-12.0.2/lib/libj2pcsc.so
/usr/lib/jvm/jdk-12.0.2/lib/jfr
/usr/lib/jvm/jdk-12.0.2/lib/jfr/profile.jfc
/usr/lib/jvm/jdk-12.0.2/lib/jfr/default.jfc
/usr/lib/jvm/jdk-12.0.2/lib/libnet.so
/usr/lib/jvm/jdk-12.0.2/lib/libnio.so
/usr/lib/jvm/jdk-12.0.2/lib/libextnet.so
/usr/lib/jvm/jdk-12.0.2/lib/librmi.so
/usr/lib/jvm/jdk-12.0.2/lib/src.zip
/usr/lib/jvm/jdk-12.0.2/lib/psfontj2d.properties
/usr/lib/jvm/jdk-12.0.2/lib/libj2gss.so
/usr/lib/jvm/jdk-12.0.2/lib/libsunec.so
/usr/lib/jvm/jdk-12.0.2/lib/libmanagement_agent.so
/usr/lib/jvm/jdk-12.0.2/lib/libjawt.so
/usr/lib/jvm/jdk-12.0.2/lib/ct.sym
/usr/lib/jvm/jdk-12.0.2/lib/libawt_headless.so
/usr/lib/jvm/jdk-12.0.2/lib/tzdb.dat
/usr/lib/jvm/jdk-12.0.2/lib/libjsig.so
/usr/lib/jvm/jdk-12.0.2/lib/libjdwp.so
/usr/lib/jvm/jdk-12.0.2/lib/jrt-fs.jar
/usr/lib/jvm/jdk-12.0.2/lib/libsaproc.so
/usr/lib/jvm/jdk-12.0.2/lib/libzip.so
/usr/lib/jvm/jdk-12.0.2/lib/libjaas.so
/usr/lib/jvm/jdk-12.0.2/lib/psfont.properties.ja
/usr/lib/jvm/jdk-12.0.2/lib/libfontmanager.so
/usr/lib/jvm/jdk-12.0.2/lib/libsctp.so
/usr/lib/jvm/jdk-12.0.2/lib/libjimage.so
/usr/lib/jvm/jdk-12.0.2/lib/libmanagement_ext.so
/usr/lib/jvm/jdk-12.0.2/lib/liblcms.so
/usr/lib/jvm/jdk-12.0.2/lib/modules
/usr/lib/jvm/jdk-12.0.2/lib/libsplashscreen.so
/usr/lib/jvm/jdk-12.0.2/lib/libawt.so
/usr/lib/jvm/jdk-12.0.2/lib/classlist
/usr/lib/jvm/jdk-12.0.2/lib/libverify.so
/usr/lib/jvm/jdk-12.0.2/lib/libjavajpeg.so
/usr/lib/jvm/jdk-12.0.2/lib/libmlib_image.so
/usr/lib/jvm/jdk-12.0.2/lib/libjava.so
/usr/lib/jvm/jdk-12.0.2/lib/libattach.so
/usr/lib/jvm/jdk-12.0.2/lib/libawt_xawt.so
/usr/lib/jvm/jdk-12.0.2/lib/libdt_socket.so
/usr/lib/jvm/jdk-12.0.2/lib/server
/usr/lib/jvm/jdk-12.0.2/lib/server/libjsig.so
/usr/lib/jvm/jdk-12.0.2/lib/server/classes.jsa
/usr/lib/jvm/jdk-12.0.2/lib/server/libjvm.so
/usr/lib/jvm/jdk-12.0.2/lib/server/Xusage.txt
/usr/lib/jvm/jdk-12.0.2/lib/libjsound.so
/usr/lib/jvm/jdk-12.0.2/lib/libj2pkcs11.so
/usr/lib/jvm/jdk-12.0.2/lib/jexec
/usr/lib/jvm/jdk-12.0.2/lib/libunpack.so
/usr/lib/jvm/jdk-12.0.2/lib/libmanagement.so
/usr/share
/usr/share/doc
/usr/share/doc/jdk-12.0.2
/usr/share/doc/jdk-12.0.2/copyright
/usr/lib/jvm/jdk-12.0.2/legal/jdk.unsupported.desktop/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.unsupported.desktop/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.logging/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.logging/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.naming/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.naming/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.httpserver/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.httpserver/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.accessibility/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.accessibility/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jdeps/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jdeps/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.localedata/cldr.md
/usr/lib/jvm/jdk-12.0.2/legal/jdk.localedata/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.localedata/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.vm.compiler/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.vm.compiler/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jlink/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jlink/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.net.http/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.net.http/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.datatransfer/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.datatransfer/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.security.sasl/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.security.sasl/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.scripting/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.scripting/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.sql/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.sql/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.sctp/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.sctp/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.management/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.management/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.hotspot.agent/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.hotspot.agent/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.crypto.ec/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.crypto.ec/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jsobject/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jsobject/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.opt/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.opt/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jartool/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jartool/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.crypto.cryptoki/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.crypto.cryptoki/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.editpad/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.editpad/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.naming.dns/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.naming.dns/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.vm.compiler.management/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.vm.compiler.management/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.prefs/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.prefs/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.vm.ci/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.vm.ci/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.xml.crypto/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.xml.crypto/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.zipfs/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.zipfs/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jcmd/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jcmd/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.desktop/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jfr/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jfr/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.attach/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.attach/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.scripting.nashorn/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.scripting.nashorn/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.xml.dom/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.xml.dom/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jstatd/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jstatd/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.management.agent/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.management.agent/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jconsole/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jconsole/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jdwp.agent/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jdwp.agent/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.net/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.net/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jshell/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jshell/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.management/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.management/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.security.jgss/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.security.jgss/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.smartcardio/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.smartcardio/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.sql.rowset/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.sql.rowset/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.xml/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.xml/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.management.jfr/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.management.jfr/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jdi/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.jdi/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.transaction.xa/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.transaction.xa/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.javadoc/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.javadoc/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.security.jgss/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.security.jgss/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.se/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.se/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.le/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.le/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.dynalink/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.dynalink/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.naming.rmi/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.naming.rmi/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.compiler/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.compiler/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.unsupported/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.unsupported/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.jvmstat/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.jvmstat/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.pack/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.pack/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.compiler/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.compiler/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.management.rmi/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.management.rmi/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.scripting.nashorn.shell/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.scripting.nashorn.shell/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.aot/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.aot/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.instrument/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.instrument/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.ed/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.internal.ed/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.security.auth/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.security.auth/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.rmic/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.rmic/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/jdk.charsets/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/jdk.charsets/COPYRIGHT
/usr/lib/jvm/jdk-12.0.2/legal/java.rmi/LICENSE
/usr/lib/jvm/jdk-12.0.2/legal/java.rmi/COPYRIGHT
</code></pre></td></tr></table>
</div>
</div><p>从输出信息可以看出，安装完成后，除了一个copyright文件放在了/usr/share/doc/jdk-12.0.2下，其余文件都在/usr/lib/jvm/jdk-12.0.2下，也就是说这个目录就是我的JAVA_HOME了。</p>
<p>找到了文件安装位置之后，当然是要设置环境变量了：</p>
<p>博文<a href="https://blog.csdn.net/pxmxx/article/details/80106239">https://blog.csdn.net/pxmxx/article/details/80106239</a>及其他很多安装JDK的博文中都指出，在设置环境变量时需要设置JRE_HOME（后面在<a href="#105-%e5%ae%89%e8%a3%85java%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83java-8">10.5 安装Java8</a>中看到安装jdk8后确实目录中含有jre子目录），奇葩的是，JDK安装目录中根本没有jre，于是查阅官方安装说明 <a href="https://docs.oracle.com/en/java/javase/12/install/installation-jdk-linux-platforms.html">https://docs.oracle.com/en/java/javase/12/install/installation-jdk-linux-platforms.html</a>，官方安装文档中则更奇葩，只提及了.tar.gz和.rpm安装，且安装后自动设置好了环境变量，擦。</p>
<p>不管了，反正在/usr/lib/jvm/jdk-12.0.2/bin下找到了一堆java在内的可执行文件，说明没找错位置，自行设置环境变量了，在/etc/profile末尾追加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">export</span> <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/lib/jvm/jdk-12.0.2
<span class="nb">export</span> <span class="nv">CLASSPATH</span><span class="o">=</span>.:<span class="si">${</span><span class="nv">JAVA_HOME</span><span class="si">}</span>/lib
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="si">${</span><span class="nv">JAVA_HOME</span><span class="si">}</span>/bin
</code></pre></td></tr></table>
</div>
</div><p>执行<code>source /etc/profile</code>是变量生效后，进行测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:/tmp/mozilla_eiger0$ <span class="nb">source</span> /etc/profile
eiger@eiger-ThinkPad-X1-Carbon-3rd:/tmp/mozilla_eiger0$ java --version
java 12.0.2 2019-07-16
Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 12.0.2+10<span class="o">)</span>
Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 12.0.2+10, mixed mode, sharing<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>至此，Java开发环境配置完成。</p>
<h3 id="105-安装java开发环境java-8">10.5. 安装Java开发环境（Java 8）</h3>
<p>由于Java SE Development Kit 8u221 （Java8里边的最高版本）没有提供.deb包，因此只能再开一小节讲。tar.gz压缩包方式的安装及多版本Java同时存在情况下的处理。</p>
<p>JDK 8u221下载链接：  <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p>
<p>记得选择linux-x64版。</p>
<p>下载解压后，放置到/usr/local目录下（ps: 顺便下载了jdk8的demos&amp;samples解压后放到jdk8目录下，这和我们的安装进程无关）</p>
<p>设置环境变量如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># jdk12</span>
<span class="c1">#export JAVA_HOME=/usr/lib/jvm/jdk-12.0.2</span>
<span class="c1">#export CLASSPATH=.:${JAVA_HOME}/lib</span>
<span class="c1">#export PATH=$PATH:${JAVA_HOME}/bin</span>
<span class="c1"># jdk8 # 与jdk12不可同时启用</span>
<span class="nb">export</span> <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/local/jdk1.8.0_221
<span class="nb">export</span> <span class="nv">JRE_HOME</span><span class="o">=</span><span class="si">${</span><span class="nv">JAVA_HOME</span><span class="si">}</span>/jre
<span class="nb">export</span> <span class="nv">CLASSPATH</span><span class="o">=</span>.:<span class="si">${</span><span class="nv">JAVA_HOME</span><span class="si">}</span>/lib:<span class="si">${</span><span class="nv">JRE_HOME</span><span class="si">}</span>/lib
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="si">${</span><span class="nv">JAVA_HOME</span><span class="si">}</span>/bin
</code></pre></td></tr></table>
</div>
</div><p>执行<code>source /etc/profile</code>并重启系统后（不重启始终无法生效）进行测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ java -version
java version <span class="s2">&#34;1.8.0_221&#34;</span>
Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 1.8.0_221-b11<span class="o">)</span>
Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 25.221-b11, mixed mode<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>(ps: java8的参数都是单横线开头)</p>
<p>至此，java8安装成功。</p>
<h2 id="11-其他一些问题">11. 其他一些问题</h2>
<h3 id="111-sudoxxx找不到xxx命令">11.1. sudo+xxx:找不到xxx命令</h3>
<p>问题描述： xxx命令在当前用户下用得好好的，一切换到sudo下就提示找不到该命令。比如说在本次mainflux安装过程中遇到的编译所有微服务和测试cassandra时的问题。</p>
<p>在<a href="#42-%e7%bc%96%e8%af%91%e6%89%80%e6%9c%89%e6%9c%8d%e5%8a%a1">4.2 编译所有微服务</a>末尾遇到了<code>sudo make</code>报错找不到go命令，当时通过输入
<code>sudo chown -R $USER:$(id -gn $USER) /home/eiger/.config</code>来提升当前用户权限的方法解决当前用户权限不足而sudo(root)用户找不到go的尴尬。</p>
<p>现在解决<code>sudo xxx:找不到xxx命令</code>的问题：</p>
<p>出现这个问题的原因是，所要使用的应用程序是注册在<code>$PATH</code>变量下的，当使用sudo时会自动重置<code>$PATH</code>变量为初始状态（也就是我没有往里边添加变量、只有系统最开始的一些PATH值的状态），这样的话，当然<code>sudo xxx</code>会找不到命令。我们要做的就是修改相关设置，取消sudo自动重置<code>$PATH</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo nano /etc/sudoers
<span class="c1"># 将 Defaults  env_reset 修改为 Defaults  !env_reset</span>
sudo nano /etc/profile
<span class="c1"># 文件末追加 alias sudo=&#39;sudo env PATH=$PATH&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>执行<code>source /etc/profile</code>后生效。</p>
<h2 id="12-getting-started">12. Getting started</h2>
<p>在官网文档<a href="https://mainflux.readthedocs.io/en/latest/getting-started/">https://mainflux.readthedocs.io/en/latest/getting-started/</a>介绍了如何开始使用mainflux。这里按照原文档顺序对其作翻译、补充及实践记录。</p>
<h3 id="121-运行整个系统">12.1 运行整个系统</h3>
<p>首先，电脑上需安装好docker与docker-compose，并将源码拉取到本地，在mainflux根目录下输入<code>make run</code>，即可启动mainflux的docker容器组合，并且将在终端看到输出信息。</p>
<p>我们去看下mainflux/Makefile内<code>run</code>定义：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Makefile" data-lang="Makefile"><span class="nf">run</span><span class="o">:</span>
  docker-compose -f docker/docker-compose.yml up
</code></pre></td></tr></table>
</div>
</div><p>这告诉我们<code>make run</code>其实是<code>docker-compose -f docker/docker-compose.yml up</code>，根据mainflux/docker/docker-compose.yml文件强制拉起（运行）其内描述的所有容器，那么我们来看下docker-compose.yml内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="c">###</span><span class="w">
</span><span class="w"></span><span class="c"># Copyright (c) 2015-2017 Mainflux</span><span class="w">
</span><span class="w"></span><span class="c">#</span><span class="w">
</span><span class="w"></span><span class="c"># Mainflux is licensed under an Apache license, version 2.0 license.</span><span class="w">
</span><span class="w"></span><span class="c"># All rights not explicitly granted in the Apache license, version 2.0 are reserved.</span><span class="w">
</span><span class="w"></span><span class="c"># See the included LICENSE file for more details.</span><span class="w">
</span><span class="w"></span><span class="c">###</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">mainflux-base-net</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">driver</span><span class="p">:</span><span class="w"> </span>bridge<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">mainflux-users-db-volume</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">mainflux-things-db-volume</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">mainflux-mqtt-redis-volume</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">mainflux-things-redis-volume</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">mainflux-es-redis-volume</span><span class="p">:</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">services</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">nginx</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>nginx<span class="p">:</span><span class="m">1.16.0</span>-alpine<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-nginx<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ./nginx/nginx-${AUTH-key}.conf<span class="p">:</span>/etc/nginx/nginx.conf.template<span class="w">
</span><span class="w">      </span>- ./nginx/entrypoint.sh<span class="p">:</span>/entrypoint.sh<span class="w">
</span><span class="w">      </span>- ./ssl/authorization.js<span class="p">:</span>/etc/nginx/authorization.js<span class="w">
</span><span class="w">      </span>- ./ssl/certs/mainflux-server.crt<span class="p">:</span>/etc/ssl/certs/mainflux-server.crt<span class="w">
</span><span class="w">      </span>- ./ssl/certs/ca.crt<span class="p">:</span>/etc/ssl/certs/ca.crt<span class="w">
</span><span class="w">      </span>- ./ssl/certs/mainflux-server.key<span class="p">:</span>/etc/ssl/private/mainflux-server.key<span class="w">
</span><span class="w">      </span>- ./ssl/dhparam.pem<span class="p">:</span>/etc/ssl/certs/dhparam.pem<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_NGINX_HTTP_PORT}<span class="p">:</span>${MF_NGINX_HTTP_PORT}<span class="w">
</span><span class="w">      </span>- ${MF_NGINX_SSL_PORT}<span class="p">:</span>${MF_NGINX_SSL_PORT}<span class="w">
</span><span class="w">      </span>- ${MF_NGINX_MQTT_PORT}<span class="p">:</span>${MF_NGINX_MQTT_PORT}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">MF_UI_PORT</span><span class="p">:</span><span class="w"> </span>${MF_UI_PORT}<span class="w">
</span><span class="w">    </span><span class="k">command</span><span class="p">:</span><span class="w"> </span>/entrypoint.sh<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">nats</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>nats<span class="p">:</span><span class="m">1.3.0</span><span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-nats<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">users-db</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>postgres<span class="p">:</span><span class="m">10.8</span>-alpine<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-users-db<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span>${MF_USERS_DB_USER}<span class="w">
</span><span class="w">      </span><span class="k">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span>${MF_USERS_DB_PASS}<span class="w">
</span><span class="w">      </span><span class="k">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span>${MF_USERS_DB}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">    </span><span class="k">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-users-db-volume<span class="p">:</span>/var/lib/postgresql/data<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">users</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>mainflux/users<span class="p">:</span>latest<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-users<span class="w">
</span><span class="w">    </span><span class="k">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- users-db<span class="w">
</span><span class="w">    </span><span class="k">expose</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_USERS_GRPC_PORT}<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_LOG_LEVEL</span><span class="p">:</span><span class="w"> </span>${MF_USERS_LOG_LEVEL}<span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_DB_HOST</span><span class="p">:</span><span class="w"> </span>users-db<span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_DB_PORT</span><span class="p">:</span><span class="w"> </span>${MF_USERS_DB_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_DB_USER</span><span class="p">:</span><span class="w"> </span>${MF_USERS_DB_USER}<span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_DB_PASS</span><span class="p">:</span><span class="w"> </span>${MF_USERS_DB_PASS}<span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_DB</span><span class="p">:</span><span class="w"> </span>${MF_USERS_DB}<span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_HTTP_PORT</span><span class="p">:</span><span class="w"> </span>${MF_USERS_HTTP_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_GRPC_PORT</span><span class="p">:</span><span class="w"> </span>${MF_USERS_GRPC_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_SECRET</span><span class="p">:</span><span class="w"> </span>${MF_USERS_SECRET}<span class="w">
</span><span class="w">      </span><span class="k">MF_JAEGER_URL</span><span class="p">:</span><span class="w"> </span>${MF_JAEGER_URL}<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_USERS_HTTP_PORT}<span class="p">:</span>${MF_USERS_HTTP_PORT}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">things-db</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>postgres<span class="p">:</span><span class="m">10.8</span>-alpine<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-things-db<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_DB_USER}<span class="w">
</span><span class="w">      </span><span class="k">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_DB_PASS}<span class="w">
</span><span class="w">      </span><span class="k">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_DB}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">    </span><span class="k">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-things-db-volume<span class="p">:</span>/var/lib/postgresql/data<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">things-redis</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>redis<span class="p">:</span><span class="m">5.0</span>-alpine<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-things-redis<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">    </span><span class="k">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-things-redis-volume<span class="p">:</span>/data<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">things</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>mainflux/things<span class="p">:</span>latest<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-things<span class="w">
</span><span class="w">    </span><span class="k">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- things-db<span class="w">
</span><span class="w">      </span>- users<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_LOG_LEVEL</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_LOG_LEVEL}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_DB_HOST</span><span class="p">:</span><span class="w"> </span>things-db<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_DB_PORT</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_DB_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_DB_USER</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_DB_USER}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_DB_PASS</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_DB_PASS}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_DB</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_DB}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_CACHE_URL</span><span class="p">:</span><span class="w"> </span>things-redis<span class="p">:</span>${MF_REDIS_TCP_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_ES_URL</span><span class="p">:</span><span class="w"> </span>es-redis<span class="p">:</span>${MF_REDIS_TCP_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_HTTP_PORT</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_HTTP_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_AUTH_HTTP_PORT</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_AUTH_HTTP_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_AUTH_GRPC_PORT</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_AUTH_GRPC_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_USERS_URL</span><span class="p">:</span><span class="w"> </span>users<span class="p">:</span>${MF_USERS_GRPC_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_SECRET</span><span class="p">:</span><span class="w"> </span>${MF_THINGS_SECRET}<span class="w">
</span><span class="w">      </span><span class="k">MF_JAEGER_URL</span><span class="p">:</span><span class="w"> </span>${MF_JAEGER_URL}<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_THINGS_HTTP_PORT}<span class="p">:</span>${MF_THINGS_HTTP_PORT}<span class="w">
</span><span class="w">      </span>- ${MF_THINGS_AUTH_HTTP_PORT}<span class="p">:</span>${MF_THINGS_AUTH_HTTP_PORT}<span class="w">
</span><span class="w">      </span>- ${MF_THINGS_AUTH_GRPC_PORT}<span class="p">:</span>${MF_THINGS_AUTH_GRPC_PORT}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">jaeger</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>jaegertracing/all-in-one<span class="p">:</span><span class="m">1.13</span><span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-jaeger<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_JAEGER_PORT}<span class="p">:</span>${MF_JAEGER_PORT}/udp<span class="w">
</span><span class="w">      </span>- ${MF_JAEGER_FRONTEND}<span class="p">:</span>${MF_JAEGER_FRONTEND}<span class="w">
</span><span class="w">      </span>- ${MF_JAEGER_COLLECTOR}<span class="p">:</span>${MF_JAEGER_COLLECTOR}<span class="w">
</span><span class="w">      </span>- ${MF_JAEGER_CONFIGS}<span class="p">:</span>${MF_JAEGER_CONFIGS}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">normalizer</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>mainflux/normalizer<span class="p">:</span>latest<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-normalizer<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- nats<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">MF_NORMALIZER_LOG_LEVEL</span><span class="p">:</span><span class="w"> </span>${MF_NORMALIZER_LOG_LEVEL}<span class="w">
</span><span class="w">      </span><span class="k">MF_NATS_URL</span><span class="p">:</span><span class="w"> </span>${MF_NATS_URL}<span class="w">
</span><span class="w">      </span><span class="k">MF_NORMALIZER_PORT</span><span class="p">:</span><span class="w"> </span>${MF_NORMALIZER_PORT}<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_NORMALIZER_PORT}<span class="p">:</span>${MF_NORMALIZER_PORT}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">ws-adapter</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>mainflux/ws<span class="p">:</span>latest<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-ws<span class="w">
</span><span class="w">    </span><span class="k">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- things<span class="w">
</span><span class="w">      </span>- nats<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">MF_WS_ADAPTER_LOG_LEVEL</span><span class="p">:</span><span class="w"> </span>${MF_WS_ADAPTER_LOG_LEVEL}<span class="w">
</span><span class="w">      </span><span class="k">MF_WS_ADAPTER_PORT</span><span class="p">:</span><span class="w"> </span>${MF_WS_ADAPTER_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_NATS_URL</span><span class="p">:</span><span class="w"> </span>${MF_NATS_URL}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_URL</span><span class="p">:</span><span class="w"> </span>things<span class="p">:</span>${MF_THINGS_AUTH_GRPC_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_JAEGER_URL</span><span class="p">:</span><span class="w"> </span>${MF_JAEGER_URL}<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_WS_ADAPTER_PORT}<span class="p">:</span>${MF_WS_ADAPTER_PORT}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">http-adapter</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>mainflux/http<span class="p">:</span>latest<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-http<span class="w">
</span><span class="w">    </span><span class="k">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- things<span class="w">
</span><span class="w">      </span>- nats<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">MF_HTTP_ADAPTER_LOG_LEVEL</span><span class="p">:</span><span class="w"> </span>debug<span class="w">
</span><span class="w">      </span><span class="k">MF_HTTP_ADAPTER_PORT</span><span class="p">:</span><span class="w"> </span>${MF_HTTP_ADAPTER_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_NATS_URL</span><span class="p">:</span><span class="w"> </span>${MF_NATS_URL}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_URL</span><span class="p">:</span><span class="w"> </span>things<span class="p">:</span>${MF_THINGS_AUTH_GRPC_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_JAEGER_URL</span><span class="p">:</span><span class="w"> </span>${MF_JAEGER_URL}<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_HTTP_ADAPTER_PORT}<span class="p">:</span>${MF_HTTP_ADAPTER_PORT}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">es-redis</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>redis<span class="p">:</span><span class="m">5.0</span>-alpine<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-es-redis<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">    </span><span class="k">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-es-redis-volume<span class="p">:</span>/data<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">mqtt-redis</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>redis<span class="p">:</span><span class="m">5.0</span>-alpine<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-mqtt-redis<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">    </span><span class="k">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-mqtt-redis-volume<span class="p">:</span>/data<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">mqtt-adapter</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>mainflux/mqtt<span class="p">:</span>latest<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-mqtt<span class="w">
</span><span class="w">    </span><span class="k">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- things<span class="w">
</span><span class="w">      </span>- nats<span class="w">
</span><span class="w">      </span>- mqtt-redis<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">MF_MQTT_ADAPTER_LOG_LEVEL</span><span class="p">:</span><span class="w"> </span>${MF_MQTT_ADAPTER_LOG_LEVEL}<span class="w">
</span><span class="w">      </span><span class="k">MF_MQTT_INSTANCE_ID</span><span class="p">:</span><span class="w"> </span>mqtt-adapter<span class="m">-1</span><span class="w">
</span><span class="w">      </span><span class="k">MF_MQTT_ADAPTER_PORT</span><span class="p">:</span><span class="w"> </span>${MF_MQTT_ADAPTER_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_MQTT_ADAPTER_WS_PORT</span><span class="p">:</span><span class="w"> </span>${MF_MQTT_ADAPTER_WS_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_MQTT_ADAPTER_REDIS_HOST</span><span class="p">:</span><span class="w"> </span>mqtt-redis<span class="w">
</span><span class="w">      </span><span class="k">MF_MQTT_ADAPTER_ES_HOST</span><span class="p">:</span><span class="w"> </span>es-redis<span class="w">
</span><span class="w">      </span><span class="k">MF_NATS_URL</span><span class="p">:</span><span class="w"> </span>${MF_NATS_URL}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_URL</span><span class="p">:</span><span class="w"> </span>things<span class="p">:</span>${MF_THINGS_AUTH_GRPC_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_JAEGER_URL</span><span class="p">:</span><span class="w"> </span>${MF_JAEGER_URL}<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_MQTT_ADAPTER_PORT}<span class="p">:</span>${MF_MQTT_ADAPTER_PORT}<span class="w">
</span><span class="w">      </span>- ${MF_MQTT_ADAPTER_WS_PORT}<span class="p">:</span>${MF_MQTT_ADAPTER_WS_PORT}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">coap-adapter</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>mainflux/coap<span class="p">:</span>latest<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-coap<span class="w">
</span><span class="w">    </span><span class="k">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- things<span class="w">
</span><span class="w">      </span>- nats<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">MF_COAP_ADAPTER_LOG_LEVEL</span><span class="p">:</span><span class="w"> </span>${MF_COAP_ADAPTER_LOG_LEVEL}<span class="w">
</span><span class="w">      </span><span class="k">MF_COAP_ADAPTER_PORT</span><span class="p">:</span><span class="w"> </span>${MF_COAP_ADAPTER_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_NATS_URL</span><span class="p">:</span><span class="w"> </span>${MF_NATS_URL}<span class="w">
</span><span class="w">      </span><span class="k">MF_THINGS_URL</span><span class="p">:</span><span class="w"> </span>things<span class="p">:</span>${MF_THINGS_AUTH_GRPC_PORT}<span class="w">
</span><span class="w">      </span><span class="k">MF_JAEGER_URL</span><span class="p">:</span><span class="w"> </span>${MF_JAEGER_URL}<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_COAP_ADAPTER_PORT}<span class="p">:</span>${MF_COAP_ADAPTER_PORT}/udp<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">ui</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>mainflux/ui<span class="p">:</span>latest<span class="w">
</span><span class="w">    </span><span class="k">container_name</span><span class="p">:</span><span class="w"> </span>mainflux-ui<span class="w">
</span><span class="w">    </span><span class="k">restart</span><span class="p">:</span><span class="w"> </span>on-failure<span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ${MF_UI_PORT}<span class="p">:</span>${MF_UI_PORT}<span class="w">
</span><span class="w">    </span><span class="k">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- mainflux-base-net<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">MF_UI_PORT</span><span class="p">:</span><span class="w"> </span>${MF_UI_PORT}<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>当docker-compose在本地容器中无法找到文件中描述的容器时，会从docker镜像网站去拉取mainflux上传的相应镜像并容器化运行。该文件还描述了各个容器与本机真实物理环境之间的映射关系，之后在使用的过程中应多借助该文档。</p>
<p>好了，我们现在来实际操作一下。</p>
<p>首先，因为之前进行了，docker镜像的手动构建（完成）以及运行测试（部分容器得到启动，并逐次解决了相应的问题），我们需要列举下当前本机的容器及镜像：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 查看本机docker、docker-compose版本</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ docker --version
Docker version 19.03.1, build 74b1e89
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ docker-compose --version
docker-compose version 1.24.1, build 4667896b
<span class="c1"># 当前容器列表，使用docker ps也是一样的。</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ docker container ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
<span class="c1"># 列举本机所有docker镜像</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ docker images
REPOSITORY                        TAG                 IMAGE ID            CREATED             SIZE
mainflux/mqtt-amd64               latest              63c2335da152        <span class="m">4</span> days ago          177MB
mainflux/ui-amd64                 latest              56818963b563        <span class="m">4</span> days ago          16.4MB
&lt;none&gt;                            &lt;none&gt;              776802a00b76        <span class="m">4</span> days ago          119MB
mainflux/bootstrap-amd64          latest              2d6bf08877ff        <span class="m">4</span> days ago          11.5MB
mainflux/cli-amd64                latest              9a95ca2d5e58        <span class="m">4</span> days ago          7.39MB
mainflux/postgres-reader-amd64    latest              0da4b651447e        <span class="m">4</span> days ago          10.4MB
mainflux/postgres-writer-amd64    latest              ca8dc5c8357c        <span class="m">4</span> days ago          10.2MB
mainflux/cassandra-reader-amd64   latest              a9abfb5cc14f        <span class="m">4</span> days ago          10.4MB
mainflux/cassandra-writer-amd64   latest              b9017e5c7bf7        <span class="m">4</span> days ago          10.2MB
mainflux/mongodb-reader-amd64     latest              83312eb43d4e        <span class="m">4</span> days ago          13.2MB
mainflux/mongodb-writer-amd64     latest              c2c20ded7746        <span class="m">4</span> days ago          13MB
mainflux/influxdb-reader-amd64    latest              602cca6b16df        <span class="m">4</span> days ago          9.64MB
mainflux/influxdb-writer-amd64    latest              8291fcbf79c7        <span class="m">4</span> days ago          9.57MB
mainflux/lora-amd64               latest              6ad78c136202        <span class="m">4</span> days ago          10.5MB
mainflux/coap-amd64               latest              436fb919b3ef        <span class="m">4</span> days ago          10.5MB
mainflux/ws-amd64                 latest              ea32ef946286        <span class="m">4</span> days ago          10.6MB
mainflux/normalizer-amd64         latest              f457472beb17        <span class="m">4</span> days ago          12.1MB
mainflux/http-amd64               latest              e9c5e8cca6d2        <span class="m">4</span> days ago          10.5MB
mainflux/things-amd64             latest              6b91b8561a30        <span class="m">4</span> days ago          11.7MB
mainflux/users-amd64              latest              64a299ad8ed2        <span class="m">4</span> days ago          10.6MB
nginx                             1.14.2-alpine       8a2fb25a19f5        <span class="m">4</span> months ago        16MB
golang                            1.10-alpine         7b53e4a31d21        <span class="m">6</span> months ago        259MB
node                              10.15.1-alpine      fe6ff768f798        <span class="m">6</span> months ago        70.7MB
hello-world                       latest              fce289e99eb9        <span class="m">7</span> months ago        1.84kB
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$
</code></pre></td></tr></table>
</div>
</div><p>由于执行<code>make run</code>其实是从docker官方镜像源下载（本机所编译的镜像带有<code>-amd64</code>后缀，与doker-compose.yml描述不同，所以还是会远程拉取）</p>
<p>所以先将docker设置国内的官方镜像源：</p>
<p>编辑<code>/etc/default/docker</code>并在末尾追加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">DOCKER_OPTS</span><span class="o">=</span><span class="s2">&#34;--registry-mirror=https://registry.docker-cn.com&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>保存后重启docker即可：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo service docker restart
</code></pre></td></tr></table>
</div>
</div><p>接下来在mainflux根目录下输入<code>make run</code>，会将mainflux系统所有微服务自云端拉取到本地运行。</p>
<p>注意，在拉取的过程中可能经常显示拉取失败（TLS握手超时），不要紧，继续输<code>make run</code>直到命令行显示所有服务已拉取完成并正要启动。</p>
<p>启动的过程中，在我的电脑上遇到nginx无法启动，提示80端口被占用的情况：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ make run
docker-compose -f docker/docker-compose.yml up
mainflux-ui is up-to-date
mainflux-things-redis is up-to-date
mainflux-mqtt-redis is up-to-date
mainflux-es-redis is up-to-date
mainflux-users-db is up-to-date
mainflux-things-db is up-to-date
Starting mainflux-nginx ...
mainflux-nats is up-to-date
mainflux-jaeger is up-to-date
mainflux-users is up-to-date
mainflux-normalizer is up-to-date
mainflux-things is up-to-date
mainflux-mqtt is up-to-date
mainflux-http is up-to-date
mainflux-coap is up-to-date
Starting mainflux-nginx ... error

ERROR: <span class="k">for</span> mainflux-nginx  Cannot start service nginx: driver failed programming external connectivity on endpoint mainflux-nginx <span class="o">(</span>2a91eb3c88807046073423c3a6baf44da0ad26dc65bcb57953b4c71fb094a154<span class="o">)</span>: Error starting userland proxy: listen tcp 0.0.0.0:80: bind: address already in use

ERROR: <span class="k">for</span> nginx  Cannot start service nginx: driver failed programming external connectivity on endpoint mainflux-nginx <span class="o">(</span>2a91eb3c88807046073423c3a6baf44da0ad26dc65bcb57953b4c71fb094a154<span class="o">)</span>: Error starting userland proxy: listen tcp 0.0.0.0:80: bind: address already in use
ERROR: Encountered errors <span class="k">while</span> bringing up the project.
Makefile:151: recipe <span class="k">for</span> target <span class="s1">&#39;run&#39;</span> failed
make: *** <span class="o">[</span>run<span class="o">]</span> Error <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><p>检查下当前80端口被什么程序占用了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ sudo netstat -lnp <span class="p">|</span> grep <span class="m">80</span>
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> eiger:
tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:80              0.0.0.0:*               LISTEN      1638/nginx: master
tcp6       <span class="m">0</span>      <span class="m">0</span> :::8880                 :::*                    LISTEN      8432/docker-proxy
tcp6       <span class="m">0</span>      <span class="m">0</span> :::80                   :::*                    LISTEN      1638/nginx: master
tcp6       <span class="m">0</span>      <span class="m">0</span> :::8180                 :::*                    LISTEN      7979/docker-proxy
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">30380</span>    1789/systemd         /run/user/1000/gnupg/S.gpg-agent.extra
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">256023</span>   3607/code            /run/user/1000/vscode-git-askpass-3381c5ecc00801d2295b4bc73b69a9f6a2b09eb2.sock
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">280798</span>   7989/containerd-shi  @/containerd-shim/moby/fea1599f1fafb50ec78e979f461f77bb99350205c33c622d1841938e586582ab/shim.sock@
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">275172</span>   6812/containerd-shi  @/containerd-shim/moby/aef24619a59af74650841b80deca2addcf0f325659ff88b46e7a415308615aee/shim.sock@
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">28280</span>    1333/gdm3            @/tmp/dbus-Iy5HJvQN
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">37218</span>    2819/dockerd         /var/run/docker/libnetwork/9fc55081e3a86db3f1611707734cd1856801fe3891d2848d5e21010237bcbfd1.sock
</code></pre></td></tr></table>
</div>
</div><p>什么情况？？？明明是被nginx使用的呀</p>
<p>我们再把当前启动的容器列举一下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ docker ps
CONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS              PORTS                                                                                                                               NAMES
4bb5cd9596ea        mainflux/ws:latest              <span class="s2">&#34;/exe&#34;</span>                   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        0.0.0.0:8186-&gt;8186/tcp                                                                                                              mainflux-ws
8c0c4ccbbd55        mainflux/coap:latest            <span class="s2">&#34;/exe&#34;</span>                   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        0.0.0.0:5683-&gt;5683/udp                                                                                                              mainflux-coap
941c67d26e08        mainflux/mqtt:latest            <span class="s2">&#34;node mqtt.js&#34;</span>           <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        0.0.0.0:1883-&gt;1883/tcp, 0.0.0.0:8880-&gt;8880/tcp                                                                                      mainflux-mqtt
51206daffd4f        mainflux/http:latest            <span class="s2">&#34;/exe&#34;</span>                   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        0.0.0.0:8185-&gt;8185/tcp                                                                                                              mainflux-http
eb9bc8ac2e0a        mainflux/normalizer:latest      <span class="s2">&#34;/exe&#34;</span>                   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        0.0.0.0:8184-&gt;8184/tcp                                                                                                              mainflux-normalizer
d1579ed65dff        mainflux/things:latest          <span class="s2">&#34;/exe&#34;</span>                   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        0.0.0.0:8182-8183-&gt;8182-8183/tcp, 0.0.0.0:8989-&gt;8989/tcp                                                                            mainflux-things
fea1599f1faf        mainflux/users:latest           <span class="s2">&#34;/exe&#34;</span>                   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        0.0.0.0:8180-&gt;8180/tcp, 8181/tcp                                                                                                    mainflux-users
d20f696b6a37        nats:1.3.0                      <span class="s2">&#34;/gnatsd -c gnatsd.c…&#34;</span>   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        4222/tcp, 6222/tcp, 8222/tcp                                                                                                        mainflux-nats
08b0d3a188f9        postgres:10.8-alpine            <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        5432/tcp                                                                                                                            mainflux-users-db
310c048cb4f3        jaegertracing/all-in-one:1.13   <span class="s2">&#34;/go/bin/all-in-one-…&#34;</span>   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        5775/udp, 0.0.0.0:5778-&gt;5778/tcp, 0.0.0.0:14268-&gt;14268/tcp, 6832/udp, 0.0.0.0:16686-&gt;16686/tcp, 0.0.0.0:6831-&gt;6831/udp, 14250/tcp   mainflux-jaeger
d84ae3be3425        redis:5.0-alpine                <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        6379/tcp                                                                                                                            mainflux-es-redis
aef24619a59a        redis:5.0-alpine                <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        6379/tcp                                                                                                                            mainflux-things-redis
3afec1d3a3e0        postgres:10.8-alpine            <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        5432/tcp                                                                                                                            mainflux-things-db
6f05dbae388f        redis:5.0-alpine                <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        6379/tcp                                                                                                                            mainflux-mqtt-redis
0f9972dc12c5        mainflux/ui:latest              <span class="s2">&#34;/entrypoint.sh&#34;</span>         <span class="m">16</span> hours ago        Up <span class="m">2</span> minutes        80/tcp, 0.0.0.0:3000-&gt;3000/tcp                                                                                                      mainflux-ui
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$
</code></pre></td></tr></table>
</div>
</div><p>这里我们注意nginx服务未开启成功，但是列表中mainflux-ui使用了80/tcp端口。从mainflux的架构图可以看出：</p>
<!-- raw HTML omitted -->
<p><img src="/images/mainflux-architecture.jpg" alt="mainflux-architecture">
<img src="../../../static/images/mainflux-architecture.jpg" alt="mainflux-architecture"></p>
<p>nginx被用来做负载均衡，但是mainflux-ui也用到了nginx，但它只是用nginx做一个简单的服务器，另外我们去查看docker-compose.yml也可以看到services下nginx的environment项是MF_UI_PORT，这进一步佐证了mainflux-ui使用nginx作web服务器。</p>
<p>现在来查看下mainflux所设置的环境变量，位于mainflux/.env文件中，内容展示如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># Docker: Environment variables in Compose</span>

<span class="c1">## NGINX</span>
<span class="nv">MF_NGINX_HTTP_PORT</span><span class="o">=</span><span class="m">80</span>
<span class="nv">MF_NGINX_SSL_PORT</span><span class="o">=</span><span class="m">443</span>
<span class="nv">MF_NGINX_MQTT_PORT</span><span class="o">=</span><span class="m">8883</span>

<span class="c1">## NATS</span>
<span class="nv">MF_NATS_URL</span><span class="o">=</span>nats://nats:4222

<span class="c1">## REDIS</span>
<span class="nv">MF_REDIS_TCP_PORT</span><span class="o">=</span><span class="m">6379</span>

<span class="c1">## UI</span>
<span class="nv">MF_UI_PORT</span><span class="o">=</span><span class="m">3000</span>

<span class="c1">## Grafana</span>
<span class="nv">MF_GRAFANA_PORT</span><span class="o">=</span><span class="m">3000</span>

<span class="c1">## Jaeger</span>
<span class="nv">MF_JAEGER_PORT</span><span class="o">=</span><span class="m">6831</span>
<span class="nv">MF_JAEGER_FRONTEND</span><span class="o">=</span><span class="m">16686</span>
<span class="nv">MF_JAEGER_COLLECTOR</span><span class="o">=</span><span class="m">14268</span>
<span class="nv">MF_JAEGER_CONFIGS</span><span class="o">=</span><span class="m">5778</span>
<span class="nv">MF_JAEGER_URL</span><span class="o">=</span>jaeger:6831

<span class="c1">## Core Services</span>
<span class="c1">### Users</span>
<span class="nv">MF_USERS_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_USERS_HTTP_PORT</span><span class="o">=</span><span class="m">8180</span>
<span class="nv">MF_USERS_GRPC_PORT</span><span class="o">=</span><span class="m">8181</span>
<span class="nv">MF_USERS_DB_PORT</span><span class="o">=</span><span class="m">5432</span>
<span class="nv">MF_USERS_DB_USER</span><span class="o">=</span>mainflux
<span class="nv">MF_USERS_DB_PASS</span><span class="o">=</span>mainflux
<span class="nv">MF_USERS_DB</span><span class="o">=</span>users
<span class="nv">MF_USERS_SECRET</span><span class="o">=</span>secret

<span class="c1">### Things</span>
<span class="nv">MF_THINGS_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_THINGS_HTTP_PORT</span><span class="o">=</span><span class="m">8182</span>
<span class="nv">MF_THINGS_AUTH_HTTP_PORT</span><span class="o">=</span><span class="m">8989</span>
<span class="nv">MF_THINGS_AUTH_GRPC_PORT</span><span class="o">=</span><span class="m">8183</span>
<span class="nv">MF_THINGS_DB_PORT</span><span class="o">=</span><span class="m">5432</span>
<span class="nv">MF_THINGS_DB_USER</span><span class="o">=</span>mainflux
<span class="nv">MF_THINGS_DB_PASS</span><span class="o">=</span>mainflux
<span class="nv">MF_THINGS_DB</span><span class="o">=</span>things
<span class="nv">MF_THINGS_SECRET</span><span class="o">=</span>secret

<span class="c1">### Normalizer</span>
<span class="nv">MF_NORMALIZER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_NORMALIZER_PORT</span><span class="o">=</span><span class="m">8184</span>

<span class="c1">### WS</span>
<span class="nv">MF_WS_ADAPTER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_WS_ADAPTER_PORT</span><span class="o">=</span><span class="m">8186</span>

<span class="c1">### HTTP</span>
<span class="nv">MF_HTTP_ADAPTER_PORT</span><span class="o">=</span><span class="m">8185</span>

<span class="c1">### MQTT</span>
<span class="nv">MF_MQTT_ADAPTER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_MQTT_ADAPTER_PORT</span><span class="o">=</span><span class="m">1883</span>
<span class="nv">MF_MQTT_ADAPTER_WS_PORT</span><span class="o">=</span><span class="m">8880</span>

<span class="c1">### COAP</span>
<span class="nv">MF_COAP_ADAPTER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_COAP_ADAPTER_PORT</span><span class="o">=</span><span class="m">5683</span>

<span class="c1">## Addons Services</span>
<span class="c1">### Bootstrap</span>
<span class="nv">MF_BOOTSTRAP_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_BOOTSTRAP_PORT</span><span class="o">=</span><span class="m">8202</span>
<span class="nv">MF_BOOTSTRAP_DB_PORT</span><span class="o">=</span><span class="m">5432</span>
<span class="nv">MF_BOOTSTRAP_DB_USER</span><span class="o">=</span>mainflux
<span class="nv">MF_BOOTSTRAP_DB_PASS</span><span class="o">=</span>mainflux
<span class="nv">MF_BOOTSTRAP_DB</span><span class="o">=</span>bootstrap
<span class="nv">MF_BOOTSTRAP_DB_SSL_MODE</span><span class="o">=</span>disable

<span class="c1">### LoRa</span>
<span class="nv">MF_LORA_ADAPTER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_LORA_ADAPTER_MESSAGES_URL</span><span class="o">=</span>tcp://lora.mqtt.mainflux.io:1883
<span class="nv">MF_LORA_ADAPTER_HTTP_PORT</span><span class="o">=</span><span class="m">8187</span>

<span class="c1">### Cassandra Writer</span>
<span class="nv">MF_CASSANDRA_WRITER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_CASSANDRA_WRITER_PORT</span><span class="o">=</span><span class="m">8902</span>
<span class="nv">MF_CASSANDRA_WRITER_DB_PORT</span><span class="o">=</span><span class="m">9042</span>
<span class="nv">MF_CASSANDRA_WRITER_DB_CLUSTER</span><span class="o">=</span>mainflux-cassandra
<span class="nv">MF_CASSANDRA_WRITER_DB_KEYSPACE</span><span class="o">=</span>mainflux

<span class="c1">### Cassandra Reader</span>
<span class="nv">MF_CASSANDRA_READER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_CASSANDRA_READER_PORT</span><span class="o">=</span><span class="m">8903</span>
<span class="nv">MF_CASSANDRA_READER_DB_PORT</span><span class="o">=</span><span class="m">9042</span>
<span class="nv">MF_CASSANDRA_READER_DB_CLUSTER</span><span class="o">=</span>mainflux-cassandra
<span class="nv">MF_CASSANDRA_READER_DB_KEYSPACE</span><span class="o">=</span>mainflux

<span class="c1">### InfluxDB Writer</span>
<span class="nv">MF_INFLUX_WRITER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_INFLUX_WRITER_PORT</span><span class="o">=</span><span class="m">8900</span>
<span class="nv">MF_INFLUX_WRITER_BATCH_SIZE</span><span class="o">=</span><span class="m">5000</span>
<span class="nv">MF_INFLUX_WRITER_BATCH_TIMEOUT</span><span class="o">=</span><span class="m">5</span>
<span class="nv">MF_INFLUX_WRITER_DB_PORT</span><span class="o">=</span><span class="m">8086</span>
<span class="nv">MF_INFLUX_WRITER_DB_NAME</span><span class="o">=</span>mainflux
<span class="nv">MF_INFLUX_WRITER_DB_USER</span><span class="o">=</span>mainflux
<span class="nv">MF_INFLUX_WRITER_DB_PASS</span><span class="o">=</span>mainflux
<span class="nv">MF_INFLUX_WRITER_GRAFANA_PORT</span><span class="o">=</span><span class="m">3001</span>

<span class="c1">### InfluxDB Reader</span>
<span class="nv">MF_INFLUX_READER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_INFLUX_READER_PORT</span><span class="o">=</span><span class="m">8905</span>
<span class="nv">MF_INFLUX_READER_DB_NAME</span><span class="o">=</span>mainflux
<span class="nv">MF_INFLUX_READER_DB_PORT</span><span class="o">=</span><span class="m">8086</span>
<span class="nv">MF_INFLUX_READER_DB_USER</span><span class="o">=</span>mainflux
<span class="nv">MF_INFLUX_READER_DB_PASS</span><span class="o">=</span>mainflux

<span class="c1">### MongoDB Writer</span>
<span class="nv">MF_MONGO_WRITER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_MONGO_WRITER_PORT</span><span class="o">=</span><span class="m">8901</span>
<span class="nv">MF_MONGO_WRITER_DB_NAME</span><span class="o">=</span>mainflux
<span class="nv">MF_MONGO_WRITER_DB_PORT</span><span class="o">=</span><span class="m">27017</span>

<span class="c1">### MongoDB Reader</span>
<span class="nv">MF_MONGO_READER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_MONGO_READER_PORT</span><span class="o">=</span><span class="m">8904</span>
<span class="nv">MF_MONGO_READER_DB_NAME</span><span class="o">=</span>mainflux
<span class="nv">MF_MONGO_READER_DB_PORT</span><span class="o">=</span><span class="m">27017</span>

<span class="c1">### Postgres Writer</span>
<span class="nv">MF_POSTGRES_WRITER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_POSTGRES_WRITER_PORT</span><span class="o">=</span><span class="m">9104</span>
<span class="nv">MF_POSTGRES_WRITER_DB_PORT</span><span class="o">=</span><span class="m">5432</span>
<span class="nv">MF_POSTGRES_WRITER_DB_USER</span><span class="o">=</span>mainflux
<span class="nv">MF_POSTGRES_WRITER_DB_PASS</span><span class="o">=</span>mainflux
<span class="nv">MF_POSTGRES_WRITER_DB_NAME</span><span class="o">=</span>messages
<span class="nv">MF_POSTGRES_WRITER_DB_SSL_MODE</span><span class="o">=</span>disable
<span class="nv">MF_POSTGRES_WRITER_DB_SSL_CERT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
<span class="nv">MF_POSTGRES_WRITER_DB_SSL_KEY</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
<span class="nv">MF_POSTGRES_WRITER_DB_SSL_ROOT_CERT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>

<span class="c1">### Postgres Reader</span>
<span class="nv">MF_POSTGRES_READER_LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">MF_POSTGRES_READER_PORT</span><span class="o">=</span><span class="m">9204</span>
<span class="nv">MF_POSTGRES_READER_CLIENT_TLS</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">MF_POSTGRES_READER_CA_CERTS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
<span class="nv">MF_POSTGRES_READER_DB_PORT</span><span class="o">=</span><span class="m">5432</span>
<span class="nv">MF_POSTGRES_READER_DB_USER</span><span class="o">=</span>mainflux
<span class="nv">MF_POSTGRES_READER_DB_PASS</span><span class="o">=</span>mainflux
<span class="nv">MF_POSTGRES_READER_DB_NAME</span><span class="o">=</span>messages
<span class="nv">MF_POSTGRES_READER_DB_SSL_MODE</span><span class="o">=</span>disable
<span class="nv">MF_POSTGRES_READER_DB_SSL_CERT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
<span class="nv">MF_POSTGRES_READER_DB_SSL_KEY</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
<span class="nv">MF_POSTGRES_READER_DB_SSL_ROOT_CERT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>可以看出nginx使用了80端口，但是整个mainflux运行时相当于开了两个nginx进程，结果都在抢80端口，这就导致了mainflux-nginx启动失败。</p>
<p>除此之外，还有可能是因为我本机已经安装了nginx服务器（默认端口即是80），这导致真实环境的nginx和容器环境的nginx都想用80端口，从而产生冲突。</p>
<p>（ps: 都是我的推测，没有严格佐证）</p>
<p>现在既然关闭占用80端口的程序不太好办，那么修改nginx端口：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">## NGINX</span>
<span class="nv">MF_NGINX_HTTP_PORT</span><span class="o">=</span><span class="m">8888</span>  <span class="c1"># 找个不容易冲突的就行</span>
</code></pre></td></tr></table>
</div>
</div><p>再次<code>make run</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ make run
docker-compose -f docker/docker-compose.yml up
Removing mainflux-nginx
mainflux-nats is up-to-date
mainflux-mqtt-redis is up-to-date
mainflux-things-db is up-to-date
mainflux-es-redis is up-to-date
mainflux-ui is up-to-date
mainflux-things-redis is up-to-date
mainflux-jaeger is up-to-date
Starting 26e7692f31b7_mainflux-nginx ...
mainflux-users-db is up-to-date
mainflux-normalizer is up-to-date
mainflux-users is up-to-date
mainflux-things is up-to-date
mainflux-ws is up-to-date
mainflux-http is up-to-date
mainflux-coap is up-to-date
Starting 26e7692f31b7_mainflux-nginx ... <span class="k">done</span>
Attaching to mainflux-nats, mainflux-mqtt-redis, mainflux-things-db, mainflux-es-redis, mainflux-ui, mainflux-things-redis, mainflux-jaeger, mainflux-users-db, mainflux-normalizer, mainflux-users, mainflux-things, mainflux-ws, mainflux-http, mainflux-coap, mainflux-mqtt, 26e7692f31b7_mainflux-nginx
mainflux-mqtt-redis <span class="p">|</span> 1:C <span class="m">17</span> Aug <span class="m">2019</span> 14:22:43.095 <span class="c1"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
mainflux-mqtt-redis <span class="p">|</span> 1:C <span class="m">17</span> Aug <span class="m">2019</span> 14:22:43.095 <span class="c1"># Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=1, just started</span>
mainflux-mqtt-redis <span class="p">|</span> 1:C <span class="m">17</span> Aug <span class="m">2019</span> 14:22:43.095 <span class="c1"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:43.097 * Running <span class="nv">mode</span><span class="o">=</span>standalone, <span class="nv">port</span><span class="o">=</span>6379.
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:43.097 <span class="c1"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:43.097 <span class="c1"># Server initialized</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:43.097 <span class="c1"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:43.097 <span class="c1"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:43.097 * Ready to accept connections
mainflux-mqtt-redis <span class="p">|</span> 1:signal-handler <span class="o">(</span>1566108428<span class="o">)</span> Received SIGTERM scheduling shutdown...
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:08.140 <span class="c1"># User requested shutdown...</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:08.146 * Saving the final RDB snapshot before exiting.
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:08.148 * DB saved on disk
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:08.148 <span class="c1"># Redis is now ready to exit, bye bye...</span>
mainflux-mqtt-redis <span class="p">|</span> 1:C <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.966 <span class="c1"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
mainflux-mqtt-redis <span class="p">|</span> 1:C <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.966 <span class="c1"># Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=1, just started</span>
mainflux-mqtt-redis <span class="p">|</span> 1:C <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.966 <span class="c1"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.968 * Running <span class="nv">mode</span><span class="o">=</span>standalone, <span class="nv">port</span><span class="o">=</span>6379.
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.968 <span class="c1"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.968 <span class="c1"># Server initialized</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.968 <span class="c1"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.968 <span class="c1"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.968 * DB loaded from disk: 0.000 seconds
mainflux-mqtt-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:44.968 * Ready to accept connections
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/17 14:22:45.027384 <span class="o">[</span>INF<span class="o">]</span> Starting nats-server version 1.3.0
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/17 14:22:45.027438 <span class="o">[</span>INF<span class="o">]</span> Git commit <span class="o">[</span>eed4fbc<span class="o">]</span>
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/17 14:22:45.027536 <span class="o">[</span>INF<span class="o">]</span> Starting http monitor on 0.0.0.0:8222
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/17 14:22:45.027579 <span class="o">[</span>INF<span class="o">]</span> Listening <span class="k">for</span> client connections on 0.0.0.0:4222
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/17 14:22:45.027589 <span class="o">[</span>INF<span class="o">]</span> Server is ready
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/17 14:22:45.028198 <span class="o">[</span>INF<span class="o">]</span> Listening <span class="k">for</span> route connections on 0.0.0.0:6222
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/18 06:07:47.155252 <span class="o">[</span>INF<span class="o">]</span> Starting nats-server version 1.3.0
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/18 06:07:47.155297 <span class="o">[</span>INF<span class="o">]</span> Git commit <span class="o">[</span>eed4fbc<span class="o">]</span>
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/18 06:07:47.155421 <span class="o">[</span>INF<span class="o">]</span> Starting http monitor on 0.0.0.0:8222
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/18 06:07:47.155498 <span class="o">[</span>INF<span class="o">]</span> Listening <span class="k">for</span> client connections on 0.0.0.0:4222
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/18 06:07:47.155511 <span class="o">[</span>INF<span class="o">]</span> Server is ready
mainflux-nats   <span class="p">|</span> <span class="o">[</span>1<span class="o">]</span> 2019/08/18 06:07:47.156378 <span class="o">[</span>INF<span class="o">]</span> Listening <span class="k">for</span> route connections on 0.0.0.0:6222
mainflux-things-db <span class="p">|</span> The files belonging to this database system will be owned by user <span class="s2">&#34;postgres&#34;</span>.
mainflux-things-db <span class="p">|</span> This user must also own the server process.
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span> The database cluster will be initialized with locale <span class="s2">&#34;en_US.utf8&#34;</span>.
mainflux-things-db <span class="p">|</span> The default database encoding has accordingly been <span class="nb">set</span> to <span class="s2">&#34;UTF8&#34;</span>.
mainflux-things-db <span class="p">|</span> The default text search configuration will be <span class="nb">set</span> to <span class="s2">&#34;english&#34;</span>.
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span> Data page checksums are disabled.
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span> fixing permissions on existing directory /var/lib/postgresql/data ... ok
mainflux-things-db <span class="p">|</span> creating subdirectories ... ok
mainflux-things-db <span class="p">|</span> selecting default max_connections ... <span class="m">100</span>
mainflux-things-db <span class="p">|</span> selecting default shared_buffers ... 128MB
mainflux-things-db <span class="p">|</span> selecting dynamic shared memory implementation ... posix
mainflux-things-db <span class="p">|</span> creating configuration files ... ok
mainflux-things-db <span class="p">|</span> running bootstrap script ... ok
mainflux-things-db <span class="p">|</span> sh: locale: not found
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:42.759 UTC <span class="o">[</span>26<span class="o">]</span> WARNING:  no usable system locales were found
mainflux-things-db <span class="p">|</span> performing post-bootstrap initialization ... ok
mainflux-things-db <span class="p">|</span> syncing data to disk ... ok
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span> Success. You can now start the database server using:
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span>     pg_ctl -D /var/lib/postgresql/data -l logfile start
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span> WARNING: enabling <span class="s2">&#34;trust&#34;</span> authentication <span class="k">for</span> <span class="nb">local</span> connections
mainflux-things-db <span class="p">|</span> You can change this by editing pg_hba.conf or using the option -A, or
mainflux-things-db <span class="p">|</span> --auth-local and --auth-host, the next <span class="nb">time</span> you run initdb.
mainflux-things-db <span class="p">|</span> waiting <span class="k">for</span> server to start....2019-08-17 14:22:43.440 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  listening on Unix socket <span class="s2">&#34;/var/run/postgresql/.s.PGSQL.5432&#34;</span>
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.480 UTC <span class="o">[</span>31<span class="o">]</span> LOG:  database system was shut down at 2019-08-17 14:22:43 UTC
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.489 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  database system is ready to accept connections
mainflux-things-db <span class="p">|</span>  <span class="k">done</span>
mainflux-things-db <span class="p">|</span> server started
mainflux-things-db <span class="p">|</span> CREATE DATABASE
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span> /usr/local/bin/docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span> waiting <span class="k">for</span> server to shut down....2019-08-17 14:22:43.785 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  received fast shutdown request
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.787 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  aborting any active transactions
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.788 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  worker process: logical replication launcher <span class="o">(</span>PID 37<span class="o">)</span> exited with <span class="nb">exit</span> code <span class="m">1</span>
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.788 UTC <span class="o">[</span>32<span class="o">]</span> LOG:  shutting down
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.826 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  database system is shut down
mainflux-things-db <span class="p">|</span>  <span class="k">done</span>
mainflux-things-db <span class="p">|</span> server stopped
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span> PostgreSQL init process complete<span class="p">;</span> ready <span class="k">for</span> start up.
mainflux-things-db <span class="p">|</span>
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.893 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on IPv4 address <span class="s2">&#34;0.0.0.0&#34;</span>, port <span class="m">5432</span>
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.893 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on IPv6 address <span class="s2">&#34;::&#34;</span>, port <span class="m">5432</span>
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.910 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on Unix socket <span class="s2">&#34;/var/run/postgresql/.s.PGSQL.5432&#34;</span>
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.947 UTC <span class="o">[</span>41<span class="o">]</span> LOG:  database system was shut down at 2019-08-17 14:22:43 UTC
mainflux-things-db <span class="p">|</span> 2019-08-17 14:22:43.956 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  database system is ready to accept connections
mainflux-things-db <span class="p">|</span> 2019-08-18 06:07:08.879 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  received smart shutdown request
mainflux-things-db <span class="p">|</span> 2019-08-18 06:07:08.894 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  worker process: logical replication launcher <span class="o">(</span>PID 47<span class="o">)</span> exited with <span class="nb">exit</span> code <span class="m">1</span>
mainflux-things-db <span class="p">|</span> 2019-08-18 06:07:08.895 UTC <span class="o">[</span>42<span class="o">]</span> LOG:  shutting down
mainflux-things-db <span class="p">|</span> 2019-08-18 06:07:08.932 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  database system is shut down
mainflux-things-db <span class="p">|</span> 2019-08-18 06:07:42.226 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on IPv4 address <span class="s2">&#34;0.0.0.0&#34;</span>, port <span class="m">5432</span>
mainflux-things-db <span class="p">|</span> 2019-08-18 06:07:42.226 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on IPv6 address <span class="s2">&#34;::&#34;</span>, port <span class="m">5432</span>
mainflux-things-db <span class="p">|</span> 2019-08-18 06:07:42.245 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on Unix socket <span class="s2">&#34;/var/run/postgresql/.s.PGSQL.5432&#34;</span>
mainflux-things-db <span class="p">|</span> 2019-08-18 06:07:42.285 UTC <span class="o">[</span>18<span class="o">]</span> LOG:  database system was shut down at 2019-08-18 06:07:08 UTC
mainflux-things-db <span class="p">|</span> 2019-08-18 06:07:42.299 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  database system is ready to accept connections
mainflux-es-redis <span class="p">|</span> 1:C <span class="m">17</span> Aug <span class="m">2019</span> 14:22:41.792 <span class="c1"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
mainflux-es-redis <span class="p">|</span> 1:C <span class="m">17</span> Aug <span class="m">2019</span> 14:22:41.793 <span class="c1"># Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=1, just started</span>
mainflux-es-redis <span class="p">|</span> 1:C <span class="m">17</span> Aug <span class="m">2019</span> 14:22:41.793 <span class="c1"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:41.796 * Running <span class="nv">mode</span><span class="o">=</span>standalone, <span class="nv">port</span><span class="o">=</span>6379.
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:41.796 <span class="c1"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:41.796 <span class="c1"># Server initialized</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:41.796 <span class="c1"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:41.796 <span class="c1"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:41.796 * Ready to accept connections
mainflux-es-redis <span class="p">|</span> 1:signal-handler <span class="o">(</span>1566108417<span class="o">)</span> Received SIGTERM scheduling shutdown...
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:06:57.570 <span class="c1"># User requested shutdown...</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:06:57.619 * Saving the final RDB snapshot before exiting.
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:06:57.629 * DB saved on disk
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:06:57.629 <span class="c1"># Redis is now ready to exit, bye bye...</span>
mainflux-es-redis <span class="p">|</span> 1:C <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.200 <span class="c1"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
mainflux-es-redis <span class="p">|</span> 1:C <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.200 <span class="c1"># Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=1, just started</span>
mainflux-es-redis <span class="p">|</span> 1:C <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.200 <span class="c1"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.202 * Running <span class="nv">mode</span><span class="o">=</span>standalone, <span class="nv">port</span><span class="o">=</span>6379.
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.202 <span class="c1"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.202 <span class="c1"># Server initialized</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.202 <span class="c1"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.202 <span class="c1"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.209 * DB loaded from disk: 0.007 seconds
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:48.209 * Ready to accept connections
mainflux-jaeger <span class="p">|</span> 2019/08/17 14:22:46 maxprocs: Leaving <span class="nv">GOMAXPROCS</span><span class="o">=</span>4: CPU quota undefined
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2253852,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/service.go:115&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Mounting metrics handler on admin server&#34;</span>,<span class="s2">&#34;route&#34;</span>:<span class="s2">&#34;/metrics&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2256029,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/admin.go:108&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Mounting health check on admin server&#34;</span>,<span class="s2">&#34;route&#34;</span>:<span class="s2">&#34;/&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.225683,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/admin.go:114&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting admin HTTP server&#34;</span>,<span class="s2">&#34;http-port&#34;</span>:14269<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2257037,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/admin.go:100&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Admin server started&#34;</span>,<span class="s2">&#34;http-port&#34;</span>:14269,<span class="s2">&#34;health-status&#34;</span>:<span class="s2">&#34;unavailable&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2808497,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;memory/factory.go:55&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Memory storage initialized&#34;</span>,<span class="s2">&#34;configuration&#34;</span>:<span class="o">{</span><span class="s2">&#34;MaxTraces&#34;</span>:0<span class="o">}}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2881448,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/builder.go:75&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Agent requested insecure grpc connection to collector(s)&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2888844,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/clientconn.go:242&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;parsed scheme: \&#34;\&#34;&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2898757,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/clientconn.go:248&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;scheme \&#34;\&#34; not registered, fallback to default scheme&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2899027,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/resolver_conn_wrapper.go:113&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;ccResolverWrapper: sending update to cc: {[{127.0.0.1:14250 0  &lt;nil&gt;}] }&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2901025,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;base/balancer.go:76&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;base.baseBalancer: got new resolver state: {[{127.0.0.1:14250 0  &lt;nil&gt;}] }&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.290183,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;base/balancer.go:130&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;base.baseBalancer: handle SubConn state change: 0xc000446040, CONNECTING&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2915914,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;all-in-one/main.go:198&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting agent&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2918808,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/clientconn.go:1139&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;grpc: addrConn.createTransport failed to connect to {127.0.0.1:14250 0  &lt;nil&gt;}. Err :connection error: desc = \&#34;transport: Error while dialing dial tcp 127.0.0.1:14250: connect: connection refused\&#34;. Reconnecting...&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2919507,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;base/balancer.go:130&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;base.baseBalancer: handle SubConn state change: 0xc000446040, TRANSIENT_FAILURE&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2920654,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;app/agent.go:68&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting jaeger-agent HTTP server&#34;</span>,<span class="s2">&#34;http-port&#34;</span>:5778<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2961102,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;all-in-one/main.go:241&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting jaeger-collector TChannel server&#34;</span>,<span class="s2">&#34;port&#34;</span>:14267<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.296204,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpcserver/grpc_server.go:64&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting jaeger-collector gRPC server&#34;</span>,<span class="s2">&#34;grpc-port&#34;</span>:<span class="s2">&#34;14250&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2963338,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;all-in-one/main.go:259&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting jaeger-collector HTTP server&#34;</span>,<span class="s2">&#34;http-port&#34;</span>:14268<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2963643,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;querysvc/query_service.go:130&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Archive storage not created&#34;</span>,<span class="s2">&#34;reason&#34;</span>:<span class="s2">&#34;archive storage not supported&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2967296,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;all-in-one/main.go:341&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Archive storage not initialized&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2974143,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;healthcheck/handler.go:129&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Health Check state change&#34;</span>,<span class="s2">&#34;status&#34;</span>:<span class="s2">&#34;ready&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2974267,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;app/server.go:111&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting HTTP server&#34;</span>,<span class="s2">&#34;port&#34;</span>:16686<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2974463,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;app/server.go:134&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting CMUX server&#34;</span>,<span class="s2">&#34;port&#34;</span>:16686<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566051766.2974427,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;app/server.go:124&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting GRPC server&#34;</span>,<span class="s2">&#34;port&#34;</span>:16686<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108417.5729327,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/service.go:145&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Shutting down&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108417.5810058,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;healthcheck/handler.go:129&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Health Check state change&#34;</span>,<span class="s2">&#34;status&#34;</span>:<span class="s2">&#34;unavailable&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108417.729596,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/service.go:153&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Shutdown complete&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> 2019/08/18 06:07:46 maxprocs: Leaving <span class="nv">GOMAXPROCS</span><span class="o">=</span>4: CPU quota undefined
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.326627,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/service.go:115&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Mounting metrics handler on admin server&#34;</span>,<span class="s2">&#34;route&#34;</span>:<span class="s2">&#34;/metrics&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3268385,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/admin.go:108&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Mounting health check on admin server&#34;</span>,<span class="s2">&#34;route&#34;</span>:<span class="s2">&#34;/&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3269293,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/admin.go:114&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting admin HTTP server&#34;</span>,<span class="s2">&#34;http-port&#34;</span>:14269<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3269587,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;flags/admin.go:100&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Admin server started&#34;</span>,<span class="s2">&#34;http-port&#34;</span>:14269,<span class="s2">&#34;health-status&#34;</span>:<span class="s2">&#34;unavailable&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3384168,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;memory/factory.go:55&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Memory storage initialized&#34;</span>,<span class="s2">&#34;configuration&#34;</span>:<span class="o">{</span><span class="s2">&#34;MaxTraces&#34;</span>:0<span class="o">}}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.345234,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/builder.go:75&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Agent requested insecure grpc connection to collector(s)&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.346065,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/clientconn.go:242&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;parsed scheme: \&#34;\&#34;&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.347057,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/clientconn.go:248&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;scheme \&#34;\&#34; not registered, fallback to default scheme&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3471303,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/resolver_conn_wrapper.go:113&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;ccResolverWrapper: sending update to cc: {[{127.0.0.1:14250 0  &lt;nil&gt;}] }&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3473892,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;base/balancer.go:76&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;base.baseBalancer: got new resolver state: {[{127.0.0.1:14250 0  &lt;nil&gt;}] }&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3474433,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;base/balancer.go:130&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;base.baseBalancer: handle SubConn state change: 0xc0003e0050, CONNECTING&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3480797,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;all-in-one/main.go:198&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting agent&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3481708,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;app/agent.go:68&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting jaeger-agent HTTP server&#34;</span>,<span class="s2">&#34;http-port&#34;</span>:5778<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3481946,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpc/clientconn.go:1139&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;grpc: addrConn.createTransport failed to connect to {127.0.0.1:14250 0  &lt;nil&gt;}. Err :connection error: desc = \&#34;transport: Error while dialing dial tcp 127.0.0.1:14250: connect: connection refused\&#34;. Reconnecting...&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3482506,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;base/balancer.go:130&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;base.baseBalancer: handle SubConn state change: 0xc0003e0050, TRANSIENT_FAILURE&#34;</span>,<span class="s2">&#34;system&#34;</span>:<span class="s2">&#34;grpc&#34;</span>,<span class="s2">&#34;grpc_log&#34;</span>:true<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3515522,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;all-in-one/main.go:241&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting jaeger-collector TChannel server&#34;</span>,<span class="s2">&#34;port&#34;</span>:14267<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3516686,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;grpcserver/grpc_server.go:64&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting jaeger-collector gRPC server&#34;</span>,<span class="s2">&#34;grpc-port&#34;</span>:<span class="s2">&#34;14250&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3520057,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;all-in-one/main.go:259&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting jaeger-collector HTTP server&#34;</span>,<span class="s2">&#34;http-port&#34;</span>:14268<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3520448,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;querysvc/query_service.go:130&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Archive storage not created&#34;</span>,<span class="s2">&#34;reason&#34;</span>:<span class="s2">&#34;archive storage not supported&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3523493,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;all-in-one/main.go:341&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Archive storage not initialized&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3539069,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;healthcheck/handler.go:129&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Health Check state change&#34;</span>,<span class="s2">&#34;status&#34;</span>:<span class="s2">&#34;ready&#34;</span><span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3539748,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;app/server.go:134&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting CMUX server&#34;</span>,<span class="s2">&#34;port&#34;</span>:16686<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.3540401,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;app/server.go:111&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting HTTP server&#34;</span>,<span class="s2">&#34;port&#34;</span>:16686<span class="o">}</span>
mainflux-jaeger <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1566108466.354081,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;app/server.go:124&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Starting GRPC server&#34;</span>,<span class="s2">&#34;port&#34;</span>:16686<span class="o">}</span>
mainflux-things-redis <span class="p">|</span> 1:C <span class="m">17</span> Aug <span class="m">2019</span> 14:22:44.664 <span class="c1"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
mainflux-things-redis <span class="p">|</span> 1:C <span class="m">17</span> Aug <span class="m">2019</span> 14:22:44.664 <span class="c1"># Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=1, just started</span>
mainflux-things-redis <span class="p">|</span> 1:C <span class="m">17</span> Aug <span class="m">2019</span> 14:22:44.664 <span class="c1"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:44.666 * Running <span class="nv">mode</span><span class="o">=</span>standalone, <span class="nv">port</span><span class="o">=</span>6379.
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:44.667 <span class="c1"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:44.667 <span class="c1"># Server initialized</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:44.667 <span class="c1"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:44.667 <span class="c1"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">17</span> Aug <span class="m">2019</span> 14:22:44.667 * Ready to accept connections
mainflux-things-redis <span class="p">|</span> 1:signal-handler <span class="o">(</span>1566108417<span class="o">)</span> Received SIGTERM scheduling shutdown...
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:06:57.570 <span class="c1"># User requested shutdown...</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:06:57.621 * Saving the final RDB snapshot before exiting.
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:06:57.653 * DB saved on disk
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:06:57.653 <span class="c1"># Redis is now ready to exit, bye bye...</span>
mainflux-things-redis <span class="p">|</span> 1:C <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.988 <span class="c1"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
mainflux-things-redis <span class="p">|</span> 1:C <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.989 <span class="c1"># Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=1, just started</span>
mainflux-things-redis <span class="p">|</span> 1:C <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.989 <span class="c1"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.991 * Running <span class="nv">mode</span><span class="o">=</span>standalone, <span class="nv">port</span><span class="o">=</span>6379.
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.991 <span class="c1"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.991 <span class="c1"># Server initialized</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.991 <span class="c1"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.991 <span class="c1"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.992 * DB loaded from disk: 0.000 seconds
mainflux-things-redis <span class="p">|</span> 1:M <span class="m">18</span> Aug <span class="m">2019</span> 06:07:43.992 * Ready to accept connections
mainflux-users-db <span class="p">|</span> The files belonging to this database system will be owned by user <span class="s2">&#34;postgres&#34;</span>.
mainflux-users-db <span class="p">|</span> This user must also own the server process.
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span> The database cluster will be initialized with locale <span class="s2">&#34;en_US.utf8&#34;</span>.
mainflux-users-db <span class="p">|</span> The default database encoding has accordingly been <span class="nb">set</span> to <span class="s2">&#34;UTF8&#34;</span>.
mainflux-users-db <span class="p">|</span> The default text search configuration will be <span class="nb">set</span> to <span class="s2">&#34;english&#34;</span>.
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span> Data page checksums are disabled.
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span> fixing permissions on existing directory /var/lib/postgresql/data ... ok
mainflux-users-db <span class="p">|</span> creating subdirectories ... ok
mainflux-users-db <span class="p">|</span> selecting default max_connections ... <span class="m">100</span>
mainflux-users-db <span class="p">|</span> selecting default shared_buffers ... 128MB
mainflux-users-db <span class="p">|</span> selecting dynamic shared memory implementation ... posix
mainflux-users-db <span class="p">|</span> creating configuration files ... ok
mainflux-users-db <span class="p">|</span> running bootstrap script ... ok
mainflux-users-db <span class="p">|</span> sh: locale: not found
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:42.047 UTC <span class="o">[</span>26<span class="o">]</span> WARNING:  no usable system locales were found
mainflux-users-db <span class="p">|</span> performing post-bootstrap initialization ... ok
mainflux-users-db <span class="p">|</span> syncing data to disk ... ok
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span> Success. You can now start the database server using:
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span>     pg_ctl -D /var/lib/postgresql/data -l logfile start
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span> WARNING: enabling <span class="s2">&#34;trust&#34;</span> authentication <span class="k">for</span> <span class="nb">local</span> connections
mainflux-users-db <span class="p">|</span> You can change this by editing pg_hba.conf or using the option -A, or
mainflux-users-db <span class="p">|</span> --auth-local and --auth-host, the next <span class="nb">time</span> you run initdb.
mainflux-users-db <span class="p">|</span> waiting <span class="k">for</span> server to start....2019-08-17 14:22:42.807 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  listening on Unix socket <span class="s2">&#34;/var/run/postgresql/.s.PGSQL.5432&#34;</span>
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:42.862 UTC <span class="o">[</span>31<span class="o">]</span> LOG:  database system was shut down at 2019-08-17 14:22:42 UTC
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:42.871 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  database system is ready to accept connections
mainflux-users-db <span class="p">|</span>  <span class="k">done</span>
mainflux-users-db <span class="p">|</span> server started
mainflux-users-db <span class="p">|</span> CREATE DATABASE
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span> /usr/local/bin/docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span> waiting <span class="k">for</span> server to shut down....2019-08-17 14:22:43.169 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  received fast shutdown request
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:43.171 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  aborting any active transactions
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:43.172 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  worker process: logical replication launcher <span class="o">(</span>PID 37<span class="o">)</span> exited with <span class="nb">exit</span> code <span class="m">1</span>
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:43.172 UTC <span class="o">[</span>32<span class="o">]</span> LOG:  shutting down
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:43.216 UTC <span class="o">[</span>30<span class="o">]</span> LOG:  database system is shut down
mainflux-users-db <span class="p">|</span>  <span class="k">done</span>
mainflux-users-db <span class="p">|</span> server stopped
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span> PostgreSQL init process complete<span class="p">;</span> ready <span class="k">for</span> start up.
mainflux-users-db <span class="p">|</span>
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:43.359 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on IPv4 address <span class="s2">&#34;0.0.0.0&#34;</span>, port <span class="m">5432</span>
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:43.359 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on IPv6 address <span class="s2">&#34;::&#34;</span>, port <span class="m">5432</span>
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:43.373 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on Unix socket <span class="s2">&#34;/var/run/postgresql/.s.PGSQL.5432&#34;</span>
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:43.406 UTC <span class="o">[</span>41<span class="o">]</span> LOG:  database system was shut down at 2019-08-17 14:22:43 UTC
mainflux-users-db <span class="p">|</span> 2019-08-17 14:22:43.421 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  database system is ready to accept connections
mainflux-users-db <span class="p">|</span> 2019-08-18 06:07:09.341 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  received smart shutdown request
mainflux-users-db <span class="p">|</span> 2019-08-18 06:07:09.349 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  worker process: logical replication launcher <span class="o">(</span>PID 47<span class="o">)</span> exited with <span class="nb">exit</span> code <span class="m">1</span>
mainflux-users-db <span class="p">|</span> 2019-08-18 06:07:09.349 UTC <span class="o">[</span>42<span class="o">]</span> LOG:  shutting down
mainflux-users-db <span class="p">|</span> 2019-08-18 06:07:09.416 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  database system is shut down
mainflux-users-db <span class="p">|</span> 2019-08-18 06:07:50.280 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on IPv4 address <span class="s2">&#34;0.0.0.0&#34;</span>, port <span class="m">5432</span>
mainflux-users-db <span class="p">|</span> 2019-08-18 06:07:50.280 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on IPv6 address <span class="s2">&#34;::&#34;</span>, port <span class="m">5432</span>
mainflux-users-db <span class="p">|</span> 2019-08-18 06:07:50.310 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  listening on Unix socket <span class="s2">&#34;/var/run/postgresql/.s.PGSQL.5432&#34;</span>
mainflux-users-db <span class="p">|</span> 2019-08-18 06:07:50.362 UTC <span class="o">[</span>18<span class="o">]</span> LOG:  database system was shut down at 2019-08-18 06:07:09 UTC
mainflux-users-db <span class="p">|</span> 2019-08-18 06:07:50.373 UTC <span class="o">[</span>1<span class="o">]</span> LOG:  database system is ready to accept connections
mainflux-ws     <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;gRPC communication is not encrypted&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:54.741095445Z&#34;</span><span class="o">}</span>
mainflux-ws     <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;WebSocket adapter service started, exposed port 8186&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:54.750836216Z&#34;</span><span class="o">}</span>
mainflux-ws     <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;gRPC communication is not encrypted&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:56.461422464Z&#34;</span><span class="o">}</span>
mainflux-ws     <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;WebSocket adapter service started, exposed port 8186&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:56.464088709Z&#34;</span><span class="o">}</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Users service started using http, exposed port 8180&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:44.079984747Z&#34;</span><span class="o">}</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Users gRPC service started using http on port 8181&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:44.08013605Z&#34;</span><span class="o">}</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Users gRPC service started, exposed port 8181&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:44.080197181Z&#34;</span><span class="o">}</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Users service started using http, exposed port 8180&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:51.4680891Z&#34;</span><span class="o">}</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Users gRPC service started using http on port 8181&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:51.46830819Z&#34;</span><span class="o">}</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Users gRPC service started, exposed port 8181&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:51.468404853Z&#34;</span><span class="o">}</span>
mainflux-normalizer <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Normalizer service started, exposed port 8184&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:48.535022537Z&#34;</span><span class="o">}</span>
mainflux-normalizer <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Normalizer service started, exposed port 8184&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:49.373415242Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;gRPC communication is not encrypted&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:49.750079428Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Things service started using http on port 8182&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:49.752361349Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Things service started using http on port 8182&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:49.752361346Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Things gRPC service started using http on port 8183&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:49.752597507Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;gRPC communication is not encrypted&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:52.727918949Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Things gRPC service started using http on port 8183&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:52.738161107Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Things service started using http on port 8182&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:52.738246397Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Things service started using http on port 8182&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:52.7383652Z&#34;</span><span class="o">}</span>
mainflux-http   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;gRPC communication is not encrypted&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:52.73695003Z&#34;</span><span class="o">}</span>
mainflux-http   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;HTTP adapter service started on port 8185&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:52.748463145Z&#34;</span><span class="o">}</span>
mainflux-http   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;gRPC communication is not encrypted&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:55.515667114Z&#34;</span><span class="o">}</span>
mainflux-http   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;HTTP adapter service started on port 8185&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:55.519133562Z&#34;</span><span class="o">}</span>
mainflux-coap   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;gRPC communication is not encrypted&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:53.7389281Z&#34;</span><span class="o">}</span>
mainflux-coap   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;CoAP adapter service started, exposed port 5683&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:53.749800784Z&#34;</span><span class="o">}</span>
mainflux-coap   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;CoAP service started, exposed port 5683&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-17T14:22:53.74977476Z&#34;</span><span class="o">}</span>
mainflux-coap   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;gRPC communication is not encrypted&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:54.325773167Z&#34;</span><span class="o">}</span>
mainflux-coap   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;CoAP service started, exposed port 5683&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:54.335582739Z&#34;</span><span class="o">}</span>
mainflux-coap   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;CoAP adapter service started, exposed port 5683&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:54.33578897Z&#34;</span><span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> D0817 14:22:52.050663105       <span class="m">1</span> env_linux.cc:71<span class="o">]</span>            Warning: insecure environment <span class="nb">read</span> <span class="k">function</span> <span class="s1">&#39;getenv&#39;</span> used
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:30,<span class="s2">&#34;time&#34;</span>:1566051772452,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;listening&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;address&#34;</span>:<span class="s2">&#34;::&#34;</span>,<span class="s2">&#34;family&#34;</span>:<span class="s2">&#34;IPv6&#34;</span>,<span class="s2">&#34;port&#34;</span>:1883,<span class="s2">&#34;protocol&#34;</span>:<span class="s2">&#34;tcp&#34;</span>,<span class="s2">&#34;v&#34;</span>:1<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:30,<span class="s2">&#34;time&#34;</span>:1566051772453,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;listening&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;address&#34;</span>:<span class="s2">&#34;::&#34;</span>,<span class="s2">&#34;family&#34;</span>:<span class="s2">&#34;IPv6&#34;</span>,<span class="s2">&#34;port&#34;</span>:8880,<span class="s2">&#34;protocol&#34;</span>:<span class="s2">&#34;http&#34;</span>,<span class="s2">&#34;v&#34;</span>:1<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> node_redis: Warning: Redis server does not require a password, but a password was supplied.
mainflux-mqtt   <span class="p">|</span> <span class="o">[</span>WARN<span class="o">]</span> Redis server does not require a password, but a password was supplied.
mainflux-mqtt   <span class="p">|</span> <span class="o">[</span>WARN<span class="o">]</span> Redis server does not require a password, but a password was supplied.
mainflux-mqtt   <span class="p">|</span> <span class="o">[</span>WARN<span class="o">]</span> Redis server does not require a password, but a password was supplied.
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;mqtt&#34;</span>,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;level&#34;</span>:40,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;error on redis connection: Redis connection to es-redis:6379 failed - connect ECONNREFUSED 172.18.0.3:6379&#34;</span>,<span class="s2">&#34;time&#34;</span>:<span class="s2">&#34;2019-08-18T06:06:57.912Z&#34;</span>,<span class="s2">&#34;v&#34;</span>:0<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;mqtt&#34;</span>,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;level&#34;</span>:40,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;error on redis connection: Redis connection to es-redis:6379 failed - connect ECONNREFUSED 172.18.0.3:6379&#34;</span>,<span class="s2">&#34;time&#34;</span>:<span class="s2">&#34;2019-08-18T06:06:58.259Z&#34;</span>,<span class="s2">&#34;v&#34;</span>:0<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;mqtt&#34;</span>,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;level&#34;</span>:40,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;error on redis connection: Redis connection to es-redis:6379 failed - getaddrinfo ENOTFOUND es-redis es-redis:6379&#34;</span>,<span class="s2">&#34;time&#34;</span>:<span class="s2">&#34;2019-08-18T06:06:58.887Z&#34;</span>,<span class="s2">&#34;v&#34;</span>:0<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;mqtt&#34;</span>,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;level&#34;</span>:40,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;error on redis connection: Redis connection to es-redis:6379 failed - getaddrinfo ENOTFOUND es-redis es-redis:6379&#34;</span>,<span class="s2">&#34;time&#34;</span>:<span class="s2">&#34;2019-08-18T06:06:59.904Z&#34;</span>,<span class="s2">&#34;v&#34;</span>:0<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;mqtt&#34;</span>,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;level&#34;</span>:40,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;error on redis connection: Redis connection to es-redis:6379 failed - getaddrinfo ENOTFOUND es-redis es-redis:6379&#34;</span>,<span class="s2">&#34;time&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:01.585Z&#34;</span>,<span class="s2">&#34;v&#34;</span>:0<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;mqtt&#34;</span>,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;level&#34;</span>:40,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;error on redis connection: Redis connection to es-redis:6379 failed - getaddrinfo ENOTFOUND es-redis es-redis:6379&#34;</span>,<span class="s2">&#34;time&#34;</span>:<span class="s2">&#34;2019-08-18T06:07:04.444Z&#34;</span>,<span class="s2">&#34;v&#34;</span>:0<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> D0818 06:07:58.025853349       <span class="m">1</span> env_linux.cc:71<span class="o">]</span>            Warning: insecure environment <span class="nb">read</span> <span class="k">function</span> <span class="s1">&#39;getenv&#39;</span> used
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:30,<span class="s2">&#34;time&#34;</span>:1566108478429,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;listening&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;address&#34;</span>:<span class="s2">&#34;::&#34;</span>,<span class="s2">&#34;family&#34;</span>:<span class="s2">&#34;IPv6&#34;</span>,<span class="s2">&#34;port&#34;</span>:1883,<span class="s2">&#34;protocol&#34;</span>:<span class="s2">&#34;tcp&#34;</span>,<span class="s2">&#34;v&#34;</span>:1<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:30,<span class="s2">&#34;time&#34;</span>:1566108478430,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;listening&#34;</span>,<span class="s2">&#34;pid&#34;</span>:1,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;941c67d26e08&#34;</span>,<span class="s2">&#34;address&#34;</span>:<span class="s2">&#34;::&#34;</span>,<span class="s2">&#34;family&#34;</span>:<span class="s2">&#34;IPv6&#34;</span>,<span class="s2">&#34;port&#34;</span>:8880,<span class="s2">&#34;protocol&#34;</span>:<span class="s2">&#34;http&#34;</span>,<span class="s2">&#34;v&#34;</span>:1<span class="o">}</span>
mainflux-mqtt   <span class="p">|</span> node_redis: Warning: Redis server does not require a password, but a password was supplied.
mainflux-mqtt   <span class="p">|</span> <span class="o">[</span>WARN<span class="o">]</span> Redis server does not require a password, but a password was supplied.
mainflux-mqtt   <span class="p">|</span> <span class="o">[</span>WARN<span class="o">]</span> Redis server does not require a password, but a password was supplied.
mainflux-mqtt   <span class="p">|</span> <span class="o">[</span>WARN<span class="o">]</span> Redis server does not require a password, but a password was supplied.
</code></pre></td></tr></table>
</div>
</div><p>这样就算是正常启动了，但是启动过程中一些警告（主要是Redis的警告）和有一条日志INFO报告连接gRPC端口14250时失败，完整看完日志信息后，认为这些应该是正常的。</p>
<p>现在再列举下容器列表：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ docker ps
CONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS              PORTS                                                                                                                               NAMES
26e7692f31b7        nginx:1.16.0-alpine             <span class="s2">&#34;/entrypoint.sh&#34;</span>         About an hour ago   Up <span class="m">12</span> minutes       0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8883-&gt;8883/tcp, 80/tcp, 0.0.0.0:8888-&gt;8888/tcp                                                        26e7692f31b7_mainflux-nginx
4bb5cd9596ea        mainflux/ws:latest              <span class="s2">&#34;/exe&#34;</span>                   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       0.0.0.0:8186-&gt;8186/tcp                                                                                                              mainflux-ws
8c0c4ccbbd55        mainflux/coap:latest            <span class="s2">&#34;/exe&#34;</span>                   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       0.0.0.0:5683-&gt;5683/udp                                                                                                              mainflux-coap
941c67d26e08        mainflux/mqtt:latest            <span class="s2">&#34;node mqtt.js&#34;</span>           <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       0.0.0.0:1883-&gt;1883/tcp, 0.0.0.0:8880-&gt;8880/tcp                                                                                      mainflux-mqtt
51206daffd4f        mainflux/http:latest            <span class="s2">&#34;/exe&#34;</span>                   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       0.0.0.0:8185-&gt;8185/tcp                                                                                                              mainflux-http
eb9bc8ac2e0a        mainflux/normalizer:latest      <span class="s2">&#34;/exe&#34;</span>                   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       0.0.0.0:8184-&gt;8184/tcp                                                                                                              mainflux-normalizer
d1579ed65dff        mainflux/things:latest          <span class="s2">&#34;/exe&#34;</span>                   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       0.0.0.0:8182-8183-&gt;8182-8183/tcp, 0.0.0.0:8989-&gt;8989/tcp                                                                            mainflux-things
fea1599f1faf        mainflux/users:latest           <span class="s2">&#34;/exe&#34;</span>                   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       0.0.0.0:8180-&gt;8180/tcp, 8181/tcp                                                                                                    mainflux-users
d20f696b6a37        nats:1.3.0                      <span class="s2">&#34;/gnatsd -c gnatsd.c…&#34;</span>   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       4222/tcp, 6222/tcp, 8222/tcp                                                                                                        mainflux-nats
08b0d3a188f9        postgres:10.8-alpine            <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       5432/tcp                                                                                                                            mainflux-users-db
310c048cb4f3        jaegertracing/all-in-one:1.13   <span class="s2">&#34;/go/bin/all-in-one-…&#34;</span>   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       5775/udp, 0.0.0.0:5778-&gt;5778/tcp, 0.0.0.0:14268-&gt;14268/tcp, 6832/udp, 0.0.0.0:16686-&gt;16686/tcp, 0.0.0.0:6831-&gt;6831/udp, 14250/tcp   mainflux-jaeger
d84ae3be3425        redis:5.0-alpine                <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       6379/tcp                                                                                                                            mainflux-es-redis
aef24619a59a        redis:5.0-alpine                <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       6379/tcp                                                                                                                            mainflux-things-redis
3afec1d3a3e0        postgres:10.8-alpine            <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       5432/tcp                                                                                                                            mainflux-things-db
6f05dbae388f        redis:5.0-alpine                <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       6379/tcp                                                                                                                            mainflux-mqtt-redis
0f9972dc12c5        mainflux/ui:latest              <span class="s2">&#34;/entrypoint.sh&#34;</span>         <span class="m">17</span> hours ago        Up <span class="m">58</span> minutes       80/tcp, 0.0.0.0:3000-&gt;3000/tcp                                                                                                      mainflux-ui
</code></pre></td></tr></table>
</div>
</div><p>我们已经启动了mainflux-ui，那么就可以在浏览器查看下我们的mainflux-ui了，浏览器输入127.0.0.1:3000，得到如下结果：</p>
<p><img src="/images/mainflux-ui-01.png" alt="mainflux-ui-01">
<img src="../../../static/images/mainflux-ui-01.png" alt="mainflux-ui-01"></p>
<h3 id="122-安装mainflux-cli">12.2 安装mainflux-cli</h3>
<p>上一节中启动了mainflux的所有docker微服务，接下来要安装mainflux客户端来进行一些操作了。</p>
<p>mainflux-cli应当从github页面<a href="https://github.com/mainflux/mainflux/releases">https://github.com/mainflux/mainflux/releases</a>下载最新发行版，并将之解压后放到本机<code>$GOBIN</code>目录下。这就完成了安装。</p>
<p>但是我在前边手动编译的环节其实已经完成了mainflux-cli安装，所以这一步跳过。</p>
<h3 id="123-系统测试配置provisioning">12.3 系统测试配置（Provisioning）</h3>
<p>在系统测试之前，应执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-cli provision <span class="nb">test</span>
</code></pre></td></tr></table>
</div>
</div><p>这一步会生成一个临时测试用户<code>user</code>，并登陆，然后创建属于其的两个<code>thing</code>和两个<code>channel</code>。这将用作测试场景。关于系统准备<code>system provision</code>的更多内容参考：<a href="https://mainflux.readthedocs.io/en/latest/provisioning/">https://mainflux.readthedocs.io/en/latest/provisioning/</a></p>
<p>但是现在无论是在哪里执行<code>mainflux-cli provision test</code>都会报错：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ mainflux-cli provision <span class="nb">test</span>

failed to create entity
</code></pre></td></tr></table>
</div>
</div><p>好了，现在让我们来看下mainflux-cli部分源码吧。</p>
<p>mainflux-cli主要包括<code>mainflux/cmd/cli/main.go</code>入口文件和<code>mainflux/cli/</code>下所有文件，我们现在主要关心<code>provision</code>命令，所以我们主要查看<code>mainflux/cli/provision.go</code>文件，在其中我们找到provision的test子命令所在：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
    <span class="nx">Use</span><span class="p">:</span>   <span class="s">&#34;test&#34;</span><span class="p">,</span>
    <span class="nx">Short</span><span class="p">:</span> <span class="s">&#34;test&#34;</span><span class="p">,</span>
    <span class="nx">Long</span><span class="p">:</span> <span class="s">`Provisions test setup: one test user, two things and two channels. \
</span><span class="s">            Connect both things to one of the channels, \
</span><span class="s">            and only on thing to other channel.`</span><span class="p">,</span>
    <span class="nx">Run</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">cmd</span> <span class="o">*</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">numThings</span> <span class="o">:=</span> <span class="mi">2</span>
        <span class="nx">numChan</span> <span class="o">:=</span> <span class="mi">2</span>
        <span class="nx">things</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">mfxsdk</span><span class="p">.</span><span class="nx">Thing</span><span class="p">{}</span>
        <span class="nx">channels</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">mfxsdk</span><span class="p">.</span><span class="nx">Channel</span><span class="p">{}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nf">logUsage</span><span class="p">(</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">Short</span><span class="p">)</span>
        <span class="k">return</span>
        <span class="p">}</span>

        <span class="nx">un</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s@email.com&#34;</span><span class="p">,</span> <span class="nx">namesgenerator</span><span class="p">.</span><span class="nf">GetRandomName</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1">// Create test user
</span><span class="c1"></span>        <span class="nx">user</span> <span class="o">:=</span> <span class="nx">mfxsdk</span><span class="p">.</span><span class="nx">User</span><span class="p">{</span>
            <span class="nx">Email</span><span class="p">:</span>    <span class="nx">un</span><span class="p">,</span>
            <span class="nx">Password</span><span class="p">:</span> <span class="s">&#34;123&#34;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sdk</span><span class="p">.</span><span class="nf">CreateUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nf">logError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="nx">ut</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sdk</span><span class="p">.</span><span class="nf">CreateToken</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nf">logError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="c1">// Create things
</span><span class="c1"></span>        <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">numThings</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="nx">n</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;d%d&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>

            <span class="nx">m</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">createThing</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">ut</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nf">logError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>

            <span class="nx">things</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">things</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1">// Create channels
</span><span class="c1"></span>        <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">numChan</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="nx">n</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;c%d&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
            <span class="nx">c</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">createChannel</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">ut</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nf">logError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>

            <span class="nx">channels</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">channels</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1">// Connect things to channels - first thing to both channels, second only to first
</span><span class="c1"></span>        <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">numThings</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sdk</span><span class="p">.</span><span class="nf">ConnectThing</span><span class="p">(</span><span class="nx">things</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">ID</span><span class="p">,</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">ID</span><span class="p">,</span> <span class="nx">ut</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nf">logError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="nx">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="k">if</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">channels</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">break</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sdk</span><span class="p">.</span><span class="nf">ConnectThing</span><span class="p">(</span><span class="nx">things</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">ID</span><span class="p">,</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="nx">ID</span><span class="p">,</span> <span class="nx">ut</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                    <span class="nf">logError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nf">logJSON</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">ut</span><span class="p">,</span> <span class="nx">things</span><span class="p">,</span> <span class="nx">channels</span><span class="p">)</span>
    <span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><p>我在输入<code>mainflux-cli provision test</code>时报了无法创建实体的错，那么按照子命令中运行流程来看第一个可能出错的位置在于“Create test user”一段，那么我们进而去查看<code>sdk.CreateUser</code>方法的定义，在mainflux/sdk/go/sdk.go中我们看到SDK接口中定义了该方法，进而在mainflux/sdk/go/users.go中看到该方法的实现：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sdk</span> <span class="nx">mfSDK</span><span class="p">)</span> <span class="nf">CreateUser</span><span class="p">(</span><span class="nx">user</span> <span class="nx">User</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">ErrInvalidArgs</span>
    <span class="p">}</span>

    <span class="nx">url</span> <span class="o">:=</span> <span class="nf">createURL</span><span class="p">(</span><span class="nx">sdk</span><span class="p">.</span><span class="nx">baseURL</span><span class="p">,</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">usersPrefix</span><span class="p">,</span> <span class="s">&#34;users&#34;</span><span class="p">)</span>

    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nf">Post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">CTJSON</span><span class="p">),</span> <span class="nx">bytes</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">err</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span> <span class="o">!=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">:</span>
            <span class="k">return</span> <span class="nx">ErrInvalidArgs</span>
        <span class="k">case</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusConflict</span><span class="p">:</span>
            <span class="k">return</span> <span class="nx">ErrConflict</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="nx">ErrFailedCreation</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这里的<code>ErrFailedCreation</code>看上去可能会是我们碰到的“无法创建实体”错误，我们查看下其定义：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// mainflux/sdk/go/sdk.go
</span><span class="c1"></span><span class="kd">var</span> <span class="p">(</span>
    <span class="c1">// ErrFailedCreation indicates that entity creation failed.
</span><span class="c1"></span>    <span class="nx">ErrFailedCreation</span> <span class="p">=</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;failed to create entity&#34;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>果然是这个错误！那么说明我们在执行<code>mainflux-cli provision test</code>时出错片段在：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="k">if</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span> <span class="o">!=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">ErrInvalidArgs</span>
    <span class="k">case</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusConflict</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">ErrConflict</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">ErrFailedCreation</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这说明<code>CreateUser</code>方法在向服务发起请求后得到的回应是有问题的，而且不是网络状态问题，也不是无效参数问题。所以我们得检查下user服务。</p>
<p>在进一步源码阅读之前，我们先再阅读下官方文档<code>provisioning</code>章节，在<a href="https://mainflux.readthedocs.io/en/latest/provisioning/#users-management">https://mainflux.readthedocs.io/en/latest/provisioning/#users-management</a>中直接使用给出的请求命令，得到的结果是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> https://localhost/users -d <span class="s1">&#39;{&#34;email&#34;:&#34;john.doe@email.com&#34;, &#34;password&#34;:&#34;123&#34;}&#39;</span>
HTTP/2 <span class="m">201</span>
server: nginx/1.16.0
date: Sun, <span class="m">18</span> Aug <span class="m">2019</span> 08:31:37 GMT
content-type: application/json
content-length: <span class="m">0</span>
strict-transport-security: max-age<span class="o">=</span>63072000<span class="p">;</span> includeSubdomains
x-frame-options: DENY
x-content-type-options: nosniff
access-control-allow-origin: *
access-control-allow-methods: *
access-control-allow-headers: *
</code></pre></td></tr></table>
</div>
</div><p>连接被拒绝了，而且在该节还有个小提示：<code>Note that when using official docker-compose, all services are behind nginx proxy and all traffic is TLS encrypted.</code>，而我们启动正是以docker-compose方式启动，所以我们前面<code>test</code>失败也很可能是因为客户端是遵循非安全连接而服务端只接受安全连接导致连接请求被拒绝！</p>
<p>下面是几次尝试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> https://localhost/users -d <span class="s1">&#39;{&#34;email&#34;:&#34;john.doe@email.com&#34;, &#34;password&#34;:&#34;123&#34;}&#39;</span>
HTTP/2 <span class="m">201</span>
server: nginx/1.16.0
date: Sun, <span class="m">18</span> Aug <span class="m">2019</span> 08:31:37 GMT
content-type: application/json
content-length: <span class="m">0</span>
strict-transport-security: max-age<span class="o">=</span>63072000<span class="p">;</span> includeSubdomains
x-frame-options: DENY
x-content-type-options: nosniff
access-control-allow-origin: *
access-control-allow-methods: *
access-control-allow-headers: *

eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --secure -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> https://localhost/users -d <span class="s1">&#39;{&#34;email&#34;:&#34;john.doe@email.com&#34;, &#34;password&#34;:&#34;123&#34;}&#39;</span>
curl: option --secure: is unknown
curl: try <span class="s1">&#39;curl --help&#39;</span> or <span class="s1">&#39;curl --manual&#39;</span> <span class="k">for</span> more information
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> https://localhost/users -d <span class="s1">&#39;{&#34;email&#34;:&#34;john.doe@email.com&#34;, &#34;password&#34;:&#34;123&#34;}&#39;</span>
curl: <span class="o">(</span>77<span class="o">)</span> error setting certificate verify locations:
  CAfile: docker/ssl/certs/mainflux-server.crt
  CApath: /etc/ssl/certs
eiger@eiger-ThinkPad-X1-Carbon-3rd:~$ <span class="nb">cd</span> ~/gopath-default/src/github.com/mainflux/mainflux/
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> https://localhost/users -d <span class="s1">&#39;{&#34;email&#34;:&#34;john.doe@email.com&#34;, &#34;password&#34;:&#34;123&#34;}&#39;</span>
curl: <span class="o">(</span>60<span class="o">)</span> SSL certificate problem: unable to get <span class="nb">local</span> issuer certificate
More details here: https://curl.haxx.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$
</code></pre></td></tr></table>
</div>
</div><p>尽管摸索出来需要在mainflux根目录运行，但仍然提示说验证失败无法建立安全连接<code>curl failed to verify the legitimacy of the server and therefore could not establish a secure connection to it.</code></p>
<p>现在的情况是nginx反向代理服务器需要安全连接，而我们不知道怎样建立安全连接。所以有两条路走：</p>
<ul>
<li>学习如何建立安全连接</li>
<li>修改dockercompose.yml使nginx不要求安全连接，也就是不检查证书</li>
</ul>
<p>在mainflux根目录下输入发起注册用户请求：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> https://localhost/users -d <span class="s1">&#39;{&#34;email&#34;:&#34;374192922@email.com&#34;, &#34;password&#34;:&#34;123456&#34;}&#39;</span>
HTTP/2 <span class="m">201</span>
server: nginx/1.16.0
date: Sun, <span class="m">18</span> Aug <span class="m">2019</span> 09:12:35 GMT
content-type: application/json
content-length: <span class="m">0</span>
strict-transport-security: max-age<span class="o">=</span>63072000<span class="p">;</span> includeSubdomains
x-frame-options: DENY
x-content-type-options: nosniff
access-control-allow-origin: *
access-control-allow-methods: *
access-control-allow-headers: *
</code></pre></td></tr></table>
</div>
</div><p>这里返回结果我也不清楚是成功还是失败。</p>
<p>同时在mainflux服务终端输出了相应信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method register for user 374192922@email.com took 90.009818ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-18T09:12:35.369333654Z&#34;</span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>好像又是注册成功了的意思？？根据官方文档<a href="https://mainflux.readthedocs.io/en/latest/getting-started/#step-3-provision-the-system">https://mainflux.readthedocs.io/en/latest/getting-started/#step-3-provision-the-system</a>处用户注册成功的案例描述，应该确实是注册成功了。</p>
<p>那么也就是通过这样的方式确实能够注册用户。</p>
<p>接下来我在mainflux-ui尝试登陆却出错了：</p>
<p><img src="/images/mainflux-ui-02.png" alt="mainflux-ui-02">
<img src="../../../static/images/mainflux-ui-02.png" alt="mainflux-ui-02"></p>
<p>同时mainflux系统终端输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-ui     <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>18/Aug/2019:09:34:05 +0000<span class="o">]</span> <span class="s2">&#34;POST /tokens HTTP/1.1&#34;</span> <span class="m">405</span> <span class="m">575</span> <span class="s2">&#34;http://127.0.0.1:3000/&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span> <span class="s2">&#34;-&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>同样，给出了405的http状态码。</p>
<hr>
<p>在多次尝试无果后，开始分析问题，问题出在cli和ui都无法正常和nginx进行通信，也就无法和nginx代理的诸多服务进行连接。而官方文档却并未多作说明，是不是因为我修改了nginx端口，而其他服务和nginx建立连接的地方在代码中写死了是80端口呢？</p>
<p>尝试一下。</p>
<p>将<code>.env</code>文件中nginx的http端口改回80，执行<code>make run</code>，果不其然提示nginx的80端口被占用。这回我们选择杀掉占用该端口的进程！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo netstat -lnp <span class="p">|</span> grep <span class="m">80</span>
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> eiger:
tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:80              0.0.0.0:*               LISTEN      1193/nginx: master
tcp6       <span class="m">0</span>      <span class="m">0</span> :::8880                 :::*                    LISTEN      19939/docker-proxy
tcp6       <span class="m">0</span>      <span class="m">0</span> :::80                   :::*                    LISTEN      1193/nginx: master
tcp6       <span class="m">0</span>      <span class="m">0</span> :::8180                 :::*                    LISTEN      19576/docker-proxy
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     SEQPACKET  LISTENING     <span class="m">13802</span>    1/init               /run/udev/control
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">27808</span>    1596/Xorg            /tmp/.X11-unix/X0
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">180757</span>   8303/code            /run/user/1000/vscode-06f15111-1.37.0-main.sock
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">27807</span>    1596/Xorg            @/tmp/.X11-unix/X0
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">184361</span>   8973/code            /run/user/1000/vscode-git-askpass-830bbc748f92bec499b4d793b9a26bcc67f98049.sock
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">238009</span>   19584/containerd-sh  @/containerd-shim/moby/fea1599f1fafb50ec78e979f461f77bb99350205c33c622d1841938e586582ab/shim.sock@
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">230354</span>   18640/containerd-sh  @/conta
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo <span class="nb">kill</span> -9 <span class="m">1193</span>
eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ sudo netstat -lnp <span class="p">|</span> grep <span class="m">80</span>
tcp6       <span class="m">0</span>      <span class="m">0</span> :::8880                 :::*                    LISTEN      19939/docker-proxy
tcp6       <span class="m">0</span>      <span class="m">0</span> :::8180                 :::*                    LISTEN      19576/docker-proxy
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     SEQPACKET  LISTENING     <span class="m">13802</span>    1/init               /run/udev/control
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">27808</span>    1596/Xorg            /tmp/.X11-unix/X0
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">180757</span>   8303/code            /run/user/1000/vscode-06f15111-1.37.0-main.sock
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">27807</span>    1596/Xorg            @/tmp/.X11-unix/X0
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">184361</span>   8973/code            /run/user/1000/vscode-git-askpass-830bbc748f92bec499b4d793b9a26bcc67f98049.sock
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">238009</span>   19584/containerd-sh  @/containerd-shim/moby/fea1599f1fafb50ec78e979f461f77bb99350205c33c622d1841938e586582ab/shim.sock@
unix  <span class="m">2</span>      <span class="o">[</span> ACC <span class="o">]</span>     STREAM     LISTENING     <span class="m">230354</span>   18640/containerd-sh  @/containerd-shim/moby/aef24619a59af74650841b80deca2addcf0f325659ff88b46e7a415308615aee/shim.sock@
</code></pre></td></tr></table>
</div>
</div><p>再执行<code>make run</code>这回全部服务就正常运行起来了。</p>
<p>现在我们需要分别试试mainflux-ui和mainflux-cli。</p>
<p>先试试mainflux-cli。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ mainflux-cli version

<span class="s2">&#34;0.9.0&#34;</span>

eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ mainflux-cli provision <span class="nb">test</span>

<span class="o">{</span>
  <span class="s2">&#34;email&#34;</span>: <span class="s2">&#34;distracted_goldberg@email.com&#34;</span>,
  <span class="s2">&#34;password&#34;</span>: <span class="s2">&#34;123&#34;</span>
<span class="o">}</span>


<span class="s2">&#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYxNjkzNTMsImlhdCI6MTU2NjEzMzM1MywiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJkaXN0cmFjdGVkX2dvbGRiZXJnQGVtYWlsLmNvbSJ9.48juMD1G25swxXYHe_ydHAY5kUdOC76sF6TebxEIKw4&#34;</span>


<span class="o">[</span>
  <span class="o">{</span>
    <span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;472afd2e-eb93-4a35-a043-c766ae5bb340&#34;</span>,
    <span class="s2">&#34;key&#34;</span>: <span class="s2">&#34;f586a9d6-65b2-402a-991f-df3f589dde03&#34;</span>,
    <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;d0&#34;</span>
  <span class="o">}</span>,
  <span class="o">{</span>
    <span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;b0963af4-9c86-4b1b-b66e-83225c3a61dc&#34;</span>,
    <span class="s2">&#34;key&#34;</span>: <span class="s2">&#34;4e7a2353-e190-474c-b870-09119540d07a&#34;</span>,
    <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;d1&#34;</span>
  <span class="o">}</span>
<span class="o">]</span>


<span class="o">[</span>
  <span class="o">{</span>
    <span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;56e9b2eb-1825-4405-9cfd-8f5da524bc5a&#34;</span>,
    <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;c0&#34;</span>
  <span class="o">}</span>,
  <span class="o">{</span>
    <span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;ffd36101-2eca-4a1f-995e-40db52ae3546&#34;</span>,
    <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;c1&#34;</span>
  <span class="o">}</span>
<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><p>对应的mainflux系统输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:50 +0000<span class="o">]</span> <span class="s2">&#34;POST /users HTTP/1.1&#34;</span> <span class="m">201</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method register for user pensive_pike@email.com took 97.212206ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:50.946048858Z&#34;</span><span class="o">}</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method login for user pensive_pike@email.com took 91.421359ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.039202211Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;POST /tokens HTTP/1.1&#34;</span> <span class="m">201</span> <span class="m">205</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client pensive_pike@email.com took 76.822µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.049014024Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;POST /things HTTP/1.1&#34;</span> <span class="m">201</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client pensive_pike@email.com took 111.644µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.08432965Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;GET /things/c7d43640-0dcd-4906-ac6b-6e402977a5ae HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">103</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client pensive_pike@email.com took 62.202µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.087101305Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method add_thing for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4 and thing c7d43640-0dcd-4906-ac6b-6e402977a5ae took 25.942086ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.082656145Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method view_thing for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4 and thing c7d43640-0dcd-4906-ac6b-6e402977a5ae took 1.893131ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.085790957Z&#34;</span><span class="o">}</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">19</span> Aug <span class="m">2019</span> 05:01:51.085 * <span class="m">1</span> changes in <span class="m">3600</span> seconds. Saving...
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">19</span> Aug <span class="m">2019</span> 05:01:51.085 * Background saving started by pid <span class="m">13</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method add_thing for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4 and thing d3f98848-2c3f-4cb7-9b2d-83ee6cdcbd7b took 13.657223ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.100444341Z&#34;</span><span class="o">}</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client pensive_pike@email.com took 63.645µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.103297048Z&#34;</span><span class="o">}</span>
mainflux-es-redis <span class="p">|</span> 13:C <span class="m">19</span> Aug <span class="m">2019</span> 05:01:51.102 * DB saved on disk
mainflux-es-redis <span class="p">|</span> 13:C <span class="m">19</span> Aug <span class="m">2019</span> 05:01:51.102 * RDB: <span class="m">0</span> MB of memory used by copy-on-write
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;POST /things HTTP/1.1&#34;</span> <span class="m">201</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method view_thing for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4 and thing d3f98848-2c3f-4cb7-9b2d-83ee6cdcbd7b took 1.537343ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.104173072Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;GET /things/d3f98848-2c3f-4cb7-9b2d-83ee6cdcbd7b HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">103</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client pensive_pike@email.com took 68.712µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.108924879Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method create_channel for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4 and channel  took 9.443113ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.118044827Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;POST /channels HTTP/1.1&#34;</span> <span class="m">201</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client pensive_pike@email.com took 137.705µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.119680765Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method create_channel for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4 and channel  took 2.605725ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.121788949Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;POST /channels HTTP/1.1&#34;</span> <span class="m">201</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client pensive_pike@email.com took 70.85µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.129063142Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method connect for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4, channel 3e307fb1-d41c-49d1-853f-bc48e0e2f734 and thing c7d43640-0dcd-4906-ac6b-6e402977a5ae took 15.118173ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.13813717Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;PUT /channels/3e307fb1-d41c-49d1-853f-bc48e0e2f734/things/c7d43640-0dcd-4906-ac6b-6e402977a5ae HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client pensive_pike@email.com took 52.583µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.139484322Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method connect for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4, channel af1045ac-fdc1-4091-b0ba-234ebe5e167b and thing c7d43640-0dcd-4906-ac6b-6e402977a5ae took 2.796857ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.141942135Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;PUT /channels/af1045ac-fdc1-4091-b0ba-234ebe5e167b/things/c7d43640-0dcd-4906-ac6b-6e402977a5ae HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client pensive_pike@email.com took 52.562µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.143426123Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method connect for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4, channel af1045ac-fdc1-4091-b0ba-234ebe5e167b and thing d3f98848-2c3f-4cb7-9b2d-83ee6cdcbd7b took 2.297169ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T05:01:51.145410019Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:01:51 +0000<span class="o">]</span> <span class="s2">&#34;PUT /channels/af1045ac-fdc1-4091-b0ba-234ebe5e167b/things/d3f98848-2c3f-4cb7-9b2d-83ee6cdcbd7b HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-es-redis <span class="p">|</span> 1:M <span class="m">19</span> Aug <span class="m">2019</span> 05:01:51.185 * Background saving terminated with success
</code></pre></td></tr></table>
</div>
</div><p>看上去成功了！</p>
<p>接下来将test随即注册的账号在mainflux-ui界面登录试试：</p>
<p>在127.0.0.1:3000页面下尝试登录前面随机生成的用户，依然返回405。</p>
<p>是不是要使用docker的虚拟ip呢？docker的虚拟ip默认为172.17.0.1，但是我们还是来手动查看一下。执行<code>ifconfig</code>，可以看到这样一段：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ ifconfig
br-1f6c96862db4: <span class="nv">flags</span><span class="o">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="m">1500</span>
        inet 172.18.0.1  netmask 255.255.0.0  broadcast 172.18.255.255
        inet6 fe80::42:aff:fe58:4f6  prefixlen <span class="m">64</span>  scopeid 0x20&lt;link&gt;
        ether 02:42:0a:58:04:f6  txqueuelen <span class="m">0</span>  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets <span class="m">1103</span>  bytes <span class="m">56812</span> <span class="o">(</span>56.8 KB<span class="o">)</span>
        RX errors <span class="m">0</span>  dropped <span class="m">0</span>  overruns <span class="m">0</span>  frame <span class="m">0</span>
        TX packets <span class="m">1312</span>  bytes <span class="m">153384</span> <span class="o">(</span>153.3 KB<span class="o">)</span>
        TX errors <span class="m">0</span>  dropped <span class="m">0</span> overruns <span class="m">0</span>  carrier <span class="m">0</span>  collisions <span class="m">0</span>


docker0: <span class="nv">flags</span><span class="o">=</span>4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu <span class="m">1500</span>
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
        ether 02:42:e5:24:90:7c  txqueuelen <span class="m">0</span>  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets <span class="m">0</span>  bytes <span class="m">0</span> <span class="o">(</span>0.0 B<span class="o">)</span>
        RX errors <span class="m">0</span>  dropped <span class="m">0</span>  overruns <span class="m">0</span>  frame <span class="m">0</span>
        TX packets <span class="m">0</span>  bytes <span class="m">0</span> <span class="o">(</span>0.0 B<span class="o">)</span>
        TX errors <span class="m">0</span>  dropped <span class="m">0</span> overruns <span class="m">0</span>  carrier <span class="m">0</span>  collisions <span class="m">0</span>
</code></pre></td></tr></table>
</div>
</div><p>说明docker ip确实是172.17.0.1。现在我们试试浏览器访问172.17.0.1:3000：</p>
<p><img src="/images/mainflux-ui-03.png" alt="mainflux-ui-03">
<img src="../../../static/images/mainflux-ui-03.png" alt="mainflux-ui-03"></p>
<p>这时mainflux系统输出为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-ui     <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:21:10 +0000<span class="o">]</span> <span class="s2">&#34;GET / HTTP/1.1&#34;</span> <span class="m">304</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span> <span class="s2">&#34;-&#34;</span>
mainflux-ui     <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:21:10 +0000<span class="o">]</span> <span class="s2">&#34;GET /css/mainflux.css HTTP/1.1&#34;</span> <span class="m">304</span> <span class="m">0</span> <span class="s2">&#34;http://172.17.0.1:3000/&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span> <span class="s2">&#34;-&#34;</span>
mainflux-ui     <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:21:10 +0000<span class="o">]</span> <span class="s2">&#34;GET /main.js HTTP/1.1&#34;</span> <span class="m">304</span> <span class="m">0</span> <span class="s2">&#34;http://172.17.0.1:3000/&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span> <span class="s2">&#34;-&#34;</span>
mainflux-ui     <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:21:10 +0000<span class="o">]</span> <span class="s2">&#34;GET /src/Websocket.js HTTP/1.1&#34;</span> <span class="m">304</span> <span class="m">0</span> <span class="s2">&#34;http://172.17.0.1:3000/&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span> <span class="s2">&#34;-&#34;</span>
mainflux-ui     <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:05:21:12 +0000<span class="o">]</span> <span class="s2">&#34;GET /favicon.ico HTTP/1.1&#34;</span> <span class="m">304</span> <span class="m">0</span> <span class="s2">&#34;http://172.17.0.1:3000/&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span> <span class="s2">&#34;-&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>这时注意到终端其实输出的ip为172.18.0.1，那么浏览器输入172.18.0.1:3000试试？</p>
<p><img src="/images/mainflux-ui-04.png" alt="mainflux-ui-04">
<img src="../../../static/images/mainflux-ui-04.png" alt="mainflux-ui-04"></p>
<p>也能行！</p>
<p>现在我们来试试在两个网址中与mainflux后端系统进行交互看是否能成功。我们准备了两个生成的用户（通过<code>mainflux-cli provision test</code>生成）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;distracted_goldberg@email.com&#34;</span><span class="p">,</span>
  <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;123&#34;</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;pensive_pike@email.com&#34;</span><span class="p">,</span>
  <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;123&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>经过测试，浏览器输入以下链接均可进入mainflux-ui登录界面：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">127.0.0.1
127.0.0.1:3000
172.17.0.1
172.17.0.1:3000
172.18.0.1
172.18.0.1:3000
</code></pre></td></tr></table>
</div>
</div><p>但是只有输入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">127.0.0.1
172.17.0.1
172.18.0.1
</code></pre></td></tr></table>
</div>
</div><p>后的界面能正常登录。</p>
<p>其实从终端日志显示的<code>172.18.0.1</code>来看，应该是nginx里写好了解析规则，输入<code>127.0.0.1</code>或者<code>172.17.0.1</code>都会被解析到<code>172.18.0.1</code>。</p>
<p>这里放一下<code>172.18.0.1</code>的登陆成功页面：</p>
<p><img src="/images/mainflux-ui-06.png" alt="mainflux-ui-06">
<img src="../../../static/images/mainflux-ui-06.png" alt="mainflux-ui-06"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method login for user distracted_goldberg@email.com took 92.773994ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T06:02:53.426102548Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:06:02:53 +0000<span class="o">]</span> <span class="s2">&#34;POST /tokens HTTP/1.1&#34;</span> <span class="m">201</span> <span class="m">214</span> <span class="s2">&#34;http://172.18.0.1/&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:06:02:53 +0000<span class="o">]</span> <span class="s2">&#34;GET /version HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">38</span> <span class="s2">&#34;http://172.18.0.1/&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client distracted_goldberg@email.com took 84.523µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T06:02:53.433221746Z&#34;</span><span class="o">}</span>
mainflux-users  <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method identity for client distracted_goldberg@email.com took 70.071µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T06:02:53.434277438Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method list_channels for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMzA1NzMsImlhdCI6MTU2NjE5NDU3MywiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJkaXN0cmFjdGVkX2dvbGRiZXJnQGVtYWlsLmNvbSJ9.lFhy2KPWE4jIkWvMMUxhDAsCqG-_cgHdqiI1e2vjj10 took 2.78473ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T06:02:53.435522551Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method list_things for token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMzA1NzMsImlhdCI6MTU2NjE5NDU3MywiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJkaXN0cmFjdGVkX2dvbGRiZXJnQGVtYWlsLmNvbSJ9.lFhy2KPWE4jIkWvMMUxhDAsCqG-_cgHdqiI1e2vjj10 took 2.266344ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T06:02:53.436236164Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:06:02:53 +0000<span class="o">]</span> <span class="s2">&#34;GET /channels?offset=0&amp;limit=10 HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">163</span> <span class="s2">&#34;http://172.18.0.1/&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:06:02:53 +0000<span class="o">]</span> <span class="s2">&#34;GET /things?offset=0&amp;limit=10 HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">251</span> <span class="s2">&#34;http://172.18.0.1/&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#34;</span>

</code></pre></td></tr></table>
</div>
</div><p>(ps: 这里时间显示6:02，比本机系统时间快了4小时，可能是时区的设置问题，不影响我们的测试)</p>
<p>接下来我们试着在mainflux-ui界面注册一个用户：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;374192922@qq.com&#34;</span><span class="p">,</span>
  <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;123456&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>注册成功了，我们登录进去看看：</p>
<p><img src="/images/mainflux-ui-07.png" alt="mainflux-ui-07">
<img src="../../../static/images/mainflux-ui-07.png" alt="mainflux-ui-07"></p>
<p>是没有问题的。</p>
<h3 id="124-发送消息测试">12.4 发送消息测试</h3>
<p>在上一节我们测试了系统的用户创建登录等，这一节将基于前边测试生成的一组账户数据进行设备的通信测试。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;distracted_goldberg@email.com&#34;</span><span class="p">,</span>
  <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;123&#34;</span>
<span class="p">}</span>


<span class="s2">&#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYxNjkzNTMsImlhdCI6MTU2NjEzMzM1MywiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJkaXN0cmFjdGVkX2dvbGRiZXJnQGVtYWlsLmNvbSJ9.48juMD1G25swxXYHe_ydHAY5kUdOC76sF6TebxEIKw4&#34;</span>


<span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;472afd2e-eb93-4a35-a043-c766ae5bb340&#34;</span><span class="p">,</span>
    <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;f586a9d6-65b2-402a-991f-df3f589dde03&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;d0&#34;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;b0963af4-9c86-4b1b-b66e-83225c3a61dc&#34;</span><span class="p">,</span>
    <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;4e7a2353-e190-474c-b870-09119540d07a&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;d1&#34;</span>
  <span class="p">}</span>
<span class="p">]</span>


<span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;56e9b2eb-1825-4405-9cfd-8f5da524bc5a&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;c0&#34;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;ffd36101-2eca-4a1f-995e-40db52ae3546&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;c1&#34;</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>先在mainflux-ui界面登录该账号，便于查看变化。</p>
<p><img src="/images/mainflux-ui-08.png" alt="mainflux-ui-08">
<img src="../../../static/images/mainflux-ui-08.png" alt="mainflux-ui-08"></p>
<p>现在我们可以看到是没有任何消息的。</p>
<p>当系统准备好（<code>provisioned</code>）之后，可以以下面类似的方式进行消息传递：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-cli messages send &lt;channel_id&gt; <span class="s1">&#39;[{&#34;bn&#34;:&#34;some-base-name:&#34;,&#34;bt&#34;:1.276020076001e+09, &#34;bu&#34;:&#34;A&#34;,&#34;bver&#34;:5, &#34;n&#34;:&#34;voltage&#34;,&#34;u&#34;:&#34;V&#34;,&#34;v&#34;:120.1}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-5,&#34;v&#34;:1.2}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-4,&#34;v&#34;:1.3}]&#39;</span> &lt;thing_key&gt;
</code></pre></td></tr></table>
</div>
</div><p>这里我在终端输入：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-cli messages send 56e9b2eb-1825-4405-9cfd-8f5da524bc5a <span class="s1">&#39;[{&#34;bn&#34;:&#34;some-base-name:&#34;,&#34;bt&#34;:1.276020076001e+09, &#34;bu&#34;:&#34;A&#34;,&#34;bver&#34;:5, &#34;n&#34;:&#34;voltage&#34;,&#34;u&#34;:&#34;V&#34;,&#34;v&#34;:120.1}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-5,&#34;v&#34;:1.2}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-4,&#34;v&#34;:1.3}]&#39;</span> 472afd2e-eb93-4a35-a043-c766ae5bb340
</code></pre></td></tr></table>
</div>
</div><p><code>channel_id</code>使用的是上面的<code>c0</code>，<code>thing_id</code>使用的是上面的<code>d0</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ mainflux-cli messages send 56e9b2eb-1825-4405-9cfd-8f5da524bc5a <span class="s1">&#39;[{&#34;bn&#34;:&#34;some-base-name:&#34;,&#34;bt&#34;:1.276020076001e+09, &#34;bu&#34;:&#34;A&#34;,&#34;bver&#34;:5, &#34;n&#34;:&#34;voltage&#34;,&#34;u&#34;:&#34;V&#34;,&#34;v&#34;:120.1}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-5,&#34;v&#34;:1.2}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-4,&#34;v&#34;:1.3}]&#39;</span> 472afd2e-eb93-4a35-a043-c766ae5bb340

unauthorized access
</code></pre></td></tr></table>
</div>
</div><p>而mainlfux系统的输出是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;warn&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method can_access for channel 56e9b2eb-1825-4405-9cfd-8f5da524bc5a and thing  took 38.792069ms to complete with error: missing or invalid credentials provided.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T06:27:06.144145764Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:06:27:06 +0000<span class="o">]</span> <span class="s2">&#34;POST /http/channels/56e9b2eb-1825-4405-9cfd-8f5da524bc5a/messages HTTP/1.1&#34;</span> <span class="m">403</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
mainflux-http   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;warn&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method publish to channel 56e9b2eb-1825-4405-9cfd-8f5da524bc5a took 60.581117ms to complete with error: rpc error: code = PermissionDenied desc = missing or invalid credentials provided.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T06:27:06.146926117Z&#34;</span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这里要说明下，我前后进行了两次<code>mainflux-cli provision test</code>，先后得到<code>dis_xxx</code>和<code>pen_xxx</code>两个user，使用<code>dis_xxx</code>用户进行发送消息测试时，发生了前面的错误。</p>
<p>再试试<code>pen_xxx</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;pensive_pike@email.com&#34;</span><span class="p">,</span>
  <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;123&#34;</span>
<span class="p">}</span>


<span class="s2">&#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NjYyMjY5MTEsImlhdCI6MTU2NjE5MDkxMSwiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJwZW5zaXZlX3Bpa2VAZW1haWwuY29tIn0.gt443-MvZP93VYzeIMn9tghlPHxpnYWOauhlGd6CLr4&#34;</span>


<span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;c7d43640-0dcd-4906-ac6b-6e402977a5ae&#34;</span><span class="p">,</span>
    <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;4a928b88-dc3f-4dd6-b8a0-71a72b8bfc49&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;d0&#34;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;d3f98848-2c3f-4cb7-9b2d-83ee6cdcbd7b&#34;</span><span class="p">,</span>
    <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;f8416f9d-4c88-4ffc-b3f9-3210db439494&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;d1&#34;</span>
  <span class="p">}</span>
<span class="p">]</span>


<span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;3e307fb1-d41c-49d1-853f-bc48e0e2f734&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;c0&#34;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;af1045ac-fdc1-4091-b0ba-234ebe5e167b&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;c1&#34;</span>
  <span class="p">}</span>
<span class="p">]</span>

</code></pre></td></tr></table>
</div>
</div><p>并在终端输入如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ mainflux-cli messages send af1045ac-fdc1-4091-b0ba-234ebe5e167b <span class="s1">&#39;[{&#34;bn&#34;:&#34;some-base-name:&#34;,&#34;bt&#34;:1.276020076001e+09, &#34;bu&#34;:&#34;A&#34;,&#34;bver&#34;:5, &#34;n&#34;:&#34;voltage&#34;,&#34;u&#34;:&#34;V&#34;,&#34;v&#34;:120.1}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-5,&#34;v&#34;:1.2}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-4,&#34;v&#34;:1.3}]&#39;</span> f8416f9d-4c88-4ffc-b3f9-3210db439494

ok
</code></pre></td></tr></table>
</div>
</div><p>同时，mainflux系统终端输出如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mainflux-normalizer <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method normalize took 67.01µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T09:50:15.912996945Z&#34;</span><span class="o">}</span>
mainflux-http   <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method publish to channel af1045ac-fdc1-4091-b0ba-234ebe5e167b took 1.610837ms to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T09:50:15.912421876Z&#34;</span><span class="o">}</span>
mainflux-things <span class="p">|</span> <span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Method can_access for channel af1045ac-fdc1-4091-b0ba-234ebe5e167b and thing d3f98848-2c3f-4cb7-9b2d-83ee6cdcbd7b took 692.851µs to complete without errors.&#34;</span>,<span class="s2">&#34;ts&#34;</span>:<span class="s2">&#34;2019-08-19T09:50:15.912035693Z&#34;</span><span class="o">}</span>
mainflux-nginx  <span class="p">|</span> 172.18.0.1 - - <span class="o">[</span>19/Aug/2019:09:50:15 +0000<span class="o">]</span> <span class="s2">&#34;POST /http/channels/af1045ac-fdc1-4091-b0ba-234ebe5e167b/messages HTTP/1.1&#34;</span> <span class="m">202</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Go-http-client/1.1&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>至此，mainflux官方文档Getting Startted一节完全跑通。</p>
<p>类比之下，我们前面在开发者文档里边所做的无非是编译了所有微服务程序，构建了必要的docker镜像及容器，只是nats等软件我们没有通过docker的方式安装而是真实安装在了我们的物理环境中。并不影响整个系统的运转，同样是没有问题的。</p>
<h2 id="13-mainflux架构概念">13. mainflux架构、概念</h2>
<h3 id="131-架构">13.1 架构</h3>
<p>mainflux架构如图：</p>
<p><img src="/images/mainflux-architecture.jpg" alt="mainflux-architeture">
<img src="../../../static/images/mainflux-architecture.jpg" alt="mainflux-architecture"></p>
<p>mainflux有三个主要的模型：user、thing、channel。user代表管理员，thing映射实际连接的设备，channel指一个通信频道，也可以理解为mqtt中的topic主题，连接到同一个channel的设备可以获取这个channel中的信息，也就是说实现了互相通信。</p>
<p>这里要注意两点：</p>
<ul>
<li>channel的物理实现是NATS消息系统的subject主题，nats基于channel_id来创建对应的主题名称。</li>
<li>Normalizer负责将数据转换为SenML格式</li>
</ul>
<h3 id="132-provisioning">13.2 Provisioning</h3>
<p><code>Provisioning</code>指的是物联网平台配置的过程，在mainflux中它指的是系统操作员创建配置user、channel、thing等实体的过程。</p>
<p>ps: 使用docker-compose.yml运行整个mainflux系统时，所有的服务都运行在nginx代理的后面，数据传输也都经过<code>TLS</code>加密。</p>
<h4 id="1321-用户管理">13.2.1 用户管理</h4>
<ul>
<li>
<p>创建user：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> https://localhost/users -d <span class="s1">&#39;{&#34;email&#34;:&#34;john.doe@email.com&#34;, &#34;password&#34;:&#34;123&#34;}&#39;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>获取user授权密钥（authorization key）：</p>
<p>为了让user能够管理整个系统，需要user创建授权令牌（token）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> https://localhost/tokens -d <span class="s1">&#39;{&#34;email&#34;:&#34;john.doe@email.com&#34;, &#34;password&#34;:&#34;123&#34;}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>响应形如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;token&#34;</span><span class="p">:</span> <span class="s2">&#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1MjMzODg0NzcsImlhdCI6MTUyMzM1MjQ3NywiaXNzIjoibWFpbmZsdXgiLCJzdWIiOiJqb2huLmRvZUBlbWFpbC5jb20ifQ.cygz9zoqD7Rd8f88hpQNilTCAS1DrLLgLg4PRcH-iAI&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="1322-系统配置provision">13.2.2 系统配置（provision）</h4>
<p>在进行这一步之前，确保已经创建了user并为其创建了授权秘钥。</p>
<ul>
<li>
<p>配置thing</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/things -d <span class="s1">&#39;{&#34;name&#34;:&#34;weio&#34;}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>&lt;user_auth_token&gt;</code>用来指定thing归属于哪个user。</p>
<p>响应形如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">HTTP/</span><span class="mf">1.1</span> <span class="mi">201</span> <span class="err">Created</span>
<span class="err">Content-Type:</span> <span class="err">application/json</span>
<span class="err">Location:</span> <span class="err">/things/</span><span class="mi">81380742-7116-4</span><span class="err">f</span><span class="mi">6</span><span class="err">f</span><span class="mi">-9800-14</span><span class="err">fe</span><span class="mi">464</span><span class="err">f</span><span class="mi">6773</span>
<span class="err">Date:</span> <span class="err">Tue,</span> <span class="mi">10</span> <span class="err">Apr</span> <span class="mi">2018</span> <span class="mi">10</span><span class="err">:</span><span class="mi">02</span><span class="err">:</span><span class="mi">59</span> <span class="err">GMT</span>
<span class="err">Content-Length:</span> <span class="mi">0</span>
</code></pre></td></tr></table>
</div>
</div><p>响应中<code>Location</code>字段的值为所配置的thing的路径。</p>
</li>
<li>
<p>从数据库中读取并解析指定user配置的things</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/things
</code></pre></td></tr></table>
</div>
</div><p>响应形如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">HTTP/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="err">OK</span>
<span class="err">Content-Type:</span> <span class="err">application/json</span>
<span class="err">Date:</span> <span class="err">Tue,</span> <span class="mi">10</span> <span class="err">Apr</span> <span class="mi">2018</span> <span class="mi">10</span><span class="err">:</span><span class="mi">50</span><span class="err">:</span><span class="mi">12</span> <span class="err">GMT</span>
<span class="err">Content-Length:</span> <span class="mi">1105</span>

<span class="p">{</span>
<span class="nt">&#34;total&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="nt">&#34;offset&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="nt">&#34;limit&#34;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="nt">&#34;things&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;81380742-7116-4f6f-9800-14fe464f6773&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;weio&#34;</span><span class="p">,</span>
    <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;7aa91f7a-cbea-4fed-b427-07e029577590&#34;</span>
    <span class="p">},</span>
    <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;cb63f852-2d48-44f0-a0cf-e450496c6c92&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;myapp&#34;</span><span class="p">,</span>
    <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;cbf02d60-72f2-4180-9f82-2c957db929d1&#34;</span>
    <span class="p">}</span>
<span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>也可以指定<code>offset</code>（设置读取的数据条目间隔）和<code>limit</code>（设置读取的数据条目数）参数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/things?offset<span class="o">=</span>0<span class="p">&amp;</span><span class="nv">limit</span><span class="o">=</span><span class="m">5</span>
</code></pre></td></tr></table>
</div>
</div><p>不指定<code>offset</code>和<code>limit</code>参数时其默认值分别为0和10，而且<code>limit</code>不可以超过100。</p>
</li>
<li>
<p>移除thing:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X DELETE -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/things/&lt;thing_id&gt;
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>配置channel</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X POST -H <span class="s2">&#34;Content-Type: application/json&#34;</span> -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/channels -d <span class="s1">&#39;{&#34;name&#34;:&#34;mychan&#34;}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>响应形如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">HTTP/</span><span class="mf">1.1</span> <span class="mi">201</span> <span class="err">Created</span>
<span class="err">Content-Type:</span> <span class="err">application/json</span>
<span class="err">Location:</span> <span class="err">/channels/</span><span class="mi">19</span><span class="err">daa</span><span class="mi">7</span><span class="err">a</span><span class="mi">8</span><span class="err">-a</span><span class="mi">489-4571-8714</span><span class="err">-ef</span><span class="mi">1</span><span class="err">a</span><span class="mi">214</span><span class="err">ed</span><span class="mi">914</span>
<span class="err">Date:</span> <span class="err">Tue,</span> <span class="mi">10</span> <span class="err">Apr</span> <span class="mi">2018</span> <span class="mi">11</span><span class="err">:</span><span class="mi">30</span><span class="err">:</span><span class="mi">07</span> <span class="err">GMT</span>
<span class="err">Content-Length:</span> <span class="mi">0</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>解析指定用户配置的channels：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/channels
</code></pre></td></tr></table>
</div>
</div><p>响应形如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">HTTP/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="err">OK</span>
<span class="err">Content-Type:</span> <span class="err">application/json</span>
<span class="err">Date:</span> <span class="err">Tue,</span> <span class="mi">10</span> <span class="err">Apr</span> <span class="mi">2018</span> <span class="mi">11</span><span class="err">:</span><span class="mi">38</span><span class="err">:</span><span class="mi">06</span> <span class="err">GMT</span>
<span class="err">Content-Length:</span> <span class="mi">139</span>

<span class="p">{</span>
<span class="nt">&#34;total&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="nt">&#34;offset&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="nt">&#34;limit&#34;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="nt">&#34;channels&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;19daa7a8-a489-4571-8714-ef1a214ed914&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;mychan&#34;</span>
    <span class="p">}</span>
<span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>也可以指定<code>offset</code>和<code>limit</code>参数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/channels?offset<span class="o">=</span>0<span class="p">&amp;</span><span class="nv">limit</span><span class="o">=</span><span class="m">5</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>移除channel：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X DELETE -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/channels/&lt;channel_id&gt;
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="1323-访问控制">13.2.3 访问控制</h4>
<p>只有user能管理user名下的channel和thing!!!</p>
<ul>
<li>
<p>将thing连接到channel上：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X PUT -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/channels/&lt;channel_id&gt;/things/&lt;thing_id&gt;
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查看channel上有哪些thing连接</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/channels/&lt;channel_id&gt;/things
</code></pre></td></tr></table>
</div>
</div><p>得到的响应输出会是这样的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;total&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nt">&#34;offset&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&#34;limit&#34;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nt">&#34;things&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;3ffb3880-d1e6-4edd-acd9-4294d013f35b&#34;</span><span class="p">,</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;d0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;b1996995-237a-4552-94b2-83ec2e92a040&#34;</span><span class="p">,</span>
        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="s2">&#34;{}&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;94d166d6-6477-43dc-93b7-5c3707dbef1e&#34;</span><span class="p">,</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;d1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;e4588a68-6028-4740-9f12-c356796aebe8&#34;</span><span class="p">,</span>
        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="s2">&#34;{}&#34;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>也可以查看指定thing连接在了哪些channel上：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/things/&lt;thing_id&gt;/channels
</code></pre></td></tr></table>
</div>
</div><p>响应会像是这样的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;total&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nt">&#34;offset&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&#34;limit&#34;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nt">&#34;channels&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;5e62eb13-2695-4860-8d87-85b8a2f80fd4&#34;</span><span class="p">,</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;c1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="s2">&#34;{}&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;c4b5e19a-7ffe-4172-b2c5-c8b9d570a165&#34;</span><span class="p">,</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;c0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span><span class="s2">&#34;{}&#34;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>也可以取消某thing与某channel的连接：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X DELETE -H <span class="s2">&#34;Authorization: &lt;user_auth_token&gt;&#34;</span> https://localhost/channels/&lt;channel_id&gt;/things/&lt;thing_id&gt;
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>ps: 除去涉及证书加密的部分，后边的url请求还是很容易懂的。</p>
<h3 id="133-messaging">13.3 Messaging</h3>
<p>网络通信协议处理的是客户端与nginx、nginx与网络协议适配服务的通信，在mainflux中有http、mqtt、websocket、coap四种。</p>
<h4 id="1331-http">13.3.1 http</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i --cacert docker/ssl/certs/mainflux-server.crt --insecure -X POST -H <span class="s2">&#34;Content-Type: application/senml+json&#34;</span> -H <span class="s2">&#34;Authorization: &lt;thing_token&gt;&#34;</span> https://localhost/http/channels/&lt;channel_id&gt;/messages -d <span class="s1">&#39;[{&#34;bn&#34;:&#34;some-base-name:&#34;,&#34;bt&#34;:1.276020076001e+09, &#34;bu&#34;:&#34;A&#34;,&#34;bver&#34;:5, &#34;n&#34;:&#34;voltage&#34;,&#34;u&#34;:&#34;V&#34;,&#34;v&#34;:120.1}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-5,&#34;v&#34;:1.2}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-4,&#34;v&#34;:1.3}]&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>注意：如果使用SenML格式，所发送的数据需要是数组形式。（暂时不清楚是怎么样的数组）</p>
<h4 id="1332-mqtt">13.3.2 MQTT</h4>
<p>为了通过mqtt发送消息，需要使用mosquitto工具<a href="https://mosquitto.org/">https://mosquitto.org/</a>。如果想使用基于websocket的mqtt，则需要使用paho<a href="https://www.eclipse.org/paho/">https://www.eclipse.org/paho/</a>。</p>
<ul>
<li>
<p>在channel上发布消息（pub）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mosquitto_pub -u &lt;thing_id&gt; -P &lt;thing_key&gt; -t channels/&lt;channel_id&gt;/messages -h localhost -m <span class="s1">&#39;[{&#34;bn&#34;:&#34;some-base-name:&#34;,&#34;bt&#34;:1.276020076001e+09, &#34;bu&#34;:&#34;A&#34;,&#34;bver&#34;:5, &#34;n&#34;:&#34;voltage&#34;,&#34;u&#34;:&#34;V&#34;,&#34;v&#34;:120.1}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-5,&#34;v&#34;:1.2}, {&#34;n&#34;:&#34;current&#34;,&#34;t&#34;:-4,&#34;v&#34;:1.3}]&#39;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>thing订阅channel：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mosquitto_sub -u &lt;thing_id&gt; -P &lt;thing_key&gt; -t channels/&lt;channel_id&gt;/messages -h localhost
</code></pre></td></tr></table>
</div>
</div><p>In order to pass content type as part of topic, one should append it to the end of an existing topic. Content type value should always be prefixed with <code>/ct/</code>. If you want to use standard topic such as <code>channels/&lt;channel_id&gt;/messages</code> with SenML content type, you should use following topic <code>channels/&lt;channel_id&gt;/messages/ct/application_senml-json</code>. Characters like <code>_</code> and <code>-</code> in the content type will be replaced with <code>/</code> and <code>+</code> respectively.</p>
<p>If you are using TLS to secure MQTT connection, add <code>--cafile docker/ssl/certs/ca.crt</code> to every command.</p>
</li>
</ul>
<h3 id="134-storage">13.4 Storage</h3>
<p>mainflux支持多种用于存储设备消息的数据库：cassandra/influxdb/mongodb</p>
<p>ps: 从docker-compose.yml文件可以看出，mainflux核心服务中使用了redis作为things、es、mqtt的缓存数据库，postgres作为users、things的数据库。和本节所讲的存储不同，本节主要指的是设备间通信<code>Message</code>的持久化存储方案。</p>
<p>这些存储<code>Storage</code>的安装需要通过docker-compose addons。</p>
<p>在<code>mainflux/docker/addons</code>目录下可以找到mainflux的非核心服务，其中就包括了storage的6个服务。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">eiger@eiger-ThinkPad-X1-Carbon-3rd:~/gopath-default/src/github.com/mainflux/mainflux$ ls docker/addons
bootstrap  cassandra-reader  cassandra-writer  influxdb-reader  influxdb-writer  lora-adapter  mongodb-reader  mongodb-writer  postgres-reader  postgres-writer
</code></pre></td></tr></table>
</div>
</div><p>注意，必须把核心服务先启动起来（<code>make run</code>）才能安装和启动这些插件服务。</p>
<h4 id="1341-writers">13.4.1 Writers</h4>
<p><code>Witers</code>包括cassandra-writer、influxdb-writer、mongodb-writer。<code>writer</code>负责使用、并且将SenML标准化后的消息存储到对应的数据库中。</p>
<p><code>writer</code>会根据channels.toml中的配置来过滤对应channel的消息。如果想要监听所有channel的消息，channels.toml内容可以配置如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[</span><span class="nx">channels</span><span class="p">]</span>
<span class="nx">filter</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;*&#34;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>否则传入channels_id的列表。（这里还不确定传入的是会被过滤还是会被监听，这里有些含糊，有待后边去测试使用）</p>
<p>说得直白点是，writer运行起来后会监听channel的消息，并将消息进行持久化存储。</p>
<p>这里只介绍monggodb-writer，其他自行参考<a href="https://mainflux.readthedocs.io/en/latest/storage/">https://mainflux.readthedocs.io/en/latest/storage/</a></p>
<p>mongodb-writer安装：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker-compose -f docker/addons/mongodb-writer/docker-compose.yml up -d
</code></pre></td></tr></table>
</div>
</div><p>mongodb默认端口为27017，可以使用各种工具来进行数据库监视和数据可视化。</p>
<h4 id="1342-readers">13.4.2 Readers</h4>
<p><code>Readers</code>与<code>Writers</code>相对应，要想使用某个reader，必须先安装启用某个writer。reader负责从数据库中读取数据并将其从SenML格式解码，并且对外提供<code>HTTP API</code>用于消息访问或者说消息的使用。</p>
<p>同样的，这里也只介绍mongodb-reader。</p>
<p>安装和启动：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker-compose -f docker/addons/mongodb-reader/docker-compose.yml up -d
</code></pre></td></tr></table>
</div>
</div><p>mongodb-reader对外暴露8903端口来提供<code>HTTP API</code><a href="https://github.com/mainflux/mainflux/blob/master/readers/swagger.yml">https://github.com/mainflux/mainflux/blob/master/readers/swagger.yml</a>以获取消息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -S -i  -H <span class="s2">&#34;Authorization: &lt;thing_token&gt;&#34;</span> http://localhost:8904/channels/&lt;channel_id&gt;/messages
</code></pre></td></tr></table>
</div>
</div><h3 id="135-lora">13.5 LoRa</h3>
<p>长范围通信协议。<a href="https://mainflux.readthedocs.io/en/latest/lora/">https://mainflux.readthedocs.io/en/latest/lora/</a></p>
<p>此节跳过。</p>
<h3 id="136-安全通信">13.6 安全通信</h3>
<h4 id="1361-安全的postgresql连接">13.6.1 安全的PostgreSQL连接</h4>
<p>默认连接是不安全的连接。如果需要安全连接，可以选择<code>SSL</code>模式，并且设置相应的证书和秘钥文件的路径。</p>
<ul>
<li>
<p><code>MF_USERS_DB_SSL_MODE</code> the SSL connection mode for Users.</p>
</li>
<li>
<p><code>MF_USERS_DB_SSL_CERT</code> the path to the certificate file for Users.</p>
</li>
<li>
<p><code>MF_USERS_DB_SSL_KEY</code> the path to the key file for Users.</p>
</li>
<li>
<p><code>MF_USERS_DB_SSL_ROOT_CERT</code> the path to the root certificate file for Users.</p>
</li>
<li>
<p><code>MF_THINGS_DB_SSL_MODE</code> the SSL connection mode for Things.</p>
</li>
<li>
<p><code>MF_THINGS_DB_SSL_CERT</code> the path to the certificate file for Things.</p>
</li>
<li>
<p><code>MF_THINGS_DB_SSL_KEY</code> the path to the key file for Things.</p>
</li>
<li>
<p><code>MF_THINGS_DB_SSL_ROOT_CERT</code> the path to the root certificate file for Things.</p>
</li>
</ul>
<p>支持的数据库连接模式有: <code>disabled</code> (默认), <code>required</code>, <code>verify-ca</code> 和 <code>verify-full</code>。</p>
<h4 id="1362-安全的grpc">13.6.2 安全的gRPC</h4>
<ol>
<li>
<p>服务器配置
默认情况下gRPC通信是不安全的，因为mainflux通常运行在反向代理之后的私有网络中。</p>
<p>但是可以配置其使用<code>TLS</code>加密传输</p>
<ul>
<li>
<p>Users:</p>
<ul>
<li><code>MF_USERS_SERVER_CERT</code> the path to server certificate in pem format.</li>
<li><code>MF_USERS_SERVER_KEY</code> the path to the server key in pem format.</li>
</ul>
</li>
<li>
<p>Things:</p>
<ul>
<li><code>MF_THINGS_SERVER_CERT</code> the path to server certificate in pem format.</li>
<li><code>MF_THINGS_SERVER_KEY</code> the path to the server key in pem format.</li>
</ul>
</li>
</ul>
<p>注意：证书和秘钥必须两个都设置好才行，否则都是不安全的通信。</p>
</li>
<li>
<p>客户端配置</p>
<p>如果想为users和things提供安全的gRPC连接，必须定义可信的CA证书，而且不支持共同的身份验证（mutual certificate authentication）</p>
<ul>
<li>
<p>Adapter适配器配置</p>
<p><code>MF_HTTP_ADAPTER_CA_CERTS</code>, <code>MF_MQTT_ADAPTER_CA_CERTS</code>, <code>MF_WS_ADAPTER_CA_CERTS</code>, <code>MF_COAP_ADAPTER_CA_CERTS</code> - the path to a file that contains the CAs in PEM format. If not set, the default connection will be insecure. If it fails to read the file, the adapter will fail to start up.</p>
</li>
<li>
<p>Things配置</p>
<p><code>MF_THINGS_CA_CERTS</code> - the path to a file that contains the CAs in PEM format. If not set, the default connection will be insecure. If it fails to read the file, the service will fail to start up.</p>
</li>
</ul>
</li>
</ol>
<h3 id="137-authentication认证">13.7 Authentication（认证）</h3>
<h4 id="1371-使用mainflux秘钥认证">13.7.1 使用Mainflux秘钥认证</h4>
<p>默认情况下mainflux使用mainflux key进行认证。mainflux key指的是在thing创建时生成的一个秘钥。为了认证身份，thing在发送消息时需要加上它的这个秘钥。如何传递这个秘钥取决于所采用的传输协议。关于秘钥如何传递，应参考<a href="#133-messaging">Messaging</a>。</p>
<p>注意当使用<code>docker-compose -f docker/docker-compose.yml up</code>启动mainflux时采用的就是这种认证方式。</p>
<h4 id="1372-使用x509证书进行相互tls认证">13.7.2 使用X.509证书进行相互TLS认证</h4>
<p><a href="https://mainflux.readthedocs.io/en/latest/authentication/">https://mainflux.readthedocs.io/en/latest/authentication/</a></p>
<h3 id="138-cli">13.8 CLI</h3>
<p>CLI指令很简单，之间看官方文档：
<a href="https://mainflux.readthedocs.io/en/latest/cli/">https://mainflux.readthedocs.io/en/latest/cli/</a></p>
<p>或者自己使用<code>mainflux-cli help</code>和<code>mainflux-cli [COMMAND] --help</code>查看帮助信息。</p>
<h3 id="139-bootstrap引导">13.9 Bootstrap（引导）</h3>
<p>Bootstrapping是指一个自启动过程，应该在没有外部输入的情况下继续进行。 Mainflux平台支持自举过程，但有些前提条件需要提前完成。设备可以在以下情况下触发引导：</p>
<ul>
<li>设备仅包含引导凭证且没有Mainflux凭证</li>
<li>设备由于任何原因无法启动与配置的Mainflux服务（服务器无响应，身份验证失败等）的通信。</li>
<li>设备出于任何原因想要更新其配置</li>
</ul>
<p>Bootstrapping和Provisioning的区别在于：</p>
<ul>
<li>Provisioning是由系统管理员进行的实体管理，包括user/thing/channel的创建、查看、删除与访问控制。</li>
<li>Bootstrapping是实体配置，指的是device端管理员进行的的配置操作。包括创建channel/thing，修改thing的信息，使能thing等等。</li>
</ul>
<p>参看官方文档：<a href="https://mainflux.readthedocs.io/en/latest/bootstrap/">https://mainflux.readthedocs.io/en/latest/bootstrap/</a></p>
<h2 id="14-mainflux应用">14. mainflux应用</h2>
<h3 id="141-连接一个mqtt设备">14.1 连接一个mqtt设备</h3>
<p>大致思路：准备一个mqtt客户端，在mainflux系统为<code>374192922@qq.com</code>用户创建一个<code>channel</code>和一个<code>thing</code>，这个thing就对应着这个mqtt客户端</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content"><a href="https://github.com/azd1997" class="theme-link">Eiger</a></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2019-08-20
        <a href="https://github.com/azd1997/azd1997.github.io.git/commit/0c3dc1cd9872f899c9268c6c46fac8a0d9d22eb3" title="111">(0c3dc1c)</a>
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/mainflux/">mainflux</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/iot/iothub/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">IotHub物联网平台搭建：从0到1</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/linux/installubuntu/">
            <span class="next-text nav-default">安装Ubuntu及其他相关使用教程</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  
  <span id="/post/iot/installmainflux/" class="leancloud_visitors" data-flag-title="安装mainflux全系列">
		<span class="post-meta-item-text">文章阅读量 </span>
		<span class="leancloud-visitors-count">0</span>
		<p></p>
	  </span>
  <div id="vcomments"></div>
  <script src="http://pirogue.org/js/av-min.js"></script>
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'bpOXpWYjWw1gNOYNe2PrWjKV-gzGzoHsz',
        appKey: '07yqjMVRu9Nyoqrzj4X7IhL5',
        notify:  true , 
        verify:  false , 
        avatar:'mm', 
        placeholder: '说点什么吧...',
        visitor:  true 
    });
  </script>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:374192922@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.linkedin.com/in/%E6%8C%AF%E4%B8%9C-%E8%89%BE-b10752175/detail/recent-activity/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/azd1997" class="iconfont icon-github" title="github"></a>
  <a href="https://azd1997.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author"><a href="https://github.com/azd1997" class="theme-link">Eiger</a></span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      TeX: {equationNumbers: {autoNumber: "AMS"}},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
